import{c as Y,j as e,R as G,em as K,en as V,eo as B,ep as H,a as A,eq as Q,r as n,G as Z,u as F,h as k,d as v,er as W,aZ as J,a2 as r,a6 as X,a4 as $,a7 as ee,a3 as ae,a5 as se,dL as te,es as ne,et as re,n as R,eu as w,ev as oe,e as le,b_ as ie,ew as ce,ex as de,ey as me,ez as L,eA as E,eB as I,eC as ue}from"./index-DcaVl4xy.js";import{o as pe,p as fe,c as xe,q as Se}from"./useFetchLookUpData-DVeTlbqo.js";import{c as D,S as O}from"./SelectInput-Cy_aceVQ.js";import"./sharedApi-BpArerwz.js";import"./requestApi-Cjr95N_T.js";import"./react-select-animated.esm-CNLYEWr2.js";const z=Y(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),he=()=>[{accessorKey:"personnelStatementRowNo",header:G,size:20,enableSorting:!1,enableColumnActions:!1},{accessorKey:"personnelStatementSerial",header:K,size:20},{accessorKey:"orderType",header:V,size:20},{accessorKey:"personnelStatementNumber",header:B,size:20},{accessorKey:"insertTime",header:H,size:20,Cell:({renderedCellValue:a})=>e.jsx("div",{children:A(a)})},{accessorKey:"personnelStatementRunDate",header:Q,size:20,Cell:({renderedCellValue:a})=>e.jsx("div",{children:A(a)})}],Ne=n.memo(({personID:a,handleRowSelect:c})=>{const[f,i]=n.useState([]),[d,{isLoading:t,isFetching:o}]=pe(),T=he(),x=n.useCallback(async()=>{const S=(await d({personID:a}).unwrap()).itemList.map((s,u)=>({id:s.personnelStatementSerial,personnelStatementRowNo:u+1,personnelStatementSerial:s.personnelStatementSerial||"-",orderType:s.orderType||"-",personnelStatementNumber:s.personnelStatementID||"-",insertTime:s.insertTime||"-",personnelStatementRunDate:s.personnelStatementRunDate||"-"}));i(S)},[d,a]);return n.useEffect(()=>{a?x():i([])},[a,x]),e.jsx(Z,{data:f,columns:T,isLoading:t,isFetching:o,scroll:!1,onRowSelect:c})}),be=()=>{const[a,c]=n.useState(null),[f,i]=n.useState(null),d=F(),t=k(),{control:o,handleSubmit:T,formState:{errors:x},trigger:y,watch:S,setValue:s}=v(),u=S("personNationalCode"),[l,{isLoading:m,isFetching:h}]=W(),{personnelStatementOffTypes:b,personnelStatementOffTypesIsLoading:p}=fe(),{organizations:g,organizationIsLoading:_}=xe({}),q=n.useMemo(()=>D(b,"personnelStatementOffTypeID","personnelStatementOffTypeName"),[b]),M=n.useMemo(()=>D(g,"organizationID","organizationName"),[g]),P=n.useCallback(j=>{i(j)},[]),U=j=>{d(oe({...j,serial:f})),t("/retirement/fraction/calculate/2")},C=n.useCallback(async()=>{const N=(await l({personNationalCode:J(u)}).unwrap()).itemList[0];N&&(s("personFirstName",N.personFirstName),s("personLastName",N.personLastName),s("personnelID",N.personnelID),c(N.personID))},[u,l,s]);return n.useEffect(()=>{u?(async()=>{await y("personNationalCode")?C():(s("personFirstName",""),s("personLastName",""),s("personnelID",""),c(null),i(null))})():(s("personFirstName",""),s("personLastName",""),s("personnelID",""),c(null),i(null))},[y,C,u,s]),e.jsx(e.Fragment,{children:e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:T(U),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(r,{name:"personNationalCode",label:X,rules:{...$,...ee},required:!0,control:o,type:"text"}),e.jsx(r,{name:"personFirstName",label:ae,required:!1,editable:!1,control:o,isLoading:m||h,type:"text"}),e.jsx(r,{name:"personLastName",label:se,required:!1,editable:!1,control:o,isLoading:m||h,type:"text"}),e.jsx(r,{name:"personnelID",label:te,required:!1,editable:!1,control:o,isLoading:m||h,type:"text"}),e.jsx(O,{name:"statementType",control:o,label:ne,required:!1,isClearable:!0,options:q,isLoading:p,errors:x}),e.jsx(O,{name:"organizationID",control:o,label:re,required:!1,isClearable:!0,options:M,isLoading:_,errors:x})]}),e.jsx(Ne,{personID:a,handleRowSelect:P}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(R,{dir:"ltr",disabled:!f,endIcon:e.jsx(z,{}),variant:"contained",type:"submit",color:"success",children:e.jsx("span",{children:w})})})]})})})},je=()=>{const{control:a,handleSubmit:c,formState:{errors:f},trigger:i,setValue:d}=v(),{fractionData:t}=le(l=>l.fraction);F();const[o,{isLoading:T,isFetching:x,isSuccess:y}]=Se(),S=n.useCallback(async()=>{var h,b;const l=await o({personNationalCode:t.personNationalCode,personnelStatementOffTypeID:((h=t==null?void 0:t.statementType)==null?void 0:h.value)||"0",organizationID:((b=t==null?void 0:t.organizationID)==null?void 0:b.value)||"0",numberOfInstallments:0,personnelStatementSerialNO:parseInt(t.serial),periods:null,save:!1}).unwrap(),m=l==null?void 0:l.itemList[0];Object.keys(m).forEach(p=>{typeof m[p]=="number"?d(p,ie(m[p])):d(p,m[p])}),console.log("CALCULATION",l)},[o,t,d]),s=async l=>{console.log(l)};return n.useEffect(()=>{t&&S()},[t,S]),n.useEffect(()=>{console.log(t)},[t]),e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:c(s),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(r,{name:"credit",label:ce,editable:!1,required:!1,control:a,type:"text"}),e.jsx(r,{name:"transferredAmount",label:de,required:!1,control:a,type:"text"})]}),e.jsx("div",{className:"Modal__header flex justify-center items-center",children:e.jsx("h4",{className:"title-secondary",children:me})}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:"تاریخ از :"})}),e.jsx(r,{name:"startYear",label:L,editable:!1,required:!1,control:a,type:"text"}),e.jsx(r,{name:"startMonth",label:E,editable:!1,required:!1,control:a,type:"text"}),e.jsx(r,{name:"startDay",label:I,editable:!1,required:!1,control:a,type:"text"}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:"تاریخ تا :"})}),e.jsx(r,{name:"endYear",label:L,editable:!1,required:!1,control:a,type:"text"}),e.jsx(r,{name:"endMonth",label:E,editable:!1,required:!1,control:a,type:"text"}),e.jsx(r,{name:"endDay",label:I,editable:!1,required:!1,control:a,type:"text"})]}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(R,{dir:"ltr",endIcon:e.jsx(z,{}),variant:"contained",type:"submit",color:"success",children:e.jsx("span",{children:w})})})]})})},Ee=()=>{const{step:a}=ue();return(i=>{switch(i){case"1":return e.jsx(be,{});case"2":return e.jsx(je,{});default:return null}})(a)};export{Ee as default};
