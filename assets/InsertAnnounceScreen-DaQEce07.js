import{r as o,j as e,m as A,S as M,p as C,z as R,T as N,A as _,I as w,D as T,Q as k,U as F,l as z,M as O,B as L,C as E,P as Y,E as G,F as K,H as q,J as Q}from"./index-DQyzDCLR.js";import{a as H,b as J,u as U}from"./announceApi-CaMNqMhW.js";import{u as W,m as V,C as X,d as Z,a as $}from"./datePicker-C8gr3sj3.js";import{M as ee}from"./Modal-hxHYA1BW.js";import{d as ne}from"./table-options-DNK9GsEa.js";import{D as se}from"./DeleteOutline-DkzFNTnt.js";import{R as ae}from"./Refresh-XGF5Rwvg.js";function te({setIsRefresh:c}){const l=o.useRef(null),[r,x]=o.useState({}),[d,p]=o.useState(null),[i,u]=o.useState(!1),[D,{isLoading:S,isFetching:f}]=H(),h=t=>{const{name:s,value:m}=t.target;x({...r,[s]:m})},j=t=>{p(t),u(!1)},y=t=>{u(t)},I=async()=>{var t;try{let s;d?(s=new Date(d),s.setMinutes(s.getMinutes()-s.getTimezoneOffset())):s=null;const m=await D({runDate:s,title:r.title,isDeleted:!1,description:r.description}).unwrap();C.success(m.message,{autoClose:2e3}),c(v=>!v),p(null),x({title:"",description:""})}catch(s){console.log(s),C.error(((t=s==null?void 0:s.data)==null?void 0:t.message)||s.error,{autoClose:2e3})}};return W([l],[u]),e.jsxs("section",{className:"flex-col formContainer",children:[e.jsxs("form",{method:"POST",className:"grid grid--col-2",children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",name:"title",value:r.title||"",id:"title",onChange:h,className:"inputBox__form--input",required:!0}),e.jsxs("label",{htmlFor:"title",className:"inputBox__form--label",children:[e.jsx("span",{children:"*"})," عنوان اطلاعیه"]})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(V.InputDatePicker,{value:d,onChange:j,format:"jYYYY/jMM/jDD",onOpenChange:y,suffixIcon:e.jsx(X,{color:"action"}),open:i,style:Z,wrapperStyle:$,pickerProps:{ref:l}}),e.jsxs("div",{className:"inputBox__form--readOnly-label",children:[e.jsx("span",{children:"*"})," تاریخ ارسال"]})]}),e.jsxs("div",{className:"inputBox__form col-span-2 row-span-3",children:[e.jsx("textarea",{type:"text",id:"description",name:"description",value:r.description||"",onChange:h,className:"inputBox__form--input",maxLength:500,required:!0}),e.jsxs("label",{htmlFor:"description",className:"inputBox__form--label",children:[e.jsx("span",{children:"*"})," متن اطلاعیه"]})]})]}),e.jsx("div",{style:{marginRight:"auto"},children:e.jsx(A,{dir:"ltr",endIcon:e.jsx(M,{}),onClick:I,loading:S||f,variant:"contained",color:"success",children:e.jsx("span",{children:"ذخیره"})})})]})}function oe({isRefresh:c}){const[l,r]=o.useState({}),[x,d]=o.useState(null),[p,i]=o.useState(!1),[u,D]=o.useState([]),[S,{isLoading:f}]=J(),{data:h,isSuccess:j,isLoading:y,isFetching:I,error:g,refetch:t}=U();o.useEffect(()=>{if(t(),j){const n=h.itemList.map((a,B)=>({id:a.announceID,announceRowNum:B+1,announceTitle:a.title,announceDesc:a.description,announceRunDate:a.runDate}));D(n)}},[j,t,h,c]),o.useEffect(()=>{g&&console.log(g)},[g]);const s=()=>{t()},m=()=>{i(!0)},v=async()=>{var n;try{const a=await S({announceID:x,isDeleted:!0}).unwrap();C.success(a.message,{autoClose:2e3}),i(!1),t()}catch(a){console.log(a),C.error(((n=a==null?void 0:a.data)==null?void 0:n.message)||a.error,{autoClose:2e3})}},P=o.useMemo(()=>[{accessorKey:"announceRowNum",header:"ردیف",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({renderedCellValue:n})=>e.jsx("span",{children:R(n)})},{accessorKey:"announceTitle",header:"عنوان اطلاعیه",size:20},{accessorKey:"announceDesc",header:"متن اطلاعیه",size:20,Cell:({renderedCellValue:n,row:a})=>e.jsx(N,{title:e.jsx("p",{style:{fontFamily:"IranYekan"},children:a.original.announceDesc}),children:e.jsx("p",{style:{width:"80ch",textOverflow:"ellipsis",overflow:"hidden"},children:n})}),muiTableBodyCellProps:{align:"right"}},{accessorKey:"announceRunDate",header:"تاریخ اجرا",size:20,Cell:({renderedCellValue:n})=>e.jsx("div",{children:_(n)})},{accessorKey:"deleteAnnounce",header:"حذف",enableSorting:!1,enableColumnActions:!1,size:20,Cell:()=>e.jsx(w,{color:"error",onClick:m,sx:{padding:"0"},children:e.jsx(se,{})})}],[]),b=T({...ne,columns:P,data:u,defaultColumn:{minSize:5,maxSize:1e3},renderTopToolbarCustomActions:()=>e.jsx(L,{children:y||I?e.jsx(w,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(E,{size:20,value:100})}):e.jsx(N,{title:"بروز رسانی",children:e.jsx("span",{children:e.jsx(w,{"aria-label":"refresh",color:"info",onClick:s,children:e.jsx(ae,{fontSize:"small"})})})})}),muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:n=>e.jsx(Y,{...n,page:R(n.page),slots:{previous:G,next:K,first:q,last:Q}})},muiTableBodyRowProps:({row:n})=>({onClick:()=>r(()=>({[n.id]:!0})),selected:l[n.id],sx:{cursor:"pointer"}}),getRowId:n=>n.id,onRowSelectionChange:r,state:{rowSelection:l}});return o.useEffect(()=>{const n=Object.keys(b.getState().rowSelection)[0];n&&d(n)},[b,l]),e.jsxs(e.Fragment,{children:[p&&e.jsxs(ee,{title:"حذف اطلاعیه",closeModal:()=>i(!1),children:[e.jsx("p",{className:"paragraph-primary",children:"آیا از حذف این اطلاعیه اطمینان دارید؟"}),e.jsxs("div",{className:"flex-row flex-center",children:[e.jsx(A,{dir:"ltr",endIcon:e.jsx(k,{}),onClick:v,loading:f,variant:"contained",color:"success",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:"بله"})}),e.jsx(F,{dir:"ltr",endIcon:e.jsx(z,{}),onClick:()=>i(!1),disabled:f,variant:"contained",color:"error",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:"خیر"})})]})]}),e.jsx(O,{table:b}),";"]})}function xe(){const[c,l]=o.useState(!1);return e.jsxs("section",{className:"flex-col u-margin-bottom-xl",children:[e.jsx("div",{className:"title-primary--container flex-row flex-center",children:e.jsxs("h4",{className:"title-primary",children:[e.jsx("span",{className:"title-primary--underline"}),"ثبت اطلاعیه"]})}),e.jsx(te,{setIsRefresh:l}),e.jsx("div",{className:"flex-col flex-center",children:e.jsx("h5",{className:"title-secondary",children:"مدیریت اطلاعیه ها"})}),e.jsx(oe,{isRefresh:c})]})}export{xe as default};
