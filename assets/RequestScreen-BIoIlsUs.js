import{c as he,j as e,r as s,G as ue,bc as me,bd as xe,O as pe,A as S,U as fe,V as H,W as ge,w as O,H as W,be as je,bf as ye,a as A,T as L,I as D,ak as be,E as Q,u as Y,al as Ne,Z,B as k,k as M,R as J,am as ve,P as X,C as ee,b as se,L as te,F as ae,an as ne,ao as V,ap as oe,Y as le,v as Se,d as re,o as $,bg as ie,bh as Ce,ar as Re,e as ce,bi as Ie,ag as Te,ay as _e,az as we,aA as U,aG as K}from"./index-Bx2CJIsO.js";import{U as De,R as qe,a as Be}from"./index-Dog372Wr.js";import{S as Fe}from"./ArrowUpwardOutlined-DjaiStRH.js";const Le=he(e.jsx("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3m-3 11H8v-5h8zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-1-9H6v4h12z"}),"Print");function Pe({setShowInsertAttachmentModal:b,refetch:h}){const[l,j]=s.useState({}),[m,T]=s.useState(null),[a,_]=s.useState(null),N=new URLSearchParams(location.search),g=N.get("type"),y=N.get("requestID"),x=ue(),[C,{isLoading:q}]=me(),v=s.useRef(null),{requestAttachmentTypes:u,requestAttachmentTypesIsLoading:R,requestAttachmentTypesIsFetching:t}=xe(g),p=pe(u,"requestTypeAttachmentID","name"),r=()=>{v.current.click()},B=n=>{const f=n.target.files[0],w=new FileReader;_(f.type.split("/")[1]),w.onloadend=()=>{const P=w.result.split(",")[1];T(P)},w.readAsDataURL(f)};s.useEffect(()=>{m!==null&&F()},[m]);const I=(n,f)=>{const{name:w}=f;if(n){const{value:z}=n;j({...l,[w]:z||""})}else j({...l,[w]:null})},i=n=>{const{name:f,value:w}=n.target;j({...l,[f]:w})},F=async()=>{var n;try{const f=await C({attachementTypeID:l.attachementTypeID,requestID:y,contentType:a,attachment:m,attachementDesc:l.attachementDesc}).unwrap();b(!1),h(),S.success(f.message,{autoClose:2e3})}catch(f){console.log(f),S.error(((n=f==null?void 0:f.data)==null?void 0:n.message)||f.error,{autoClose:2e3})}};return e.jsxs("section",{className:"formContainer flex-col",children:[e.jsxs("form",{method:"POST",className:"grid grid--col-2",noValidate:!0,children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx(fe,{closeMenuOnSelect:!0,components:x,options:p,onChange:I,value:p.find(n=>n.value===(l==null?void 0:l.attachementTypeID)),name:"attachementTypeID",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"نوع پیوست"}),noOptionsMessage:H.noOptionsMessage,loadingMessage:H.loadingMessage,styles:ge,isLoading:R||t}),e.jsx("label",{className:l!=null&&l.attachementTypeID?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"نوع پیوست"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("textarea",{className:"inputBox__form--input",required:!0,name:"attachementDesc",id:"attachmentDesc",onChange:i,value:l.attachementDesc}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"attachmentDesc",children:"توضیحات"})]})]}),e.jsx("input",{type:"file",ref:v,style:{display:"none"},onChange:B,accept:"image/jpeg,image/gif,image/png,application/pdf,image/x-eps"}),e.jsx(O,{dir:"ltr",endIcon:e.jsx(De,{}),loading:q,"aria-label":"upload",onClick:r,variant:"contained",color:"primary",sx:{fontFamily:"sahel"},children:e.jsx("span",{children:"بارگزاری"})})]})}function Ae(){const[b,h]=s.useState(!1),[l,j]=s.useState({}),[m,T]=s.useState([]),[a,_]=s.useState(""),[N,g]=s.useState(!1),[y,x]=s.useState(null),C=W(),v=new URLSearchParams(C.search).get("requestID"),[u,{isLoading:R}]=je(),{data:t,isLoading:p,isSuccess:r,isFetching:B,error:I,refetch:i}=ye(v),F=()=>{i()},c=s.useMemo(()=>({toolbar:{prev:!1,next:!1,play:!1,stop:!1},title:o=>`(${o.naturalWidth} × ${o.naturalHeight})`,viewed(){this.viewer.scale(1.2)}}),[]);s.useEffect(()=>{if(i(),r){const o=t==null?void 0:t.itemList.map((d,E)=>({image:d.attachment,contentType:d.contentType,id:d.requestAttachmentID,attachmentsRowNum:E+1,attachmentDesc:d.attachementDesc||"-",attachementTypeName:d.attachementTypeName||"-"}));if(T(o),t.itemList.length&&t.itemList.length>0){const d=t.itemList[0].image,G=`data:${t.itemList[0].contentType};base64,`;x(`${G}${d}`)}}},[r,i,t]),s.useEffect(()=>{var o;I&&S.error(((o=I==null?void 0:I.data)==null?void 0:o.message)||I.error,{autoClose:2e3})},[I]);const n=()=>{g(!0)},f=()=>{h(!0)},w=async()=>{var o;try{const d=await u(a).unwrap();S.success(d.message,{autoClose:2e3}),h(!1),i()}catch(d){console.log(d),S.error(((o=d==null?void 0:d.data)==null?void 0:o.message)||d.error,{autoClose:2e3})}},z=s.useMemo(()=>[{accessorKey:"attachmentsRowNum",header:"ردیف",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({renderedCellValue:o})=>e.jsx("div",{children:A(o)})},{accessorKey:"attachementTypeName",header:"نام پیوست",size:20},{accessorKey:"attachmentDesc",header:"توضیحات",size:20},{accessorKey:"deleteAttachment",header:"حذف",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:o})=>e.jsx(L,{title:`حذف "${o.original.attachementTypeName}"`,children:e.jsx(D,{color:"error",sx:{padding:"0"},onClick:f,children:e.jsx(be,{})})})},{accessorKey:"observeAttachment",header:"مشاهده",enableSorting:!1,enableColumnActions:!1,muiTableBodyCellProps:{align:"center"},size:20,Cell:({row:o})=>e.jsx(L,{title:`مشاهده "${o.original.attachementTypeName}"`,children:e.jsx("span",{children:y?e.jsx(qe,{options:c,imageUrls:y,children:e.jsx(Be,{children:e.jsx(D,{sx:{padding:"0"},color:"info",children:e.jsx(Q,{color:"info"})})})}):e.jsx(D,{sx:{padding:"0"},color:"info",disabled:!0,children:e.jsx(Q,{color:"action"})})})})}],[c,y]),P=Y({...Z,columns:z,data:m,renderTopToolbarCustomActions:()=>e.jsxs(k,{children:[B?e.jsx(D,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(M,{size:20,value:100})}):e.jsx(L,{title:"بروز رسانی",children:e.jsx("span",{children:e.jsx(D,{"aria-label":"refresh",color:"info",onClick:F,children:e.jsx(J,{fontSize:"small"})})})}),B?e.jsx(D,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(M,{size:20,value:100,color:"success"})}):e.jsx(L,{title:"افزودن پیوست",children:e.jsx("span",{children:e.jsx(D,{"aria-label":"refresh",color:"success",onClick:n,children:e.jsx(ve,{fontSize:"small"})})})})]}),muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:o=>e.jsx(X,{...o,page:A(o.page),slots:{previous:ee,next:se,first:te,last:ae}})},muiTableBodyRowProps:({row:o})=>({onClick:()=>j(()=>({[o.id]:!0})),selected:l[o.id],sx:{cursor:"pointer"}}),getRowId:o=>o.id,onRowSelectionChange:j,state:{rowSelection:l}});return s.useEffect(()=>{const o=Object.keys(P.getState().rowSelection)[0];if(o){_(o);const d=Ne(m,o);if(d){const E=d.image,de=`data:${d.contentType};base64,`;x(`${de}${E}`)}}},[P,l,m]),e.jsx(e.Fragment,{children:p?e.jsx("div",{className:"skeleton-lg",children:e.jsx(ne,{count:5,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl"})}):e.jsxs(e.Fragment,{children:[N&&e.jsx(V,{title:"افزودن پیوست",closeModal:()=>g(!1),children:e.jsx(Pe,{setShowInsertAttachmentModal:g,refetch:i})}),b&&e.jsxs(V,{title:"حذف پیوست",closeModal:()=>h(!1),children:[e.jsx("p",{className:"paragraph-primary",children:"آیا از حذف این پیوست اطمینان دارید؟"}),e.jsxs("div",{className:"flex-row flex-center",children:[e.jsx(O,{dir:"ltr",endIcon:e.jsx(oe,{}),loading:R,onClick:w,variant:"contained",color:"success",sx:{fontFamily:"sahel"},children:e.jsx("span",{children:"بله"})}),e.jsx(le,{dir:"ltr",endIcon:e.jsx(Se,{}),disabled:R,onClick:()=>h(!1),variant:"contained",color:"error",sx:{fontFamily:"sahel"},children:e.jsx("span",{children:"خیر"})})]})]}),e.jsx(re,{table:P})]})})}function Me({setShowModal:b,value:h}){const[l,j]=s.useState(" "),[m,T]=s.useState(""),[a,_]=s.useState([]),N=$(),g=new URLSearchParams(location.search),y=g.get("requestID"),x=g.get("Role"),C=g.get("type"),[q,{isLoading:v}]=ie(),{data:u,isSuccess:R,isLoading:t,isFetching:p,error:r}=Ce({RequestID:y,conditionValue:h,Role:x});s.useEffect(()=>{R&&_(u.itemList)},[R,u]),s.useEffect(()=>{var c;r&&(console.log(r),S.error(((c=r==null?void 0:r.data)==null?void 0:c.message)||r.error,{autoClose:2e3}))},[r]);const B=c=>{j(c.target.value)},I=c=>{T(c.target.value)},i=async()=>{var c;try{const n=await q({requestid:y,conditionValue:h,expertUserID:l,role:x,requestTypeID:C,description:m});b(!1),S.success(n.data.message,{autoClose:2e3}),N("/retirement/cartable")}catch(n){console.log(n),S.error(((c=n==null?void 0:n.data)==null?void 0:c.message)||n.error,{autoClose:2e3})}};return e.jsx(e.Fragment,{children:t||p?e.jsx(k,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(M,{color:"primary"})}):e.jsx("section",{className:"formContainer flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",noValidate:!0,children:[e.jsxs("div",{className:"flex-col",children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsxs("select",{className:"inputBox__form--input",required:!0,id:"expertList",onChange:B,value:l,disabled:v,style:{height:"40px",width:"180px"},children:[e.jsx("option",{value:" ",disabled:!0,children:"انتخاب کنید"}),a==null?void 0:a.map(c=>e.jsxs("option",{value:c.userID,children:[c.firstName," ",c.lastName]},c.userID))]}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"expertList",children:"لیست کارشناسان"})]}),e.jsx("div",{}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("textarea",{className:"inputBox__form--input",required:!0,id:"expertDescription",onChange:I,value:m,disabled:v,style:{overflow:"hidden",width:"400px"}}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"expertDescription",children:"توضیحات"})]})]}),e.jsx("div",{style:{marginRight:"auto"},children:e.jsx(O,{dir:"ltr",loading:t,endIcon:e.jsx(oe,{}),onClick:i,disabled:l===" "||v,variant:"contained",color:"success",sx:{fontFamily:"sahel"},children:e.jsx("span",{children:"تایید"})})})]})})})}function ke(){const[b,h]=s.useState(!1),[l,j]=s.useState(null),[m,T]=s.useState(null),[a,_]=s.useState(null),N=new URLSearchParams(location.search),g=N.get("Role"),y=N.get("requestID"),x=N.get("type"),[C,{isLoading:q}]=ie(),v=$(),{data:u,isSuccess:R,isLoading:t,isFetching:p,error:r}=Re({Role:g,requestID:y});s.useEffect(()=>{R&&(_(u==null?void 0:u.itemList[0]),T(u==null?void 0:u.itemList[0].conditions))},[R,u==null?void 0:u.itemList,T]),s.useEffect(()=>{var i;r&&(console.log(r),S.error(((i=r==null?void 0:r.data)==null?void 0:i.message)||r.error,{autoClose:2e3}))},[r]);const B=async(i,F)=>{var c;if(console.log(i,F),j(i),F!==1e3)h(!0);else try{const n=await C({requestid:y,conditionValue:i,role:g,requestTypeID:x});v("/retirement/cartable"),S.success(n.data.message,{autoClose:2e3})}catch(n){console.log(n),S.error(((c=n==null?void 0:n.data)==null?void 0:c.message)||n.error,{autoClose:2e3})}};return e.jsxs(e.Fragment,{children:[t||p?e.jsx(k,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(M,{color:"primary"})}):e.jsxs("section",{className:"formContainer flex-col",children:[e.jsxs("form",{method:"POST",className:"grid grid--col-5",children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",id:"requNO",disabled:!0,value:A(a==null?void 0:a.requestNO)||"-",className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"reqNum",className:"inputBox__form--label",children:"شماره درخواست"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",id:"reqDate",disabled:!0,value:ce(a==null?void 0:a.requestDate),className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"reqdate",className:"inputBox__form--label",children:"تاریخ"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",id:"reqFirstName",disabled:!0,value:(a==null?void 0:a.personFirstName)||"-",className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"rqName",className:"inputBox__form--label",children:"نام"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",id:"reqLastName",disabled:!0,value:(a==null?void 0:a.personLastName)||"-",className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"rqfName",className:"inputBox__form--label",children:"نام خانوادگی"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",id:"reqType",value:(a==null?void 0:a.requestTypeNameFa)||"-",disabled:!0,className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"rqType",className:"inputBox__form--label",children:"نوع درخواست"})]}),e.jsxs("div",{className:"inputBox__form col-span-5 row-span-3",children:[e.jsx("textarea",{disabled:!0,type:"text",id:"reqText",value:(a==null?void 0:a.requestText)||"-",className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"reqText",className:"inputBox__form--label",children:"متن درخواست"})]})]}),e.jsxs("div",{style:{marginRight:"auto"},className:"flex-row",children:[e.jsx(le,{dir:"ltr",endIcon:e.jsx(Le,{}),variant:"contained",color:"primary",sx:{fontFamily:"Vazir"},children:e.jsx("span",{children:"چاپ"})}),m==null?void 0:m.map(i=>e.jsx(O,{dir:"ltr",endIcon:e.jsx(Fe,{}),variant:"contained",loading:i.nextSate===1e3?q:!1,onClick:()=>B(i.conditionValue,i.nextSate),color:"primary",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:i.buttonName})},i.buttonName))]})]}),b&&e.jsxs(V,{closeModal:()=>h(!1),children:[e.jsx("div",{className:"flex-row flex-center",children:e.jsx("p",{className:"paragraph-primary",children:"کارشناس مورد نظر را انتخاب کنید"})}),e.jsx(Me,{setShowModal:h,value:l})]})]})}function ze(){const[b,h]=s.useState({}),[l,j]=s.useState([]),m=W(),a=new URLSearchParams(m.search).get("requestID"),{data:_,isLoading:N,isSuccess:g,isFetching:y,error:x,refetch:C}=Ie(a),q=()=>{C()};s.useEffect(()=>{if(C(),g){const t=_.itemList.map((p,r)=>({historyRowNum:r+1,historyUser:p.firstName+" "+p.lastName||"-",roleName:p.roleName||"-",historyDate:p.date||"-",historyDesc:p.description||"-",historyStateName:p.stateName||"-",historyCondition:p.accept||"-"}));j(t)}},[g,C,_]),s.useEffect(()=>{var t;x&&S.error(((t=x==null?void 0:x.data)==null?void 0:t.message)||x.error,{autoClose:2e3})},[x]);const v=s.useMemo(()=>[{accessorKey:"historyRowNum",header:"ردیف",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:A(t)})},{accessorKey:"historyUser",header:"کاربر",size:20},{accessorKey:"roleName",header:"نقش",size:20},{accessorKey:"historyDate",header:"تاریخ",size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:ce(t)})},{accessorKey:"historyDesc",header:"شرح",size:20},{accessorKey:"historyStateName",header:"مرحله",size:20},{accessorKey:"historyCondition",header:"وضعیت",size:20}],[]),u=Y({...Z,columns:v,data:l,renderTopToolbarCustomActions:()=>e.jsx(k,{children:y?e.jsx(D,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(M,{size:20,value:100})}):e.jsx(L,{title:"بروز رسانی",children:e.jsx("span",{children:e.jsx(D,{"aria-label":"refresh",color:"info",onClick:q,children:e.jsx(J,{fontSize:"small"})})})})}),muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:t=>e.jsx(X,{...t,page:A(t.page),slots:{previous:ee,next:se,first:te,last:ae}})},muiTableBodyRowProps:({row:t})=>({onClick:()=>h(()=>({[t.id]:!0})),selected:b[t.id],sx:{cursor:"pointer"}}),getRowId:t=>t.id,onRowSelectionChange:h,state:{rowSelection:b}});return e.jsx(e.Fragment,{children:N?e.jsx("div",{className:"skeleton-lg",children:e.jsx(ne,{count:5,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl"})}):e.jsx(re,{table:u})})}function Ve(){const[b,h]=s.useState("1"),l=$(),j=(T,a)=>{h(a)};return e.jsx(e.Fragment,{children:e.jsxs("section",{className:"flex-col",children:[e.jsxs("div",{className:"title-primary--container flex-row flex-center",children:[e.jsxs("h4",{className:"title-primary",children:[e.jsx("span",{className:"title-primary--underline"})," اطلاعات درخواست"]}),e.jsx("div",{style:{marginRight:"auto"},className:"back-button",children:e.jsx(L,{title:"بازگشت",children:e.jsx("span",{children:e.jsx(D,{color:"primary",onClick:()=>l(-1),children:e.jsx(Te,{})})})})})]}),e.jsx("div",{children:e.jsxs(_e,{value:b,children:[e.jsx(k,{sx:{bgcolor:"background.paper",borderRadius:1},children:e.jsxs(we,{onChange:j,"aria-label":"tabs",children:[e.jsx(U,{label:"درخواست",value:"1"}),e.jsx(U,{label:"پیوست ها",value:"2"}),e.jsx(U,{label:"تاریخچه",value:"3"})]})}),e.jsx(K,{value:"1",sx:{padding:"0"},children:e.jsx(ke,{})}),e.jsx(K,{value:"2",sx:{padding:"0"},children:e.jsx(Ae,{})}),e.jsx(K,{value:"3",sx:{padding:"0"},children:e.jsx(ze,{})})]})})]})})}export{Ve as default};
