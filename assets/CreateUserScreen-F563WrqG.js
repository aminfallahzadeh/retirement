import{b6 as y,r as m,aV as R,A as x,u as S,j as e,an as T,b7 as q,b8 as F,d as I,Z as A,b9 as k,o as B,h as U,bb as E,b1 as G,a as v,w as M,X as D,D as d,I as L,ag as P}from"./index-Bx2CJIsO.js";import{f as V}from"./index-_9BQuZMG.js";function z({setAddedGroups:c}){const u=y(),[t,p]=m.useState({}),[h,a]=m.useState([]),{data:f,isLoading:b,isSuccess:j,error:i,refetch:g}=R();m.useEffect(()=>{if(g(),j){const l=f.itemList.map(s=>({id:s.id,name:s.groupName}));a(l)}},[f,j,g]),m.useEffect(()=>{var l;i&&(console.log(i),x.error(((l=i==null?void 0:i.data)==null?void 0:l.message)||i.error,{autoClose:2e3}))},[i]);const r=m.useMemo(()=>[{accessorKey:"name",header:"نام نقش",size:20}],[]),o=S({...A,columns:r,data:h,enableRowSelection:!0,enablePagination:!1,enableBottomToolbar:!1,muiTableContainerProps:{sx:{height:"250px"}},muiTableBodyRowProps:({row:l,staticRowIndex:s,table:n})=>({onClick:_=>k({row:l,staticRowIndex:s,table:n})(_),sx:{cursor:"pointer"}}),getRowId:l=>l.id,onRowSelectionChange:p,state:{rowSelection:t}});return m.useEffect(()=>{const l=o.getSelectedRowModel().rows;c(l.map(s=>s.original))},[o,t,c]),e.jsx(e.Fragment,{children:b?e.jsx("div",{className:"skeleton-lg",children:e.jsx(T,{count:7,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl"})}):e.jsx(q,{theme:F({...u,direction:"rtl"},V),children:e.jsx("div",{style:{direction:"rtl"},children:e.jsx(I,{table:o})})})})}function Z({addedGroups:c}){const u=B(),{register:t,handleSubmit:p,setValue:h,formState:{errors:a}}=U(),[f,{isLoading:b}]=E(),[j,{isLoading:i}]=G(),g=async r=>{var o,N,l;if(c.length===0)try{const s=await f({...r,mobile:d(r.mobiel),tel:d(r.tel),password:d(r.password),isActive:r.isActive==="true",sex:r.sex==="true"}).unwrap();x.success(s.message,{autoClose:2e3}),u("/retirement/users")}catch(s){console.log(s),x.error(((o=s==null?void 0:s.data)==null?void 0:o.message)||s.error,{autoClose:2e3})}else try{const s=await f({...r,mobile:d(r.mobiel),tel:d(r.tel),password:d(r.password),isActive:r.isActive==="true",sex:r.sex==="true"}).unwrap();try{const n=s.itemList[0].userID,_=c.map(C=>({id:"",userID:n,groupID:C.id,groupName:""})),w=await j(_).unwrap();x.success(w.message,{autoClose:2e3}),u("/retirement/users")}catch(n){console.log(n),x.error(((N=n==null?void 0:n.data)==null?void 0:N.message)||n.error,{autoClose:2e3})}}catch(s){console.log(s),x.error(((l=s==null?void 0:s.data)==null?void 0:l.message)||s.error,{autoClose:2e3})}};return e.jsx("section",{className:"formContainer",children:e.jsxs("form",{method:"POST",className:"flex-col",noValidate:!0,autoComplete:"off",onSubmit:p(g),children:[e.jsxs("div",{className:"grid grid--col-3",children:[e.jsxs("div",{className:"inputBox__form",children:[a.username&&e.jsx("span",{className:"error-form",children:a.username.message}),e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,autoComplete:"off",...t("username",{required:"نام کاربری را وارد کنید"}),id:"usrName"}),e.jsxs("label",{className:"inputBox__form--label",htmlFor:"usrName",children:[e.jsx("span",{children:"*"})," نام کاربری"]})]}),e.jsxs("div",{className:"inputBox__form",children:[a.password&&e.jsx("span",{className:"error-form",children:a.password.message}),e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,autoComplete:"off",...t("password",{required:"رمز عبور را وارد کنید",onChange:r=>{let o=v(r.target.value);h("password",o)}}),id:"pssw"}),e.jsxs("label",{className:"inputBox__form--label",htmlFor:"pssw",children:[e.jsx("span",{children:"*"})," رمز عبور"]})]}),e.jsxs("div",{className:"inputBox__form",children:[a.isActive&&e.jsx("span",{className:"error-form",children:a.isActive.message}),e.jsxs("select",{className:"inputBox__form--input",id:"isActive",...t("isActive",{required:"وضعیت را انتخاب کنید"}),required:!0,defaultValue:"",children:[e.jsx("option",{disabled:!0,value:"",children:"انتخاب"}),e.jsx("option",{value:"true",children:"فعال"}),e.jsx("option",{value:"false",children:"غیر فعال"})]}),e.jsxs("label",{className:"inputBox__form--combo-label",htmlFor:"isActive",children:[e.jsx("span",{children:"*"})," وضعیت"]})]}),e.jsxs("div",{className:"inputBox__form",children:[a.firstName&&e.jsx("span",{className:"error-form",children:a.firstName.message}),e.jsx("input",{type:"text",className:"inputBox__form--input",...t("firstName",{required:"نام را وارد کنید"}),required:!0,id:"nam"}),e.jsxs("label",{className:"inputBox__form--label",htmlFor:"nam",children:[e.jsx("span",{children:"*"})," نام"]})]}),e.jsxs("div",{className:"inputBox__form",children:[a.lastName&&e.jsx("span",{className:"error-form",children:a.lastName.message}),e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,...t("lastName",{required:"نام خانوادگی را وارد کنید"}),id:"namekh"}),e.jsxs("label",{className:"inputBox__form--label",htmlFor:"namekh",children:[e.jsx("span",{children:"*"})," نام خانوادگی"]})]}),e.jsxs("div",{className:"inputBox__form",children:[a.email&&e.jsx("span",{className:"error-form",children:a.email.message}),e.jsx("input",{type:"text",className:"inputBox__form--input",...t("email",{pattern:{value:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"ایمیل معتبر نیست"}}),required:!0,id:"postE"}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"postE",children:"پست الکترونیک"})]}),e.jsxs("div",{className:"inputBox__form",children:[a.sex&&e.jsx("span",{className:"error-form",children:a.sex.message}),e.jsxs("select",{className:"inputBox__form--input",id:"sex",required:!0,defaultValue:"",...t("sex",{required:"جنسیت را انتخاب کنید"}),children:[e.jsx("option",{value:"",disabled:!0,children:"انتخاب"}),e.jsx("option",{value:"true",children:"مرد"}),e.jsx("option",{value:"false",children:"زن"})]}),e.jsxs("label",{className:"inputBox__form--combo-label",htmlFor:"sex",children:[e.jsx("span",{children:"*"})," جنسیت"]})]}),e.jsxs("div",{className:"inputBox__form",children:[a.tel&&e.jsx("span",{className:"error-form",children:a.tel.message}),e.jsx("input",{type:"text",className:"inputBox__form--input",...t("tel",{pattern:{value:/^[0-9\u06F0-\u06F9]+$/,message:"تلفن ثابت معتبر نیست"},onChange:r=>{let o=v(r.target.value);h("tel",o)}}),required:!0,id:"Tell"}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"Tell",children:"پست الکترونیک"})]}),e.jsxs("div",{className:"inputBox__form",children:[a.mobile&&e.jsx("span",{className:"error-form",children:a.mobile.message}),e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"Cell",...t("mobile",{required:"تلفن همراه را وارد کنید",onChange:r=>{let o=v(r.target.value);h("mobile",o)}})}),e.jsxs("label",{className:"inputBox__form--label",htmlFor:"Cell",children:[e.jsx("span",{children:"*"})," تلفن همراه"]})]})]}),e.jsx("div",{style:{marginRight:"auto"},children:e.jsx(M,{dir:"ltr",endIcon:e.jsx(D,{}),loading:b||i,onClick:p,variant:"contained",type:"submit",color:"success",sx:{fontFamily:"sahel"},children:e.jsx("span",{children:"ذخیره"})})})]})})}function H(){const[c,u]=m.useState([]),t=B();return e.jsxs("section",{className:"flex-col",children:[e.jsxs("div",{className:"title-primary--container flex-row flex-center",children:[e.jsxs("h4",{className:"title-primary",children:[e.jsx("span",{className:"title-primary--underline"})," ایجاد کاربر جدید"]}),e.jsx("div",{style:{marginRight:"auto"},className:"back-button",children:e.jsx(L,{color:"primary",onClick:()=>t(-1),children:e.jsx(P,{})})})]}),e.jsxs("div",{className:"flex-row flex-center",style:{alignItems:"flex-start"},children:[e.jsx(Z,{addedGroups:c}),e.jsx("div",{style:{width:"500px"},children:e.jsx(z,{setAddedGroups:u})})]})]})}export{H as default};
