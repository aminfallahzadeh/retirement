import{c as te,j as e,r as i,R as se,cs as ne,ct as re,cr as le,cu as ie,f as G,cv as oe,G as ce,u as v,m as R,h as D,eH as de,aJ as me,J as s,P as M,M as ue,Q as fe,K as P,N as _,dZ as z,eI as pe,eJ as xe,t as Y,eK as Ne,eL as U,i as k,c4 as q,B as J,C as Z,eM as $,eN as ye,eO as be,eP as K,eQ as L,eR as O,eS as T,eT as B,eU as he,eV as je,au as Se,eW as Ee,eX as Ie,eY as ge,eZ as Ce,e_ as Fe,e$ as Ae,f0 as Le,f1 as Oe,f2 as Te,br as qe,as as ve,f3 as Re}from"./index-BXRanfZW.js";import{j as De,a as Me}from"./useFetchLookUpData-DFdryhkg.js";import{c as H,S as Q}from"./SelectInput-CWc-MpZu.js";import{d as Pe,e as w}from"./fractionApi-CRpZHriF.js";import{C as W}from"./CustomCheckBox-C70av05l.js";import"./sharedApi-CsQBjjdz.js";import"./requestApi-302r380c.js";import"./react-select-animated.esm-Bj_tHo7l.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";const X=te(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),ee=()=>{i.useEffect(()=>{const t=n=>{if(n.key==="Enter"){const c=document.getElementById("authorize-form");c&&c.requestSubmit()}};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[])},_e=()=>[{accessorKey:"personnelStatementRowNo",header:se,size:20,enableSorting:!1,enableColumnActions:!1},{accessorKey:"personnelStatementSerial",header:ne,size:20},{accessorKey:"orderType",header:re,size:20},{accessorKey:"personnelStatementNumber",header:le,size:20},{accessorKey:"insertTime",header:ie,size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:G(t)})},{accessorKey:"personnelStatementRunDate",header:oe,size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:G(t)})}],ze=i.memo(({personID:t,handleRowSelect:n})=>{const[c,d]=i.useState([]),[a,{isLoading:l,isFetching:f}]=Pe(),o=_e(),x=i.useCallback(async()=>{const p=(await a({personID:t}).unwrap()).itemList.map((r,y)=>({id:r.personnelStatementSerial,personnelStatementRowNo:y+1,personnelStatementSerial:r.personnelStatementSerial||"-",orderType:r.orderType||"-",personnelStatementNumber:r.personnelStatementID||"-",insertTime:r.insertTime||"-",personnelStatementRunDate:r.personnelStatementRunDate||"-"}));d(p)},[a,t]);return i.useEffect(()=>{t?x():d([])},[t,x]),e.jsx(ce,{data:c,columns:o,isLoading:l,isFetching:f,scroll:!1,onRowSelect:n})}),Ye=()=>{const[t,n]=i.useState(null),[c,d]=i.useState(null),a=v(),l=R(),{control:f,handleSubmit:o,formState:{errors:x},trigger:j,watch:p,setValue:r}=D({}),y=p("personNationalCode"),[m,{isLoading:b,isFetching:S}]=de(),{personnelStatementOffTypes:u,personnelStatementOffTypesIsLoading:h}=De(),{organizations:E,organizationIsLoading:F}=Me({}),A=i.useMemo(()=>H(u,"personnelStatementOffTypeID","personnelStatementOffTypeName"),[u]),N=i.useMemo(()=>H(E,"organizationID","organizationName"),[E]),I=i.useCallback(C=>{d(C)},[]),ae=C=>{a(U({...C,serial:c})),l("/retirement/fraction/calculate/2")},V=i.useCallback(async()=>{const g=(await m({personNationalCode:me(y)}).unwrap()).itemList[0];g&&(r("personFirstName",g.personFirstName),r("personLastName",g.personLastName),r("personnelID",g.personnelID),n(g.personID))},[y,m,r]);return i.useEffect(()=>{y?(async()=>{await j("personNationalCode")?V():(r("personFirstName",""),r("personLastName",""),r("personnelID",""),n(null),d(null))})():(r("personFirstName",""),r("personLastName",""),r("personnelID",""),n(null),d(null))},[j,V,y,r]),ee(),e.jsx(e.Fragment,{children:e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:o(ae),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:M,rules:{...ue,...fe},required:!0,control:f,type:"text"}),e.jsx(s,{name:"personFirstName",label:P,required:!1,editable:!1,control:f,isLoading:b||S,type:"text"}),e.jsx(s,{name:"personLastName",label:_,required:!1,editable:!1,control:f,isLoading:b||S,type:"text"}),e.jsx(s,{name:"personnelID",label:z,required:!1,editable:!1,control:f,isLoading:b||S,type:"text"}),e.jsx(Q,{name:"statementType",control:f,label:pe,required:!1,isClearable:!0,options:A,isLoading:h,errors:x}),e.jsx(Q,{name:"organizationID",control:f,label:xe,required:!1,isClearable:!0,options:N,isLoading:F,errors:x})]}),e.jsx(ze,{personID:t,handleRowSelect:I}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(Y,{dir:"ltr",disabled:!c,endIcon:e.jsx(X,{}),variant:"contained",type:"submit",color:"success",children:e.jsx("span",{children:Ne})})})]})})})},Ue=()=>{const{fractionData:t}=k(m=>m.fraction),{control:n,handleSubmit:c,setValue:d,watch:a}=D({defaultValues:{personNationalCode:t==null?void 0:t.personNationalCode,personFirstName:t==null?void 0:t.personFirstName,personLastName:t==null?void 0:t.personLastName,personnelID:t==null?void 0:t.personnelID}}),l=a("delay"),f=v(),o=R(),[x,{isLoading:j}]=w(),p=i.useCallback(async()=>{var S,u;const m=await x({personNationalCode:t.personNationalCode,personnelStatementOffTypeID:((S=t==null?void 0:t.statementType)==null?void 0:S.value)||"0",organizationID:((u=t==null?void 0:t.organizationID)==null?void 0:u.value)||"0",numberOfInstallments:0,personnelStatementSerialNO:parseInt(t.serial),periods:null,save:!1}).unwrap(),b=m==null?void 0:m.itemList[0];Object.keys(b).forEach(h=>{typeof b[h]=="number"?d(h,q(b[h])):d(h,b[h])})},[x,t,d]),r=async m=>{f(U({...m,...t})),o("/retirement/fraction/calculate/3")};return i.useEffect(()=>{t?p():o("/retirement/fraction/calculate/1",{replace:!0})},[t,p,o]),ee(),e.jsx(e.Fragment,{children:j?e.jsx(J,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(Z,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:c(r),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:M,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"personFirstName",label:P,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"personLastName",label:_,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"personnelID",label:z,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"sumFraction",label:$,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"transportedPay",label:ye,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"Modal__header flex justify-center items-center",children:e.jsx("h4",{className:"title-secondary",children:be})}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:K})}),e.jsx(s,{name:"startYear",label:L,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startMonth",label:O,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startDay",label:T,editable:!1,required:!1,control:n,type:"text"}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:B})}),e.jsx(s,{name:"endYear",label:L,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endMonth",label:O,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endDay",label:T,editable:!1,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"ml-auto",children:e.jsx(W,{name:"delay",label:he,control:n})}),l&&e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:K})}),e.jsx(s,{name:"startYearDelay",label:L,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startMonthDelay",label:O,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startDayDelay",label:T,required:!1,control:n,type:"text"}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:B})}),e.jsx(s,{name:"endYearDelay",label:L,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endMonthDelay",label:O,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endDayDelay",label:T,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(Y,{dir:"ltr",endIcon:e.jsx(X,{}),variant:"contained",type:"submit",color:"success",children:e.jsx("span",{children:je})})})]})})})},Ve=()=>{const[t,n]=i.useState({}),c=R(),d=v(),{fractionData:a}=k(u=>u.fraction),{control:l,handleSubmit:f,setValue:o,watch:x}=D({defaultValues:{personNationalCode:a==null?void 0:a.personNationalCode,personFirstName:a==null?void 0:a.personFirstName,personLastName:a==null?void 0:a.personLastName,personnelID:a==null?void 0:a.personnelID}}),j=x("installment"),p=x("installmentAmount"),[r,{isLoading:y}]=w(),m=i.useCallback(async(u=!1,h=0)=>{var F,A;const E=await r({personNationalCode:a==null?void 0:a.personNationalCode,personnelStatementOffTypeID:((F=a==null?void 0:a.statementType)==null?void 0:F.value)||"0",organizationID:((A=a==null?void 0:a.organizationID)==null?void 0:A.value)||"0",numberOfInstallments:h,personnelStatementSerialNO:parseInt(a==null?void 0:a.serial),startYearDelay:parseInt(a==null?void 0:a.startYearDelay)||0,startMonthDelay:parseInt(a==null?void 0:a.startMonthDelay)||0,startDayDelay:parseInt(a==null?void 0:a.startDayDelay)||0,endYearDelay:parseInt(a==null?void 0:a.endYearDelay)||0,endMonthDelay:parseInt(a==null?void 0:a.endMonthDelay)||0,endDayDelay:parseInt(a==null?void 0:a.endDayDelay)||0,transportedPay:parseInt(a==null?void 0:a.transportedPay)||0,periods:null,save:u}).unwrap();if(u)d(U(null)),Se.success(E.message),c("/retirement/fraction/calculate/1");else{const N=E==null?void 0:E.itemList[0];n(N),Object.keys(N).forEach(I=>{typeof N[I]=="number"?o(I,q(N[I])):o(I,N[I])}),o("sumFractionOrganizationPercent",`%${q((N.sumFractionOrganization*100/N.sumFraction).toFixed(2))}`),o("sumFractionPersonnelPercent",`%${q((N.sumFractionPersonnel*100/N.sumFraction).toFixed(2))}`)}},[r,a,o,d,c]);i.useEffect(()=>{a?m():c("/retirement/fraction/calculate/1",{replace:!0})},[a,m,c]),i.useEffect(()=>{if(p&&t&&!isNaN(parseFloat(p))&&parseFloat(p)!==0){const u=(t.debtor/parseFloat(p)).toFixed(0);o("numberOfInstallments",u)}else o("numberOfInstallments","")},[p,t,o]);const b=u=>{m(!0,parseInt(u.numberOfInstallments))};return e.jsx(e.Fragment,{children:y?e.jsx(J,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(Z,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:f(b),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:M,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"personFirstName",label:P,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"personLastName",label:_,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"personnelID",label:z,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFraction",label:$,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionOrganizationPercent",label:Ee,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionPersonnelPercent",label:Ie,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionOrganization",label:ge,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionPersonnel",label:Ce,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"debtor",label:Fe,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"credit",label:Ae,editable:!1,required:!1,control:l,type:"text"}),e.jsx("div",{}),e.jsx(W,{name:"installment",label:Le,control:l}),j&&e.jsxs(e.Fragment,{children:[e.jsx(s,{name:"installmentAmount",label:Oe,control:l,type:"text"}),e.jsx(s,{name:"numberOfInstallments",label:Te,editable:!1,required:!1,control:l,type:"text"})]})]}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(Y,{dir:"ltr",endIcon:e.jsx(qe,{}),variant:"contained",loading:y,type:"submit",color:"success",children:e.jsx("span",{children:ve})})})]})})})},We=()=>{const{step:t}=Re();return(d=>{switch(d){case"1":return e.jsx(Ye,{});case"2":return e.jsx(Ue,{});case"3":return e.jsx(Ve,{});default:return null}})(t)};export{We as default};
