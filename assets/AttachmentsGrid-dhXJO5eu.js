import{R as U,gg as K,as as P,dO as w,j as e,T as E,I as h,O as L,E as v,B as k,C as G,gh as $,r as i,z,h as H,gi as V,M as F,t as W,dm as Q,aw as B,A as O,cf as Y,dP as J,G as X}from"./index-CRad3sE9.js";import{h as Z,i as ee,j as te}from"./requestApi-P45rVSbr.js";import{D as se}from"./DeleteOutline-BxTIN1MR.js";import{R as ae,a as ne,U as oe}from"./index-BuqOBxN2.js";import{A as ce}from"./Add-Bnl1OseK.js";import{c as re,S as ie}from"./SelectInput-CClIbL5j.js";import{T as le}from"./TextArea-DifUInWp.js";import{l as me}from"./useFetchLookUpData-afJ3SXZk.js";import"./react-select-animated.esm-DA9BtmsI.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./sharedApi-Bj4lfPKc.js";import"./personnelApi-CAou1wF1.js";import"./fractionApi-D6icoZPU.js";const de={toolbar:{prev:!1,next:!1,play:!1,stop:!1},title:s=>`(${s.naturalWidth} Ã— ${s.naturalHeight})`},he=s=>[{accessorKey:"attachmentsRowNo",header:U,size:20,enableSorting:!1,enableColumnActions:!1},{accessorKey:"attachmentTypeName",header:K,size:20},{accessorKey:"attachmentsDesc",header:P,size:20},{accessorKey:"deleteAttachment",header:w,enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:t})=>e.jsx(E,{title:`${w} "${t.original.attachmentTypeName}"`,children:e.jsx(h,{color:"error",sx:{padding:"0"},onClick:()=>s(t.original.id),children:e.jsx(se,{})})})},{accessorKey:"observeAttachment",header:L,enableSorting:!1,enableColumnActions:!1,muiTableBodyCellProps:{align:"center"},size:20,Cell:({row:t})=>e.jsx(E,{title:`${L} "${t.original.attachmentTypeName}"`,children:e.jsx("span",{children:t.original.image?e.jsx(ae,{options:de,imageUrls:t.original.image,children:e.jsx(ne,{children:e.jsx(h,{sx:{padding:"0"},color:"info",children:e.jsx(v,{color:"info"})})})}):e.jsx(h,{sx:{padding:"0"},color:"info",disabled:!0,children:e.jsx(v,{color:"action"})})})})}],pe=(s,t,o)=>e.jsx(k,{children:t||s?e.jsx(h,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(G,{size:20,value:100,color:"success"})}):e.jsx(E,{title:$,children:e.jsx("span",{children:e.jsx(h,{"aria-label":"refresh",color:"success",onClick:o,children:e.jsx(ce,{fontSize:"small"})})})})}),ue=({refetch:s,closeModal:t})=>{const o=i.useRef(null),[p]=z(),[l,u]=i.useState(!1),y=p.get("type"),A=p.get("requestID"),{control:g,handleSubmit:D,formState:{errors:c},watch:f}=H(),m=f(),[x,{isLoading:r}]=Z(),{requestAttachmentTypes:T,requestAttachmentTypesIsLoading:b}=me(y),I=i.useMemo(()=>re(T,"requestTypeAttachmentID","name"),[T]),C=async d=>{var j;const a=(j=d.target.files)==null?void 0:j[0];if(!a)return;const n=new FileReader,R=a.type.split("/")[1];u(!0),n.onloadend=async()=>{const M=n.result.split(",")[1],N=await x({attachementTypeID:m.attachementTypeID.value,requestID:A,contentType:R,attachment:M,attachementDesc:m.attachementDesc}).unwrap();B.success(N.message),s(),t(),u(!1)},n.readAsDataURL(a)},S=()=>{var d;(d=o.current)==null||d.click()};return e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:D(S),noValidate:!0,children:[e.jsx("input",{type:"file",ref:o,style:{display:"none"},onChange:C,accept:"image/jpeg,image/gif,image/png,application/pdf,image/x-eps"}),e.jsxs("div",{className:"grid grid-cols-1 mb-10",children:[e.jsx(ie,{name:"attachementTypeID",control:g,label:V,required:!0,isClearable:!0,rules:F,isDisabled:r,options:I,errors:c,isLoading:b}),e.jsx(le,{name:"attachementDesc",label:P,required:!0,rules:F,editable:!r,control:g,containerClassNames:"row-span-2"})]}),e.jsx("div",{className:"flex-row mr-auto",children:e.jsx(W,{dir:"ltr",endIcon:e.jsx(oe,{}),variant:"contained",color:"primary",type:"submit",disabled:l,loading:r,children:e.jsx("span",{children:Q})})})]})})},Ee=()=>{const[s]=z(),[t,o]=O(!1),[p,l]=O(!1),[u,y]=i.useState([]),[A,g]=i.useState(""),D=s.get("requestID"),{data:c,isLoading:f,isSuccess:m,isFetching:x,refetch:r}=ee(D),[T,{isLoading:b}]=te(),I=a=>{g(a),o()},C=async()=>{const a=await T(A).unwrap();r(),o(),B.success(a.message)};i.useEffect(()=>{if(m){const a=c==null?void 0:c.itemList.map((n,R)=>{const j=n.attachment,N=`${`data:${n.contentType};base64,`}${j}`;return{id:n.requestAttachmentID,image:N,attachmentsRowNo:R+1,attachmentTypeName:n.attachementTypeName||"-",attachmentsDesc:n.attachementDesc||"-"}});y(a)}},[m,c]);const S=he(I),q=pe(f,x,l);return e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:$,open:p,onClose:l,children:e.jsx(ue,{refetch:r,closeModal:l})}),e.jsx(J,{open:t,isLoading:b,onClose:o,handleRemove:C}),e.jsx(X,{data:u,columns:S,isLoading:f,isFetching:x,topBarActions:q,scroll:!1})]})};export{Ee as default};
