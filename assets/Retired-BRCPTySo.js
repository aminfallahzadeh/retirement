import{z as X,r as t,j as e,A as me,u as Ae,h as Ie,D as Re,F as Le,H as ge,B as ie,C as xe,J as n,K as Ue,M as T,N as Oe,P as ke,Q as Pe,S as _e,U as S,V as Fe,W as J,X as qe,Y as ve,Z as Be,_ as Me,$ as Ge,a0 as $e,a1 as we,a2 as He,a3 as Ve,a4 as ze,a5 as Ke,a6 as Qe,a7 as Ye,a8 as Je,a9 as We,aa as Ze,ab as Xe,ac as es,ad as ss,ae as as,af as ts,ag as ns,ah as rs,ai as os,aj as is,ak as ls,al as cs,am as ds,an as us,ao as ps,ap as ms,aq as Is,ar as xs,t as W,as as De,at as be,au as fe,i as Te,av as Ds,aw as bs,ax as fs,ay as ye,az as hs,aA as Ss,aB as js,aC as gs,aD as ys,aE as Es,aF as Ts,aG as Ns,aH as Cs,aI as As,aJ as q,aK as Rs,aL as Ls,aM as Us,aN as Os,aO as ks,aP as Ps,aQ as _s,aR as Fs,aS as g,aT as de,aU as ue,aV as pe,aW as qs,aX as ee,aY as vs,aZ as Bs,L as se,a_ as Ms,a$ as Gs,b0 as $s,b1 as ws,b2 as Hs,b3 as Vs,b4 as zs,b5 as Ks,b6 as Qs}from"./index-BXRanfZW.js";import{u as Ys,a as Js,c as Ws,F as Zs}from"./createTree-D2_tXgoI.js";import{T as Xs}from"./Title-ClnJkkID.js";import{c as y,S as E}from"./SelectInput-CWc-MpZu.js";import{p as Ne,D as oe,a as he}from"./convertFormData-DR4CgEZd.js";import{C as Y}from"./CustomCheckBox-C70av05l.js";import{T as Ee}from"./TextArea-BQIgssuj.js";import{D as Se}from"./DoneOutlined-DrF5VHs1.js";import{E as je}from"./EditOutlined-CLtBGvsa.js";import{u as k,a as ea,b as sa}from"./useFetchLookUpData-DFdryhkg.js";import{S as aa}from"./StatusHistoryGrid-DmebJrfm.js";import{u as ta}from"./sharedApi-CsQBjjdz.js";import{u as na}from"./useRouteMatch-DVwW4zOS.js";import{A as ae,a as te,b as ne,c as re}from"./ArrowDropDown-D4V2X1yR.js";import"./index-CFUFxWw7.js";import"./react-select-animated.esm-Bj_tHo7l.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./useCloseCalender-CHtWkg2S.js";import"./requestApi-302r380c.js";import"./fractionApi-CRpZHriF.js";const ra=()=>{const[s]=X(),[f,c]=t.useState([]),[h,U]=t.useState([]),m=s.get("personID"),{data:N,isLoading:a,isSuccess:I,refetch:u}=Ys(),{data:b,isLoading:r,isSuccess:x,refetch:d}=Js(m);t.useEffect(()=>{x&&U(b.itemList)},[x,b]),t.useEffect(()=>{if(I){const v=Ws(N.itemList);c(v)}},[I,N]);const j=t.useCallback(()=>{u(),d()},[u,d]);return e.jsx(Zs,{structure:f,files:h,isLoading:a||r,refetch:j,access:"files"})},oa=["personFirstName","personLastName","personNationalCode","personCertificateNo","personFatherName","genderID","personBirthDate","personBirthPlace","personPreviousNam","personIsSacrificedFamily","personIsWarrior","personIsChildOfSacrificed","personIsValiant","personIsSacrificed","personIsCaptive","retiredID","personPhone","personCellPhone","backupPhone","backupFirstName","backupLastName","personEmail","educationTypeID","personCountryID","personStateID","personCityID","personRegion","personArea","personPostalCode","housingTypeID","maritalStatusID","personDeathDate","personAddress","personDescription"],ia=["retiredGroup","retiredOrganizationID","retiredLastPosition","employmentTypeID","retirementDate","pensionaryStatusID","pensionaryStartdate","retiredJobDegreeCoef","retiredGrantDuration","retiredRealDuration"],la=["bankID","bankBranchID","accountNo","ledgerCode","insuranceCoef","insuranceAmount"],ca=()=>{const[s,f]=me(!1),[c]=X(),h=Ae(),U=c.get("personID"),m=t.useMemo(()=>["genderID","personCountryID","personStateID","personCityID","housingTypeID","educationTypeID","maritalStatusID"],[]),N=t.useMemo(()=>["personDeathDate","personBirthDate"],[]),{control:a,handleSubmit:I,formState:{errors:u},setValue:b}=Ie(),{data:r,isLoading:x,isFetching:d,isSuccess:j,refetch:v}=Re(U),[P,{isLoading:$}]=Le(),{lookUpItems:C,lookUpItemsIsLoading:w}=k({lookUpType:"Gender"}),R=t.useMemo(()=>y(C,"lookUpID","lookUpName"),[C]),{lookUpItems:D,lookUpItemsIsLoading:L}=k({lookUpType:"EducationType"}),B=t.useMemo(()=>y(D,"lookUpID","lookUpName"),[D]),{lookUpItems:H,lookUpItemsIsLoading:V}=k({lookUpType:"Country"}),M=t.useMemo(()=>y(H,"lookUpID","lookUpName"),[H]),{lookUpItems:G,lookUpItemsIsLoading:z}=k({lookUpType:"State"}),_=t.useMemo(()=>y(G,"lookUpID","lookUpName"),[G]),{lookUpItems:Z,lookUpItemsIsLoading:o}=k({lookUpType:"City"}),A=t.useMemo(()=>y(Z,"lookUpID","lookUpName"),[Z]),{lookUpItems:F,lookUpItemsIsLoading:le}=k({lookUpType:"HousingType"}),p=t.useMemo(()=>y(F,"lookUpID","lookUpName"),[F]),{lookUpItems:l,lookUpItemsIsLoading:i}=k({lookUpType:"MaritialStatus"}),ce=t.useMemo(()=>y(l,"lookUpID","lookUpName"),[l]),Ce=async K=>{const Q=he(K,m,N),O=await P(Q).unwrap();v(),f(),fe.success(O.message)};return t.useEffect(()=>{if(j){const K=r==null?void 0:r.itemList[0];h(ge((K==null?void 0:K.personDeathDate)!==null));const Q=Ne(K,m,N,{genderID:R,educationTypeID:B,personCountryID:M,personStateID:_,personCityID:A,housingTypeID:p,maritalStatusID:ce});Object.keys(Q).forEach(O=>{oa.includes(O)&&Q[O]===null?b(O,""):b(O,Q[O])})}return()=>{h(ge(null))}},[h,j,r==null?void 0:r.itemList,b,R,M,B,_,A,p,ce,N,m]),e.jsx(e.Fragment,{children:x||d?e.jsx(ie,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(xe,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:I(Ce),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(n,{name:"personFirstName",label:Ue,rules:T,required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personLastName",label:Oe,rules:T,required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personNationalCode",label:ke,rules:{...Pe,...T},required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personCertificateNo",label:_e,rules:{...S,...T},required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personFatherName",label:Fe,rules:J,required:!0,control:a,editable:s,type:"text"}),e.jsx(E,{name:"genderID",control:a,label:qe,required:!0,isClearable:!0,isDisabled:!s,options:R,isLoading:w,rules:T,errors:u}),e.jsx(oe,{name:"personBirthDate",label:ve,control:a,disabled:!s,required:!0,errors:u,rules:T,setValue:b}),e.jsx(n,{name:"personBirthPlace",label:Be,rules:J,required:!1,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personPreviousName",label:Me,rules:J,required:!1,control:a,editable:s,type:"text"}),e.jsxs("div",{className:s?"checkboxContainer col-span-3":"checkboxContainer--disabled col-span-3",children:[e.jsx("p",{className:"inputBox__form--readOnly-label",children:Ge}),e.jsx(Y,{disabled:!s,control:a,label:$e,name:"personIsSacrificedFamily"}),e.jsx(Y,{disabled:!s,control:a,label:we,name:"personIsWarrior"}),e.jsx(Y,{disabled:!s,control:a,label:He,name:"personIsChildOfSacrificed"}),e.jsx(Y,{disabled:!s,control:a,label:Ve,name:"personIsValiant"}),e.jsx(Y,{disabled:!s,control:a,label:ze,name:"personIsSacrificed"}),e.jsx(Y,{disabled:!s,control:a,label:Ke,name:"personIsCaptive"})]}),e.jsx(n,{name:"retiredID",label:Qe,required:!1,control:a,editable:!1,type:"text"}),e.jsx(n,{name:"personPhone",label:Ye,required:!1,rules:S,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personCellPhone",label:Je,required:!1,rules:We,control:a,editable:s,type:"text"}),e.jsx(n,{name:"backupPhone",label:Ze,required:!1,rules:S,control:a,editable:s,type:"text"}),e.jsx(n,{name:"backupFirstName",label:Xe,required:!1,rules:J,control:a,editable:s,type:"text"}),e.jsx(n,{name:"backupLastName",label:es,required:!1,rules:J,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personEmail",label:ss,required:!1,rules:as,control:a,editable:s,type:"text"}),e.jsx(E,{name:"educationTypeID",control:a,label:ts,required:!1,isClearable:!0,isDisabled:!s,options:B,isLoading:L}),e.jsx(E,{name:"personCountryID",control:a,label:ns,required:!1,isClearable:!0,isDisabled:!s,options:M,isLoading:V}),e.jsx(E,{name:"personStateID",control:a,label:rs,required:!1,isClearable:!0,isDisabled:!s,options:_,isLoading:z}),e.jsx(E,{name:"personCityID",control:a,label:os,required:!1,isClearable:!0,isDisabled:!s,options:A,isLoading:o}),e.jsx(n,{name:"personRegion",label:is,required:!1,control:a,editable:s,rules:S,type:"text"}),e.jsx(n,{name:"personArea",label:ls,required:!1,control:a,editable:s,rules:S,type:"text"}),e.jsx(n,{name:"personPostalCode",label:cs,required:!1,control:a,editable:s,rules:ds,type:"text"}),e.jsx(E,{name:"housingTypeID",control:a,label:us,required:!1,isClearable:!0,isDisabled:!s,options:p,isLoading:le}),e.jsx(E,{name:"maritalStatusID",control:a,label:ps,required:!1,isClearable:!0,isDisabled:!s,options:ce,isLoading:i}),e.jsx(oe,{name:"personDeathDate",label:ms,control:a,disabled:!s,required:!1,setValue:b}),e.jsx(Ee,{name:"personAddress",label:Is,required:!0,control:a,editable:s,containerClassNames:"col-span-3"}),e.jsx(Ee,{name:"personDescription",label:xs,required:!0,control:a,editable:s,containerClassNames:"col-span-4 row-span-2"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(W,{dir:"ltr",endIcon:e.jsx(Se,{}),disabled:!s,variant:"contained",type:"submit",loading:$,color:"success",children:e.jsx("span",{children:De})}),e.jsx(W,{dir:"ltr",endIcon:e.jsx(je,{}),onClick:f,disabled:s,variant:"contained",color:"primary",children:e.jsx("span",{children:be})})]})]})})})},da=()=>{const[s,f]=t.useState([]),[c,h]=me(!1),[U]=X(),m=U.get("personID"),{personDeathDate:N}=Te(p=>p.person),a=t.useMemo(()=>["retiredOrganizationID","employmentTypeID","pensionaryStatusID"],[]),I=t.useMemo(()=>["retirementDate","pensionaryStartdate"],[]),{control:u,handleSubmit:b,formState:{errors:r},setValue:x}=Ie(),{data:d,isSuccess:j,isLoading:v,isFetching:P,refetch:$}=Ds(m),{data:C,isSuccess:w,isLoading:R,isFetching:D,refetch:L}=bs(m),[B,{isLoading:H}]=fs(),{organizations:V,organizationIsLoading:M}=ea({}),{lookUpItems:G,lookUpItemsIsLoading:z}=k({lookUpType:"EmploymentType"}),{pensionaryStatus:_,pensionaryStatusIsLoading:Z}=sa({pensionaryStatusCategory:"R",pensionaryStatusIsDead:N}),o=t.useMemo(()=>y(V,"organizationID","organizationName"),[V]),A=t.useMemo(()=>y(G,"lookUpID","lookUpName"),[G]),F=t.useMemo(()=>y(_,"pensionaryStatusID","pensionaryStatusName"),[_]);t.useEffect(()=>{if(j){const p=d==null?void 0:d.itemList[0];if(p){const l={...p};Object.keys(l).forEach(i=>{i==="retirementDate"&&(l[i]=l[i]===null?null:ye(l[i])),i==="pensionaryStartdate"&&(l[i]=l[i]===null?null:ye(l[i])),x(i,l[i])})}}},[j,d==null?void 0:d.itemList,x]);const le=async p=>{const l=he(p,a,I),i=await B({...l,retiredGroup:parseInt(q(p.retiredGroup)),retiredJobDegreeCoef:parseInt(q(p.retiredJobDegreeCoef)),retiredRealDuration:parseInt(q(p.retiredRealDuration)),retiredGrantDuration:parseInt(q(p.retiredGrantDuration)),personID:m}).unwrap();h(),$(),L(),fe.success(i.message)};return t.useEffect(()=>{if(j){const p=d==null?void 0:d.itemList[0],l=Ne(p,a,I,{retiredOrganizationID:o,employmentTypeID:A,pensionaryStatusID:F});Object.keys(l).forEach(i=>{ia.includes(i)&&l[i]===null?x(i,""):x(i,l[i])})}},[j,d==null?void 0:d.itemList,o,A,F,x,a,I]),t.useEffect(()=>{if(w){const p=C==null?void 0:C.itemList.map((l,i)=>({id:l.pensionaryID,isActive:l.pensionaryIsActive,pensionaryStatusRowNum:i+1,pensionaryStatusName:l.pensionaryStatusName||"-",pensionaryStartdate:l.pensionaryStartdate||"-"}));f(p)}},[w,C==null?void 0:C.itemList]),e.jsx(e.Fragment,{children:v||P?e.jsx(ie,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(xe,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:b(le),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(n,{name:"retiredGroup",label:hs,control:u,required:!0,editable:c,rules:{...T,...S},type:"text"}),e.jsx(E,{name:"retiredOrganizationID",control:u,label:Ss,required:!0,isClearable:!0,isDisabled:!c,options:o,isLoading:M,rules:T,errors:r}),e.jsx(n,{name:"retiredLastPosition",label:js,control:u,required:!1,editable:c,rules:J,type:"text"}),e.jsx(E,{name:"employmentTypeID",control:u,label:gs,required:!0,isClearable:!0,isDisabled:!c,options:A,isLoading:z,rules:T,errors:r}),e.jsx(oe,{name:"retirementDate",label:ys,control:u,disabled:!c,required:!1,errors:r,rules:T,setValue:x}),e.jsx(E,{name:"pensionaryStatusID",control:u,label:Es,required:!0,isClearable:!0,isDisabled:!c,options:F,isLoading:Z,rules:T,errors:r}),e.jsx(oe,{name:"pensionaryStartdate",label:Ts,control:u,disabled:!c,required:!0,errors:r,rules:T,setValue:x}),e.jsx(n,{name:"retiredJobDegreeCoef",label:Ns,control:u,required:!1,editable:c,rules:S,type:"text"}),e.jsx(n,{name:"retiredGrantDuration",label:Cs,control:u,required:!1,editable:c,rules:S,type:"text"}),e.jsx(n,{name:"retiredRealDuration",label:As,control:u,required:!1,editable:c,rules:S,type:"text"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(W,{dir:"ltr",endIcon:e.jsx(Se,{}),disabled:!c,variant:"contained",type:"submit",loading:H,color:"success",children:e.jsx("span",{children:De})}),e.jsx(W,{dir:"ltr",endIcon:e.jsx(je,{}),onClick:h,disabled:c,variant:"contained",color:"primary",children:e.jsx("span",{children:be})})]}),e.jsx("div",{className:"flex-col flex-center",children:e.jsx("h5",{className:"title-secondary",children:"تاریخچه وضعیت ها"})}),e.jsx(aa,{data:s,isLoading:R,isFetching:D})]})})})},ua=()=>{const[s,f]=me(!1),[c,h]=t.useState([]),[U]=X(),m=U.get("personID"),N=t.useMemo(()=>["bankID","bankBranchID"],[]),a=t.useMemo(()=>[],[]),{control:I,handleSubmit:u,formState:{errors:b},setValue:r,watch:x}=Ie(),d=x("bankID"),{lookUpItems:j,lookUpItemsIsLoading:v}=k({lookUpType:"Bank"}),P=t.useMemo(()=>y(j,"lookUpID","lookUpName"),[j]),[$,{isLoading:C,isFetching:w}]=ta(),R=t.useMemo(()=>y(c,"lookUpID","lookUpName"),[c]),{data:D,isSuccess:L,isLoading:B,isFetching:H,refetch:V}=Rs(m),[M,{isLoading:G}]=Ls(),z=t.useCallback(async o=>{const A=await $({lookUpType:"BankBranch",lookUpParentID:o}).unwrap();h(A.itemList)},[$]),_=async o=>{const A=he(o,N,a),F=await M({...A,accountNo:q(o.accountNo)||null,ledgerCode:parseInt(q(o.ledgerCode))||null,insuranceAmount:parseFloat(q(o.insuranceAmount))||null,insuranceCoef:parseFloat(q(o.insuranceCoef))||null,personID:m}).unwrap();V(),f(),fe.success(F.message)};return t.useEffect(()=>{d?z(d.value):(r("bankBranchID",null),h([]))},[d,z,r]),t.useEffect(()=>{L&&({...D},Object.keys(D).forEach(o=>{la.includes(o)&&D[o]===null?r(o,""):r(o,D[o])}))},[L,D,r]),t.useEffect(()=>{L&&P.length>0&&r("bankID",P.find(o=>o.value===D.bankID))},[L,D,r,P]),t.useEffect(()=>{L&&R.length>0&&r("bankBranchID",R.find(o=>o.value===D.bankBranchID))},[L,D,r,R]),e.jsx(e.Fragment,{children:B||H?e.jsx(ie,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(xe,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:u(_),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(E,{name:"bankID",control:I,label:Us,required:!1,isClearable:!0,isDisabled:!s,options:P,isLoading:v,errors:b}),e.jsx(E,{name:"bankBranchID",control:I,label:Os,required:!1,isClearable:!0,isDisabled:!s,options:R,isLoading:C||w,errors:b}),e.jsx(n,{name:"accountNo",label:ks,rules:S,required:!1,control:I,editable:s,type:"text"}),e.jsx(n,{name:"ledgerCode",label:Ps,rules:S,required:!1,control:I,editable:s,type:"text"}),e.jsx(n,{name:"insuranceCoef",label:_s,rules:S,required:!1,control:I,editable:s,type:"text"}),e.jsx(n,{name:"insuranceAmount",label:Fs,rules:S,required:!1,control:I,editable:s,type:"text"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(W,{dir:"ltr",endIcon:e.jsx(Se,{}),disabled:!s,variant:"contained",type:"submit",loading:G,color:"success",children:e.jsx("span",{children:De})}),e.jsx(W,{dir:"ltr",endIcon:e.jsx(je,{}),onClick:f,disabled:s,variant:"contained",color:"primary",children:e.jsx("span",{children:be})})]})]})})})},pa=()=>{const[s]=X(),f=na([`${g}/${de}`,`${g}/${ue}`,`${g}/${pe}`,g]),c=s.toString(),{personDeathDate:h}=Te(a=>a.person),U=f==null?void 0:f.pattern.path,m=a=>c?`${a}?${c}`:a;return e.jsxs("div",{children:[e.jsx(ie,{sx:{bgcolor:"background.paper",borderRadius:1},children:e.jsxs(qs,{value:U,children:[e.jsx(ee,{label:h?vs:Bs,value:g,to:m(g),component:se}),e.jsx(ee,{label:Ms,value:`${g}/${de}`,to:m(`${g}/${de}`),component:se}),e.jsx(ee,{label:Gs,value:`${g}/${pe}`,to:m(`${g}/${pe}`),component:se}),e.jsx(ee,{label:$s,value:`${g}/${ue}`,to:m(`${g}/${ue}`),component:se})]})}),e.jsx(ws,{})]})},_a=()=>e.jsxs("section",{className:"flex-col mb-20",children:[e.jsx(Xs,{title:Hs,back:!0}),e.jsxs("div",{"data-name":"retired-forms",children:[e.jsxs(ae,{children:[e.jsx(te,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(ne,{}),children:Vs}),e.jsx(re,{children:e.jsx(ca,{})})]}),e.jsxs(ae,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(te,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(ne,{}),children:zs}),e.jsx(re,{children:e.jsx(da,{})})]}),e.jsxs(ae,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(te,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(ne,{}),children:Ks}),e.jsx(re,{children:e.jsx(ua,{})})]}),e.jsxs(ae,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(te,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(ne,{}),children:Qs}),e.jsx(re,{children:e.jsx(ra,{})})]})]}),e.jsx(pa,{})]});export{_a as default};
