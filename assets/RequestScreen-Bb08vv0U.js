import{c as W,j as e,r as s,q as S,n as U,U as J,x as F,T as A,I as D,E as H,z as X,V as he,B as z,C as M,P as Y,A as Z,D as ee,F as se,J as te,W as ae,X as ne,m as ue,M as oe,h as $,y as re,bS as xe,bg as O}from"./index-D5O08BPJ.js";import{c as pe,d as fe,e as ge,f as le,g as je,b as ye,h as be}from"./requestApi-DEYOrvZu.js";import{M as K}from"./Modal-Cg-uKm8t.js";import{d as Ne}from"./useFetchLookUpData-vUaeW5m0.js";import{i as ve,S as Se}from"./react-select-animated.esm-oIOjkK6l.js";import{o as Ce,s as Q,a as Re}from"./reactSelect-BGq5yAQc.js";import{U as Ie,R as Te,a as _e}from"./index-DMJ-kSWC.js";import{S as ie}from"./index-CoSNSaIW.js";/* empty css                 */import{d as ce}from"./table-options-KI-Hc6NO.js";import{D as we}from"./DeleteOutline-CXB_s4Tu.js";import{R as de}from"./Refresh-tyJRA3oQ.js";import{A as De}from"./Add-oW1hBchJ.js";import{T as qe,a as Be,b as V}from"./TabPanel-4WXBuATA.js";import"./sharedApi-CaE9KaRJ.js";const Le=W(e.jsx("path",{d:"m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z"}),"ArrowUpwardOutlined"),Ae=W(e.jsx("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3m-3 11H8v-5h8zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-1-9H6v4h12z"}),"Print");function Pe({setShowInsertAttachmentModal:b,refetch:m}){const[r,j]=s.useState({}),[u,T]=s.useState(null),[a,_]=s.useState(null),N=new URLSearchParams(location.search),g=N.get("type"),y=N.get("requestID"),x=ve(),[C,{isLoading:q}]=pe(),v=s.useRef(null),{requestAttachmentTypes:h,requestAttachmentTypesIsLoading:R,requestAttachmentTypesIsFetching:t}=Ne(g),p=Ce(h,"requestTypeAttachmentID","name"),l=()=>{v.current.click()},B=n=>{const f=n.target.files[0],w=new FileReader;_(f.type.split("/")[1]),w.onloadend=()=>{const P=w.result.split(",")[1];T(P)},w.readAsDataURL(f)};s.useEffect(()=>{u!==null&&L()},[u]);const I=(n,f)=>{const{name:w}=f;if(n){const{value:k}=n;j({...r,[w]:k||""})}else j({...r,[w]:null})},i=n=>{const{name:f,value:w}=n.target;j({...r,[f]:w})},L=async()=>{var n;try{const f=await C({attachementTypeID:r.attachementTypeID,requestID:y,contentType:a,attachment:u,attachementDesc:r.attachementDesc}).unwrap();b(!1),m(),S.success(f.message,{autoClose:2e3})}catch(f){console.log(f),S.error(((n=f==null?void 0:f.data)==null?void 0:n.message)||f.error,{autoClose:2e3})}};return e.jsxs("section",{className:"formContainer flex-col",children:[e.jsxs("form",{method:"POST",className:"grid grid--col-2",noValidate:!0,children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx(Se,{closeMenuOnSelect:!0,components:x,options:p,onChange:I,value:p.find(n=>n.value===(r==null?void 0:r.attachementTypeID)),name:"attachementTypeID",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"نوع پیوست"}),noOptionsMessage:Q.noOptionsMessage,loadingMessage:Q.loadingMessage,styles:Re,isLoading:R||t}),e.jsx("label",{className:r!=null&&r.attachementTypeID?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"نوع پیوست"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("textarea",{className:"inputBox__form--input",required:!0,name:"attachementDesc",id:"attachmentDesc",onChange:i,value:r.attachementDesc}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"attachmentDesc",children:"توضیحات"})]})]}),e.jsx("input",{type:"file",ref:v,style:{display:"none"},onChange:B,accept:"image/jpeg,image/gif,image/png,application/pdf,image/x-eps"}),e.jsx(U,{dir:"ltr",endIcon:e.jsx(Ie,{}),loading:q,"aria-label":"upload",onClick:l,variant:"contained",color:"primary",children:e.jsx("span",{children:"بارگزاری"})})]})}function Fe(){const[b,m]=s.useState(!1),[r,j]=s.useState({}),[u,T]=s.useState([]),[a,_]=s.useState(""),[N,g]=s.useState(!1),[y,x]=s.useState(null),C=J(),v=new URLSearchParams(C.search).get("requestID"),[h,{isLoading:R}]=fe(),{data:t,isLoading:p,isSuccess:l,isFetching:B,error:I,refetch:i}=ge(v),L=()=>{i()},c=s.useMemo(()=>({toolbar:{prev:!1,next:!1,play:!1,stop:!1},title:o=>`(${o.naturalWidth} × ${o.naturalHeight})`,viewed(){this.viewer.scale(1.2)}}),[]);s.useEffect(()=>{if(i(),l){const o=t==null?void 0:t.itemList.map((d,E)=>({image:d.attachment,contentType:d.contentType,id:d.requestAttachmentID,attachmentsRowNum:E+1,attachmentDesc:d.attachementDesc||"-",attachementTypeName:d.attachementTypeName||"-"}));if(T(o),t.itemList.length&&t.itemList.length>0){const d=t.itemList[0].image,G=`data:${t.itemList[0].contentType};base64,`;x(`${G}${d}`)}}},[l,i,t]),s.useEffect(()=>{var o;I&&S.error(((o=I==null?void 0:I.data)==null?void 0:o.message)||I.error,{autoClose:2e3})},[I]);const n=()=>{g(!0)},f=()=>{m(!0)},w=async()=>{var o;try{const d=await h(a).unwrap();S.success(d.message,{autoClose:2e3}),m(!1),i()}catch(d){console.log(d),S.error(((o=d==null?void 0:d.data)==null?void 0:o.message)||d.error,{autoClose:2e3})}},k=s.useMemo(()=>[{accessorKey:"attachmentsRowNum",header:"ردیف",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({renderedCellValue:o})=>e.jsx("div",{children:F(o)})},{accessorKey:"attachementTypeName",header:"نام پیوست",size:20},{accessorKey:"attachmentDesc",header:"توضیحات",size:20},{accessorKey:"deleteAttachment",header:"حذف",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:o})=>e.jsx(A,{title:`حذف "${o.original.attachementTypeName}"`,children:e.jsx(D,{color:"error",sx:{padding:"0"},onClick:f,children:e.jsx(we,{})})})},{accessorKey:"observeAttachment",header:"مشاهده",enableSorting:!1,enableColumnActions:!1,muiTableBodyCellProps:{align:"center"},size:20,Cell:({row:o})=>e.jsx(A,{title:`مشاهده "${o.original.attachementTypeName}"`,children:e.jsx("span",{children:y?e.jsx(Te,{options:c,imageUrls:y,children:e.jsx(_e,{children:e.jsx(D,{sx:{padding:"0"},color:"info",children:e.jsx(H,{color:"info"})})})}):e.jsx(D,{sx:{padding:"0"},color:"info",disabled:!0,children:e.jsx(H,{color:"action"})})})})}],[c,y]),P=X({...ce,columns:k,data:u,renderTopToolbarCustomActions:()=>e.jsxs(z,{children:[B?e.jsx(D,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(M,{size:20,value:100})}):e.jsx(A,{title:"بروز رسانی",children:e.jsx("span",{children:e.jsx(D,{"aria-label":"refresh",color:"info",onClick:L,children:e.jsx(de,{fontSize:"small"})})})}),B?e.jsx(D,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(M,{size:20,value:100,color:"success"})}):e.jsx(A,{title:"افزودن پیوست",children:e.jsx("span",{children:e.jsx(D,{"aria-label":"refresh",color:"success",onClick:n,children:e.jsx(De,{fontSize:"small"})})})})]}),muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:o=>e.jsx(Y,{...o,page:F(o.page),slots:{previous:Z,next:ee,first:se,last:te}})},muiTableBodyRowProps:({row:o})=>({onClick:()=>j(()=>({[o.id]:!0})),selected:r[o.id],sx:{cursor:"pointer"}}),getRowId:o=>o.id,onRowSelectionChange:j,state:{rowSelection:r}});return s.useEffect(()=>{const o=Object.keys(P.getState().rowSelection)[0];if(o){_(o);const d=he(u,o);if(d){const E=d.image,me=`data:${d.contentType};base64,`;x(`${me}${E}`)}}},[P,r,u]),e.jsx(e.Fragment,{children:p?e.jsx("div",{className:"skeleton-lg",children:e.jsx(ie,{count:5,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl"})}):e.jsxs(e.Fragment,{children:[N&&e.jsx(K,{title:"افزودن پیوست",closeModal:()=>g(!1),children:e.jsx(Pe,{setShowInsertAttachmentModal:g,refetch:i})}),b&&e.jsxs(K,{title:"حذف پیوست",closeModal:()=>m(!1),children:[e.jsx("p",{className:"paragraph-primary",children:"آیا از حذف این پیوست اطمینان دارید؟"}),e.jsxs("div",{className:"flex-row flex-center",children:[e.jsx(U,{dir:"ltr",endIcon:e.jsx(ae,{}),loading:R,onClick:w,variant:"contained",color:"success",children:e.jsx("span",{children:"بله"})}),e.jsx(ne,{dir:"ltr",endIcon:e.jsx(ue,{}),disabled:R,onClick:()=>m(!1),variant:"contained",color:"error",children:e.jsx("span",{children:"خیر"})})]})]}),e.jsx(oe,{table:P})]})})}function Me({setShowModal:b,value:m}){const[r,j]=s.useState(" "),[u,T]=s.useState(""),[a,_]=s.useState([]),N=$(),g=new URLSearchParams(location.search),y=g.get("requestID"),x=g.get("Role"),C=g.get("type"),[q,{isLoading:v}]=le(),{data:h,isSuccess:R,isLoading:t,isFetching:p,error:l}=je({RequestID:y,conditionValue:m,Role:x});s.useEffect(()=>{R&&_(h.itemList)},[R,h]),s.useEffect(()=>{var c;l&&(console.log(l),S.error(((c=l==null?void 0:l.data)==null?void 0:c.message)||l.error,{autoClose:2e3}))},[l]);const B=c=>{j(c.target.value)},I=c=>{T(c.target.value)},i=async()=>{var c;try{const n=await q({requestid:y,conditionValue:m,expertUserID:r,role:x,requestTypeID:C,description:u});b(!1),S.success(n.data.message,{autoClose:2e3}),N("/retirement/cartable")}catch(n){console.log(n),S.error(((c=n==null?void 0:n.data)==null?void 0:c.message)||n.error,{autoClose:2e3})}};return e.jsx(e.Fragment,{children:t||p?e.jsx(z,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(M,{color:"primary"})}):e.jsx("section",{className:"formContainer flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",noValidate:!0,children:[e.jsxs("div",{className:"flex-col",children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsxs("select",{className:"inputBox__form--input",required:!0,id:"expertList",onChange:B,value:r,disabled:v,style:{height:"40px",width:"180px"},children:[e.jsx("option",{value:" ",disabled:!0,children:"انتخاب کنید"}),a==null?void 0:a.map(c=>e.jsxs("option",{value:c.userID,children:[c.firstName," ",c.lastName]},c.userID))]}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"expertList",children:"لیست کارشناسان"})]}),e.jsx("div",{}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("textarea",{className:"inputBox__form--input",required:!0,id:"expertDescription",onChange:I,value:u,disabled:v,style:{overflow:"hidden",width:"400px"}}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"expertDescription",children:"توضیحات"})]})]}),e.jsx("div",{style:{marginRight:"auto"},children:e.jsx(U,{dir:"ltr",loading:t,endIcon:e.jsx(ae,{}),onClick:i,disabled:r===" "||v,variant:"contained",color:"success",children:e.jsx("span",{children:"تایید"})})})]})})})}function ze(){const[b,m]=s.useState(!1),[r,j]=s.useState(null),[u,T]=s.useState(null),[a,_]=s.useState(null),N=new URLSearchParams(location.search),g=N.get("Role"),y=N.get("requestID"),x=N.get("type"),[C,{isLoading:q}]=le(),v=$(),{data:h,isSuccess:R,isLoading:t,isFetching:p,error:l}=ye({Role:g,requestID:y});s.useEffect(()=>{R&&(_(h==null?void 0:h.itemList[0]),T(h==null?void 0:h.itemList[0].conditions))},[R,h==null?void 0:h.itemList,T]),s.useEffect(()=>{var i;l&&(console.log(l),S.error(((i=l==null?void 0:l.data)==null?void 0:i.message)||l.error,{autoClose:2e3}))},[l]);const B=async(i,L)=>{var c;if(console.log(i,L),j(i),L!==1e3)m(!0);else try{const n=await C({requestid:y,conditionValue:i,role:g,requestTypeID:x});v("/retirement/cartable"),S.success(n.data.message,{autoClose:2e3})}catch(n){console.log(n),S.error(((c=n==null?void 0:n.data)==null?void 0:c.message)||n.error,{autoClose:2e3})}};return e.jsxs(e.Fragment,{children:[t||p?e.jsx(z,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(M,{color:"primary"})}):e.jsxs("section",{className:"formContainer flex-col",children:[e.jsxs("form",{method:"POST",className:"grid grid--col-5",children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",id:"requNO",disabled:!0,value:F(a==null?void 0:a.requestNO)||"-",className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"reqNum",className:"inputBox__form--label",children:"شماره درخواست"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",id:"reqDate",disabled:!0,value:re(a==null?void 0:a.requestDate),className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"reqdate",className:"inputBox__form--label",children:"تاریخ"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",id:"reqFirstName",disabled:!0,value:(a==null?void 0:a.personFirstName)||"-",className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"rqName",className:"inputBox__form--label",children:"نام"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",id:"reqLastName",disabled:!0,value:(a==null?void 0:a.personLastName)||"-",className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"rqfName",className:"inputBox__form--label",children:"نام خانوادگی"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",id:"reqType",value:(a==null?void 0:a.requestTypeNameFa)||"-",disabled:!0,className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"rqType",className:"inputBox__form--label",children:"نوع درخواست"})]}),e.jsxs("div",{className:"inputBox__form col-span-5 row-span-3",children:[e.jsx("textarea",{disabled:!0,type:"text",id:"reqText",value:(a==null?void 0:a.requestText)||"-",className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"reqText",className:"inputBox__form--label",children:"متن درخواست"})]})]}),e.jsxs("div",{style:{marginRight:"auto"},className:"flex-row",children:[e.jsx(ne,{dir:"ltr",endIcon:e.jsx(Ae,{}),variant:"contained",color:"primary",sx:{fontFamily:"Vazir"},children:e.jsx("span",{children:"چاپ"})}),u==null?void 0:u.map(i=>e.jsx(U,{dir:"ltr",endIcon:e.jsx(Le,{}),variant:"contained",loading:i.nextSate===1e3?q:!1,onClick:()=>B(i.conditionValue,i.nextSate),color:"primary",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:i.buttonName})},i.buttonName))]})]}),b&&e.jsxs(K,{closeModal:()=>m(!1),children:[e.jsx("div",{className:"flex-row flex-center",children:e.jsx("p",{className:"paragraph-primary",children:"کارشناس مورد نظر را انتخاب کنید"})}),e.jsx(Me,{setShowModal:m,value:r})]})]})}function ke(){const[b,m]=s.useState({}),[r,j]=s.useState([]),u=J(),a=new URLSearchParams(u.search).get("requestID"),{data:_,isLoading:N,isSuccess:g,isFetching:y,error:x,refetch:C}=be(a),q=()=>{C()};s.useEffect(()=>{if(C(),g){const t=_.itemList.map((p,l)=>({historyRowNum:l+1,historyUser:p.firstName+" "+p.lastName||"-",roleName:p.roleName||"-",historyDate:p.date||"-",historyDesc:p.description||"-",historyStateName:p.stateName||"-",historyCondition:p.accept||"-"}));j(t)}},[g,C,_]),s.useEffect(()=>{var t;x&&S.error(((t=x==null?void 0:x.data)==null?void 0:t.message)||x.error,{autoClose:2e3})},[x]);const v=s.useMemo(()=>[{accessorKey:"historyRowNum",header:"ردیف",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:F(t)})},{accessorKey:"historyUser",header:"کاربر",size:20},{accessorKey:"roleName",header:"نقش",size:20},{accessorKey:"historyDate",header:"تاریخ",size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:re(t)})},{accessorKey:"historyDesc",header:"شرح",size:20},{accessorKey:"historyStateName",header:"مرحله",size:20},{accessorKey:"historyCondition",header:"وضعیت",size:20}],[]),h=X({...ce,columns:v,data:r,renderTopToolbarCustomActions:()=>e.jsx(z,{children:y?e.jsx(D,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(M,{size:20,value:100})}):e.jsx(A,{title:"بروز رسانی",children:e.jsx("span",{children:e.jsx(D,{"aria-label":"refresh",color:"info",onClick:q,children:e.jsx(de,{fontSize:"small"})})})})}),muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:t=>e.jsx(Y,{...t,page:F(t.page),slots:{previous:Z,next:ee,first:se,last:te}})},muiTableBodyRowProps:({row:t})=>({onClick:()=>m(()=>({[t.id]:!0})),selected:b[t.id],sx:{cursor:"pointer"}}),getRowId:t=>t.id,onRowSelectionChange:m,state:{rowSelection:b}});return e.jsx(e.Fragment,{children:N?e.jsx("div",{className:"skeleton-lg",children:e.jsx(ie,{count:5,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl"})}):e.jsx(oe,{table:h})})}function ts(){const[b,m]=s.useState("1"),r=$(),j=(T,a)=>{m(a)};return e.jsx(e.Fragment,{children:e.jsxs("section",{className:"flex-col",children:[e.jsxs("div",{className:"title-primary--container flex-row flex-center",children:[e.jsxs("h4",{className:"title-primary",children:[e.jsx("span",{className:"title-primary--underline"})," اطلاعات درخواست"]}),e.jsx("div",{style:{marginRight:"auto"},className:"back-button",children:e.jsx(A,{title:"بازگشت",children:e.jsx("span",{children:e.jsx(D,{color:"primary",onClick:()=>r(-1),children:e.jsx(xe,{})})})})})]}),e.jsx("div",{children:e.jsxs(qe,{value:b,children:[e.jsx(z,{sx:{bgcolor:"background.paper",borderRadius:1},children:e.jsxs(Be,{onChange:j,"aria-label":"tabs",children:[e.jsx(O,{label:"درخواست",value:"1"}),e.jsx(O,{label:"پیوست ها",value:"2"}),e.jsx(O,{label:"تاریخچه",value:"3"})]})}),e.jsx(V,{value:"1",sx:{padding:"0"},children:e.jsx(ze,{})}),e.jsx(V,{value:"2",sx:{padding:"0"},children:e.jsx(Fe,{})}),e.jsx(V,{value:"3",sx:{padding:"0"},children:e.jsx(ke,{})})]})})]})})}export{ts as default};
