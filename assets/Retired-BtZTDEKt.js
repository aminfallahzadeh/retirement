import{A as Z,r as t,j as e,D as pe,u as Ae,h as me,F as Ce,H as Re,J as je,B as oe,C as Ie,K as n,M as Le,N as T,P as Ue,Q as Oe,S as ke,U as Pe,V as S,W as _e,X as Y,Y as Fe,Z as re,_ as qe,$ as ve,a0 as Me,a1 as Be,a2 as Ge,a3 as $e,a4 as we,a5 as He,a6 as Ke,a7 as Ve,a8 as ze,a9 as Qe,aa as Ye,ab as Je,ac as We,ad as Ze,ae as Xe,af as es,ag as ss,ah as as,ai as ts,aj as ns,ak as rs,al as os,am as is,an as ls,ao as cs,ap as ds,aq as us,ar as ps,as as ms,at as Is,v as J,au as xe,av as De,aw as be,ax as he,i as Ee,ay as xs,az as Ds,aA as bs,aB as ge,aC as hs,aD as fs,aE as Ss,aF as js,aG as gs,aH as ys,aI as Es,aJ as Ts,aK as Ns,aL as As,aM as Cs,aN as Rs,aO as Ls,aP as Us,aQ as Os,aR as ks,aS as Ps,aT as _s,aU as g,aV as ce,aW as de,aX as ue,aY as Fs,aZ as X,a_ as qs,a$ as vs,L as ee,b0 as Ms,b1 as Bs,b2 as Gs,b3 as $s,k as ws,b4 as Hs,b5 as Ks,b6 as Vs,b7 as zs,b8 as Qs}from"./index-N58BBWKb.js";import{u as Ys,a as Js,c as Ws,F as Zs}from"./createTree-BuB9JDGU.js";import{c as y,S as E}from"./SelectInput-CzQj549f.js";import{C as Q}from"./CustomCheckBox-DuCs0LAg.js";import{T as ye}from"./TextArea-C6sgpjfn.js";import{E as fe}from"./EditOutlined-3NjP8W9U.js";import{u as k,a as Xs,b as ea}from"./useFetchLookUpData-K_qkNkw8.js";import{p as Te,a as Se}from"./convertFormData-CJYHF86N.js";import{S as sa}from"./StatusHistoryGrid-B2Q4j7sS.js";import{u as aa}from"./sharedApi-BlfukM_H.js";import{u as ta}from"./useRouteMatch-D4lKS5sR.js";import{A as se,a as ae,b as te,c as ne}from"./ArrowDropDown-DAigfva2.js";import"./index-DzGynObm.js";import"./react-select-animated.esm-DO7WXjOE.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./requestApi-CvbzcBqY.js";import"./personnelApi-C-Wgm4HA.js";import"./fractionApi-JSGtCmaz.js";const na=()=>{const[s]=Z(),[h,l]=t.useState([]),[f,U]=t.useState([]),p=s.get("personID"),{data:N,isLoading:a,isSuccess:m,refetch:u}=Ys(),{data:D,isLoading:r,isSuccess:I,refetch:c}=Js(p);t.useEffect(()=>{I&&U(D.itemList)},[I,D]),t.useEffect(()=>{if(m){const q=Ws(N.itemList);l(q)}},[m,N]);const j=t.useCallback(()=>{u(),c()},[u,c]);return e.jsx(Zs,{structure:h,files:f,isLoading:a||r,refetch:j,access:"files"})},ra=["personFirstName","personLastName","personNationalCode","personCertificateNo","personFatherName","genderID","personBirthDate","personBirthPlace","personPreviousNam","personIsSacrificedFamily","personIsWarrior","personIsChildOfSacrificed","personIsValiant","personIsSacrificed","personIsCaptive","retiredID","personPhone","personCellPhone","backupPhone","backupFirstName","backupLastName","personEmail","educationTypeID","personCountryID","personStateID","personCityID","personRegion","personArea","personPostalCode","housingTypeID","maritalStatusID","personDeathDate","personAddress","personDescription"],oa=["retiredGroup","retiredOrganizationID","retiredLastPosition","employmentTypeID","retirementDate","pensionaryStatusID","pensionaryStartdate","retiredJobDegreeCoef","retiredGrantDuration","retiredRealDuration"],ia=["bankID","bankBranchID","accountNo","ledgerCode","insuranceCoef","insuranceAmount"],la=["personRegion","personArea","retiredID"],ca=["retiredGroup","retiredJobDegree","retiredJobDegreeCoef","retiredRealDuration","retiredRealDurationYEAR","retiredRealDurationMONTH","retiredRealDurationDAY","retiredGrantDuration"],da=["ledgerCode"],ua=["insuranceAmount","insuranceCoef"],pa=()=>{const[s,h]=pe(!1),[l]=Z(),f=Ae(),U=l.get("personID"),p=t.useMemo(()=>["genderID","personCountryID","personStateID","personCityID","housingTypeID","educationTypeID","maritalStatusID"],[]),N=t.useMemo(()=>["personDeathDate","personBirthDate"],[]),{control:a,handleSubmit:m,formState:{errors:u},setValue:D}=me(),{data:r,isLoading:I,isFetching:c,isSuccess:j,refetch:q}=Ce(U),[P,{isLoading:G}]=Re(),{lookUpItems:A,lookUpItemsIsLoading:$}=k({lookUpType:"Gender"}),R=t.useMemo(()=>y(A,"lookUpID","lookUpName"),[A]),{lookUpItems:x,lookUpItemsIsLoading:L}=k({lookUpType:"EducationType"}),v=t.useMemo(()=>y(x,"lookUpID","lookUpName"),[x]),{lookUpItems:w,lookUpItemsIsLoading:H}=k({lookUpType:"Country"}),M=t.useMemo(()=>y(w,"lookUpID","lookUpName"),[w]),{lookUpItems:B,lookUpItemsIsLoading:K}=k({lookUpType:"State"}),_=t.useMemo(()=>y(B,"lookUpID","lookUpName"),[B]),{lookUpItems:W,lookUpItemsIsLoading:d}=k({lookUpType:"City"}),C=t.useMemo(()=>y(W,"lookUpID","lookUpName"),[W]),{lookUpItems:F,lookUpItemsIsLoading:ie}=k({lookUpType:"HousingType"}),b=t.useMemo(()=>y(F,"lookUpID","lookUpName"),[F]),{lookUpItems:i,lookUpItemsIsLoading:o}=k({lookUpType:"MaritialStatus"}),le=t.useMemo(()=>y(i,"lookUpID","lookUpName"),[i]),Ne=async V=>{const z=Se(V,p,N,la,[]),O=await P(z).unwrap();q(),h(),he.success(O.message)};return t.useEffect(()=>{if(j){const V=r==null?void 0:r.itemList[0];f(je((V==null?void 0:V.personDeathDate)!==null));const z=Te(V,p,N,{genderID:R,educationTypeID:v,personCountryID:M,personStateID:_,personCityID:C,housingTypeID:b,maritalStatusID:le});Object.keys(z).forEach(O=>{ra.includes(O)&&z[O]===null?D(O,""):D(O,z[O])})}return()=>{f(je(null))}},[f,j,r==null?void 0:r.itemList,D,R,M,v,_,C,b,le,N,p]),e.jsx(e.Fragment,{children:I||c?e.jsx(oe,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(Ie,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:m(Ne),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(n,{name:"personFirstName",label:Le,rules:T,required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personLastName",label:Ue,rules:T,required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personNationalCode",label:Oe,rules:{...ke,...T},required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personCertificateNo",label:Pe,rules:{...S,...T},required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personFatherName",label:_e,rules:Y,required:!0,control:a,editable:s,type:"text"}),e.jsx(E,{name:"genderID",control:a,label:Fe,required:!0,isClearable:!0,isDisabled:!s,options:R,isLoading:$,rules:T,errors:u}),e.jsx(re,{name:"personBirthDate",label:qe,control:a,disabled:!s,required:!0,errors:u,rules:T,setValue:D}),e.jsx(n,{name:"personBirthPlace",label:ve,rules:Y,required:!1,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personPreviousName",label:Me,rules:Y,required:!1,control:a,editable:s,type:"text"}),e.jsxs("div",{className:s?"checkboxContainer col-span-3":"checkboxContainer--disabled col-span-3",children:[e.jsx("p",{className:"inputBox__form--readOnly-label",children:Be}),e.jsx(Q,{disabled:!s,control:a,label:Ge,name:"personIsSacrificedFamily"}),e.jsx(Q,{disabled:!s,control:a,label:$e,name:"personIsWarrior"}),e.jsx(Q,{disabled:!s,control:a,label:we,name:"personIsChildOfSacrificed"}),e.jsx(Q,{disabled:!s,control:a,label:He,name:"personIsValiant"}),e.jsx(Q,{disabled:!s,control:a,label:Ke,name:"personIsSacrificed"}),e.jsx(Q,{disabled:!s,control:a,label:Ve,name:"personIsCaptive"})]}),e.jsx(n,{name:"retiredID",label:ze,required:!1,control:a,editable:!1,type:"text"}),e.jsx(n,{name:"personPhone",label:Qe,required:!1,rules:S,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personCellPhone",label:Ye,required:!1,rules:Je,control:a,editable:s,type:"text"}),e.jsx(n,{name:"backupPhone",label:We,required:!1,rules:S,control:a,editable:s,type:"text"}),e.jsx(n,{name:"backupFirstName",label:Ze,required:!1,rules:Y,control:a,editable:s,type:"text"}),e.jsx(n,{name:"backupLastName",label:Xe,required:!1,rules:Y,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personEmail",label:es,required:!1,rules:ss,control:a,editable:s,type:"text"}),e.jsx(E,{name:"educationTypeID",control:a,label:as,required:!1,isClearable:!0,isDisabled:!s,options:v,isLoading:L}),e.jsx(E,{name:"personCountryID",control:a,label:ts,required:!1,isClearable:!0,isDisabled:!s,options:M,isLoading:H}),e.jsx(E,{name:"personStateID",control:a,label:ns,required:!1,isClearable:!0,isDisabled:!s,options:_,isLoading:K}),e.jsx(E,{name:"personCityID",control:a,label:rs,required:!1,isClearable:!0,isDisabled:!s,options:C,isLoading:d}),e.jsx(n,{name:"personRegion",label:os,required:!1,control:a,editable:s,rules:S,type:"text"}),e.jsx(n,{name:"personArea",label:is,required:!1,control:a,editable:s,rules:S,type:"text"}),e.jsx(n,{name:"personPostalCode",label:ls,required:!1,control:a,editable:s,rules:cs,type:"text"}),e.jsx(E,{name:"housingTypeID",control:a,label:ds,required:!1,isClearable:!0,isDisabled:!s,options:b,isLoading:ie}),e.jsx(E,{name:"maritalStatusID",control:a,label:us,required:!1,isClearable:!0,isDisabled:!s,options:le,isLoading:o}),e.jsx(re,{name:"personDeathDate",label:ps,control:a,disabled:!s,required:!1,setValue:D}),e.jsx(ye,{name:"personAddress",label:ms,required:!0,control:a,editable:s,containerClassNames:"col-span-3"}),e.jsx(ye,{name:"personDescription",label:Is,required:!0,control:a,editable:s,containerClassNames:"col-span-4 row-span-2"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(J,{dir:"ltr",endIcon:e.jsx(xe,{}),disabled:!s,variant:"contained",type:"submit",loading:G,color:"success",children:e.jsx("span",{children:De})}),e.jsx(J,{dir:"ltr",endIcon:e.jsx(fe,{}),onClick:h,disabled:s,variant:"contained",color:"primary",children:e.jsx("span",{children:be})})]})]})})})},ma=()=>{const[s,h]=t.useState([]),[l,f]=pe(!1),[U]=Z(),p=U.get("personID"),{personDeathDate:N}=Ee(b=>b.person),a=t.useMemo(()=>["retiredOrganizationID","employmentTypeID","pensionaryStatusID"],[]),m=t.useMemo(()=>["retirementDate","pensionaryStartdate"],[]),{control:u,handleSubmit:D,formState:{errors:r},setValue:I}=me(),{data:c,isSuccess:j,isLoading:q,isFetching:P,refetch:G}=xs(p),{data:A,isSuccess:$,isLoading:R,isFetching:x,refetch:L}=Ds(p),[v,{isLoading:w}]=bs(),{organizations:H,organizationIsLoading:M}=Xs({}),{lookUpItems:B,lookUpItemsIsLoading:K}=k({lookUpType:"EmploymentType"}),{pensionaryStatus:_,pensionaryStatusIsLoading:W}=ea({pensionaryStatusCategory:"R",pensionaryStatusIsDead:N}),d=t.useMemo(()=>y(H,"organizationID","organizationName"),[H]),C=t.useMemo(()=>y(B,"lookUpID","lookUpName"),[B]),F=t.useMemo(()=>y(_,"pensionaryStatusID","pensionaryStatusName"),[_]);t.useEffect(()=>{if(j){const b=c==null?void 0:c.itemList[0];if(b){const i={...b};Object.keys(i).forEach(o=>{o==="retirementDate"&&(i[o]=i[o]===null?null:ge(i[o])),o==="pensionaryStartdate"&&(i[o]=i[o]===null?null:ge(i[o])),I(o,i[o])})}}},[j,c==null?void 0:c.itemList,I]);const ie=async b=>{const i=Se(b,a,m,ca,[]),o=await v({...i,personID:p}).unwrap();f(),G(),L(),he.success(o.message)};return t.useEffect(()=>{if(j){const b=c==null?void 0:c.itemList[0],i=Te(b,a,m,{retiredOrganizationID:d,employmentTypeID:C,pensionaryStatusID:F});Object.keys(i).forEach(o=>{oa.includes(o)&&i[o]===null?I(o,""):I(o,i[o])})}},[j,c==null?void 0:c.itemList,d,C,F,I,a,m]),t.useEffect(()=>{if($){const b=A==null?void 0:A.itemList.map((i,o)=>({id:i.pensionaryID,isActive:i.pensionaryIsActive,pensionaryStatusRowNum:o+1,pensionaryStatusName:i.pensionaryStatusName||"-",pensionaryStartdate:i.pensionaryStartdate||"-"}));h(b)}},[$,A==null?void 0:A.itemList]),e.jsx(e.Fragment,{children:q||P?e.jsx(oe,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(Ie,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:D(ie),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(n,{name:"retiredGroup",label:hs,control:u,required:!0,editable:l,rules:{...T,...S},type:"text"}),e.jsx(E,{name:"retiredOrganizationID",control:u,label:fs,required:!0,isClearable:!0,isDisabled:!l,options:d,isLoading:M,rules:T,errors:r}),e.jsx(n,{name:"retiredLastPosition",label:Ss,control:u,required:!1,editable:l,rules:Y,type:"text"}),e.jsx(E,{name:"employmentTypeID",control:u,label:js,required:!0,isClearable:!0,isDisabled:!l,options:C,isLoading:K,rules:T,errors:r}),e.jsx(re,{name:"retirementDate",label:gs,control:u,disabled:!l,required:!1,errors:r,rules:T,setValue:I}),e.jsx(E,{name:"pensionaryStatusID",control:u,label:ys,required:!0,isClearable:!0,isDisabled:!l,options:F,isLoading:W,rules:T,errors:r}),e.jsx(re,{name:"pensionaryStartdate",label:Es,control:u,disabled:!l,required:!0,errors:r,rules:T,setValue:I}),e.jsx(n,{name:"retiredJobDegreeCoef",label:Ts,control:u,required:!1,editable:l,rules:S,type:"text"}),e.jsx(n,{name:"retiredGrantDuration",label:Ns,control:u,required:!1,editable:l,rules:S,type:"text"}),e.jsx(n,{name:"retiredRealDuration",label:As,control:u,required:!1,editable:l,rules:S,type:"text"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(J,{dir:"ltr",endIcon:e.jsx(xe,{}),disabled:!l,variant:"contained",type:"submit",loading:w,color:"success",children:e.jsx("span",{children:De})}),e.jsx(J,{dir:"ltr",endIcon:e.jsx(fe,{}),onClick:f,disabled:l,variant:"contained",color:"primary",children:e.jsx("span",{children:be})})]}),e.jsx("div",{className:"flex-col flex-center",children:e.jsx("h5",{className:"title-secondary",children:"تاریخچه وضعیت ها"})}),e.jsx(sa,{data:s,isLoading:R,isFetching:x})]})})})},Ia=()=>{const[s,h]=pe(!1),[l,f]=t.useState([]),[U]=Z(),p=U.get("personID"),N=t.useMemo(()=>["bankID","bankBranchID"],[]),a=t.useMemo(()=>[],[]),{control:m,handleSubmit:u,formState:{errors:D},setValue:r,watch:I}=me(),c=I("bankID"),{lookUpItems:j,lookUpItemsIsLoading:q}=k({lookUpType:"Bank"}),P=t.useMemo(()=>y(j,"lookUpID","lookUpName"),[j]),[G,{isLoading:A,isFetching:$}]=aa(),R=t.useMemo(()=>y(l,"lookUpID","lookUpName"),[l]),{data:x,isSuccess:L,isLoading:v,isFetching:w,refetch:H}=Cs(p),[M,{isLoading:B}]=Rs(),K=t.useCallback(async d=>{const C=await G({lookUpType:"BankBranch",lookUpParentID:d}).unwrap();f(C.itemList)},[G]),_=async d=>{const C=Se(d,N,a,da,ua),F=await M({...C,personID:p}).unwrap();H(),h(),he.success(F.message)};return t.useEffect(()=>{c?K(c.value):(r("bankBranchID",null),f([]))},[c,K,r]),t.useEffect(()=>{L&&({...x},Object.keys(x).forEach(d=>{ia.includes(d)&&x[d]===null?r(d,""):r(d,x[d])}))},[L,x,r]),t.useEffect(()=>{L&&P.length>0&&r("bankID",P.find(d=>d.value===x.bankID))},[L,x,r,P]),t.useEffect(()=>{L&&R.length>0&&r("bankBranchID",R.find(d=>d.value===x.bankBranchID))},[L,x,r,R]),e.jsx(e.Fragment,{children:v||w?e.jsx(oe,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(Ie,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:u(_),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(E,{name:"bankID",control:m,label:Ls,required:!1,isClearable:!0,isDisabled:!s,options:P,isLoading:q,errors:D}),e.jsx(E,{name:"bankBranchID",control:m,label:Us,required:!1,isClearable:!0,isDisabled:!s,options:R,isLoading:A||$,errors:D}),e.jsx(n,{name:"accountNo",label:Os,rules:S,required:!1,control:m,editable:s,type:"text"}),e.jsx(n,{name:"ledgerCode",label:ks,rules:S,required:!1,control:m,editable:s,type:"text"}),e.jsx(n,{name:"insuranceCoef",label:Ps,rules:S,required:!1,control:m,editable:s,type:"text"}),e.jsx(n,{name:"insuranceAmount",label:_s,rules:S,required:!1,control:m,editable:s,type:"text"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(J,{dir:"ltr",endIcon:e.jsx(xe,{}),disabled:!s,variant:"contained",type:"submit",loading:B,color:"success",children:e.jsx("span",{children:De})}),e.jsx(J,{dir:"ltr",endIcon:e.jsx(fe,{}),onClick:h,disabled:s,variant:"contained",color:"primary",children:e.jsx("span",{children:be})})]})]})})})},xa=()=>{const[s]=Z(),h=ta([`${g}/${ce}`,`${g}/${de}`,`${g}/${ue}`,g]),l=s.toString(),{personDeathDate:f}=Ee(a=>a.person),U=h==null?void 0:h.pattern.path,p=a=>l?`${a}?${l}`:a;return e.jsxs("div",{children:[e.jsx(oe,{sx:{bgcolor:"background.paper",borderRadius:1},children:e.jsxs(Fs,{value:U,children:[e.jsx(X,{label:f?qs:vs,value:g,to:p(g),component:ee}),e.jsx(X,{label:Ms,value:`${g}/${ce}`,to:p(`${g}/${ce}`),component:ee}),e.jsx(X,{label:Bs,value:`${g}/${ue}`,to:p(`${g}/${ue}`),component:ee}),e.jsx(X,{label:Gs,value:`${g}/${de}`,to:p(`${g}/${de}`),component:ee})]})}),e.jsx($s,{})]})},Fa=()=>e.jsxs("section",{className:"flex-col mb-20",children:[e.jsx(ws,{title:Hs,back:!0}),e.jsxs("div",{"data-name":"retired-forms",children:[e.jsxs(se,{children:[e.jsx(ae,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(te,{}),children:Ks}),e.jsx(ne,{children:e.jsx(pa,{})})]}),e.jsxs(se,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(ae,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(te,{}),children:Vs}),e.jsx(ne,{children:e.jsx(ma,{})})]}),e.jsxs(se,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(ae,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(te,{}),children:zs}),e.jsx(ne,{children:e.jsx(Ia,{})})]}),e.jsxs(se,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(ae,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(te,{}),children:Qs}),e.jsx(ne,{children:e.jsx(na,{})})]})]}),e.jsx(xa,{})]});export{Fa as default};
