import{c as te,j as e,r as i,R as se,ba as ne,bb as re,b9 as le,bc as ie,f as G,bd as oe,G as ce,u as D,m as R,h as v,eN as de,aU as me,Y as s,a0 as _,_ as ue,a1 as fe,Z as M,$ as P,d$ as z,eO as xe,eP as pe,t as Y,eQ as Ne,eR as U,i as k,c7 as q,B as Q,C as Z,eS as w,eT as ye,eU as be,eV as B,eW as L,eX as O,eY as T,eZ as K,e_ as he,e$ as je,aF as Se,f0 as Ee,f1 as Ie,f2 as ge,f3 as Ce,f4 as Fe,f5 as Ae,f6 as Le,f7 as Oe,f8 as Te,bJ as qe,aD as De,f9 as Re}from"./index-D94qalpB.js";import{o as ve,p as _e,a as Me,q as W}from"./useFetchLookUpData-C4yUhmHx.js";import{c as H,S as $}from"./SelectInput-CR3oKtxR.js";import{C as J}from"./CustomCheckBox-Ch0ILEOV.js";import"./sharedApi-Dcc8dwkx.js";import"./requestApi-AgaGCVHq.js";import"./react-select-animated.esm-C5nUtOvK.js";const X=te(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),ee=()=>{i.useEffect(()=>{const t=n=>{if(n.key==="Enter"){const c=document.getElementById("authorize-form");c&&c.requestSubmit()}};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[])},Pe=()=>[{accessorKey:"personnelStatementRowNo",header:se,size:20,enableSorting:!1,enableColumnActions:!1},{accessorKey:"personnelStatementSerial",header:ne,size:20},{accessorKey:"orderType",header:re,size:20},{accessorKey:"personnelStatementNumber",header:le,size:20},{accessorKey:"insertTime",header:ie,size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:G(t)})},{accessorKey:"personnelStatementRunDate",header:oe,size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:G(t)})}],ze=i.memo(({personID:t,handleRowSelect:n})=>{const[c,d]=i.useState([]),[a,{isLoading:l,isFetching:f}]=ve(),o=Pe(),p=i.useCallback(async()=>{const x=(await a({personID:t}).unwrap()).itemList.map((r,y)=>({id:r.personnelStatementSerial,personnelStatementRowNo:y+1,personnelStatementSerial:r.personnelStatementSerial||"-",orderType:r.orderType||"-",personnelStatementNumber:r.personnelStatementID||"-",insertTime:r.insertTime||"-",personnelStatementRunDate:r.personnelStatementRunDate||"-"}));d(x)},[a,t]);return i.useEffect(()=>{t?p():d([])},[t,p]),e.jsx(ce,{data:c,columns:o,isLoading:l,isFetching:f,scroll:!1,onRowSelect:n})}),Ye=()=>{const[t,n]=i.useState(null),[c,d]=i.useState(null),a=D(),l=R(),{control:f,handleSubmit:o,formState:{errors:p},trigger:j,watch:x,setValue:r}=v({}),y=x("personNationalCode"),[m,{isLoading:b,isFetching:S}]=de(),{personnelStatementOffTypes:u,personnelStatementOffTypesIsLoading:h}=_e(),{organizations:E,organizationIsLoading:F}=Me({}),A=i.useMemo(()=>H(u,"personnelStatementOffTypeID","personnelStatementOffTypeName"),[u]),N=i.useMemo(()=>H(E,"organizationID","organizationName"),[E]),I=i.useCallback(C=>{d(C)},[]),ae=C=>{a(U({...C,serial:c})),l("/retirement/fraction/calculate/2")},V=i.useCallback(async()=>{const g=(await m({personNationalCode:me(y)}).unwrap()).itemList[0];g&&(r("personFirstName",g.personFirstName),r("personLastName",g.personLastName),r("personnelID",g.personnelID),n(g.personID))},[y,m,r]);return i.useEffect(()=>{y?(async()=>{await j("personNationalCode")?V():(r("personFirstName",""),r("personLastName",""),r("personnelID",""),n(null),d(null))})():(r("personFirstName",""),r("personLastName",""),r("personnelID",""),n(null),d(null))},[j,V,y,r]),ee(),e.jsx(e.Fragment,{children:e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:o(ae),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:_,rules:{...ue,...fe},required:!0,control:f,type:"text"}),e.jsx(s,{name:"personFirstName",label:M,required:!1,editable:!1,control:f,isLoading:b||S,type:"text"}),e.jsx(s,{name:"personLastName",label:P,required:!1,editable:!1,control:f,isLoading:b||S,type:"text"}),e.jsx(s,{name:"personnelID",label:z,required:!1,editable:!1,control:f,isLoading:b||S,type:"text"}),e.jsx($,{name:"statementType",control:f,label:xe,required:!1,isClearable:!0,options:A,isLoading:h,errors:p}),e.jsx($,{name:"organizationID",control:f,label:pe,required:!1,isClearable:!0,options:N,isLoading:F,errors:p})]}),e.jsx(ze,{personID:t,handleRowSelect:I}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(Y,{dir:"ltr",disabled:!c,endIcon:e.jsx(X,{}),variant:"contained",type:"submit",color:"success",children:e.jsx("span",{children:Ne})})})]})})})},Ue=()=>{const{fractionData:t}=k(m=>m.fraction),{control:n,handleSubmit:c,setValue:d,watch:a}=v({defaultValues:{personNationalCode:t==null?void 0:t.personNationalCode,personFirstName:t==null?void 0:t.personFirstName,personLastName:t==null?void 0:t.personLastName,personnelID:t==null?void 0:t.personnelID}}),l=a("delay"),f=D(),o=R(),[p,{isLoading:j}]=W(),x=i.useCallback(async()=>{var S,u;const m=await p({personNationalCode:t.personNationalCode,personnelStatementOffTypeID:((S=t==null?void 0:t.statementType)==null?void 0:S.value)||"0",organizationID:((u=t==null?void 0:t.organizationID)==null?void 0:u.value)||"0",numberOfInstallments:0,personnelStatementSerialNO:parseInt(t.serial),periods:null,save:!1}).unwrap(),b=m==null?void 0:m.itemList[0];Object.keys(b).forEach(h=>{typeof b[h]=="number"?d(h,q(b[h])):d(h,b[h])})},[p,t,d]),r=async m=>{f(U({...m,...t})),o("/retirement/fraction/calculate/3")};return i.useEffect(()=>{t?x():o("/retirement/fraction/calculate/1",{replace:!0})},[t,x,o]),ee(),e.jsx(e.Fragment,{children:j?e.jsx(Q,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(Z,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:c(r),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:_,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"personFirstName",label:M,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"personLastName",label:P,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"personnelID",label:z,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"sumFraction",label:w,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"transportedPay",label:ye,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"Modal__header flex justify-center items-center",children:e.jsx("h4",{className:"title-secondary",children:be})}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:B})}),e.jsx(s,{name:"startYear",label:L,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startMonth",label:O,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startDay",label:T,editable:!1,required:!1,control:n,type:"text"}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:K})}),e.jsx(s,{name:"endYear",label:L,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endMonth",label:O,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endDay",label:T,editable:!1,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"ml-auto",children:e.jsx(J,{name:"delay",label:he,control:n})}),l&&e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:B})}),e.jsx(s,{name:"startYearDelay",label:L,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startMonthDelay",label:O,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startDayDelay",label:T,required:!1,control:n,type:"text"}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:K})}),e.jsx(s,{name:"endYearDelay",label:L,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endMonthDelay",label:O,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endDayDelay",label:T,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(Y,{dir:"ltr",endIcon:e.jsx(X,{}),variant:"contained",type:"submit",color:"success",children:e.jsx("span",{children:je})})})]})})})},Ve=()=>{const[t,n]=i.useState({}),c=R(),d=D(),{fractionData:a}=k(u=>u.fraction),{control:l,handleSubmit:f,setValue:o,watch:p}=v({defaultValues:{personNationalCode:a==null?void 0:a.personNationalCode,personFirstName:a==null?void 0:a.personFirstName,personLastName:a==null?void 0:a.personLastName,personnelID:a==null?void 0:a.personnelID}}),j=p("installment"),x=p("installmentAmount"),[r,{isLoading:y}]=W(),m=i.useCallback(async(u=!1,h=0)=>{var F,A;const E=await r({personNationalCode:a==null?void 0:a.personNationalCode,personnelStatementOffTypeID:((F=a==null?void 0:a.statementType)==null?void 0:F.value)||"0",organizationID:((A=a==null?void 0:a.organizationID)==null?void 0:A.value)||"0",numberOfInstallments:h,personnelStatementSerialNO:parseInt(a==null?void 0:a.serial),startYearDelay:parseInt(a==null?void 0:a.startYearDelay)||0,startMonthDelay:parseInt(a==null?void 0:a.startMonthDelay)||0,startDayDelay:parseInt(a==null?void 0:a.startDayDelay)||0,endYearDelay:parseInt(a==null?void 0:a.endYearDelay)||0,endMonthDelay:parseInt(a==null?void 0:a.endMonthDelay)||0,endDayDelay:parseInt(a==null?void 0:a.endDayDelay)||0,transportedPay:parseInt(a==null?void 0:a.transportedPay)||0,periods:null,save:u}).unwrap();if(u)d(U(null)),Se.success(E.message),c("/retirement/fraction/calculate/1");else{const N=E==null?void 0:E.itemList[0];n(N),Object.keys(N).forEach(I=>{typeof N[I]=="number"?o(I,q(N[I])):o(I,N[I])}),o("sumFractionOrganizationPercent",`%${q((N.sumFractionOrganization*100/N.sumFraction).toFixed(2))}`),o("sumFractionPersonnelPercent",`%${q((N.sumFractionPersonnel*100/N.sumFraction).toFixed(2))}`)}},[r,a,o,d,c]);i.useEffect(()=>{a?m():c("/retirement/fraction/calculate/1",{replace:!0})},[a,m,c]),i.useEffect(()=>{if(x&&t&&!isNaN(parseFloat(x))&&parseFloat(x)!==0){const u=(t.debtor/parseFloat(x)).toFixed(0);o("numberOfInstallments",u)}else o("numberOfInstallments","")},[x,t,o]);const b=u=>{m(!0,parseInt(u.numberOfInstallments))};return e.jsx(e.Fragment,{children:y?e.jsx(Q,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(Z,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:f(b),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:_,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"personFirstName",label:M,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"personLastName",label:P,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"personnelID",label:z,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFraction",label:w,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionOrganizationPercent",label:Ee,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionPersonnelPercent",label:Ie,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionOrganization",label:ge,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionPersonnel",label:Ce,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"debtor",label:Fe,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"credit",label:Ae,editable:!1,required:!1,control:l,type:"text"}),e.jsx("div",{}),e.jsx(J,{name:"installment",label:Le,control:l}),j&&e.jsxs(e.Fragment,{children:[e.jsx(s,{name:"installmentAmount",label:Oe,control:l,type:"text"}),e.jsx(s,{name:"numberOfInstallments",label:Te,editable:!1,required:!1,control:l,type:"text"})]})]}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(Y,{dir:"ltr",endIcon:e.jsx(qe,{}),variant:"contained",loading:y,type:"submit",color:"success",children:e.jsx("span",{children:De})})})]})})})},Ze=()=>{const{step:t}=Re();return(d=>{switch(d){case"1":return e.jsx(Ye,{});case"2":return e.jsx(Ue,{});case"3":return e.jsx(Ve,{});default:return null}})(t)};export{Ze as default};
