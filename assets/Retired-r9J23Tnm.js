import{A as X,r as t,j as e,D as me,u as Ae,h as Ie,F as Re,H as Le,J as ge,B as ie,C as xe,K as n,M as Ue,N as T,P as Oe,Q as ke,S as Pe,U as _e,V as S,W as Fe,X as J,Y as qe,Z as oe,_ as ve,$ as Be,a0 as Me,a1 as Ge,a2 as $e,a3 as we,a4 as He,a5 as Ve,a6 as Ke,a7 as ze,a8 as Qe,a9 as Ye,aa as Je,ab as We,ac as Ze,ad as Xe,ae as es,af as ss,ag as as,ah as ts,ai as ns,aj as rs,ak as os,al as is,am as ls,an as cs,ao as ds,ap as us,aq as ps,ar as ms,as as Is,at as xs,v as W,au as be,av as De,aw as he,ax as fe,i as Te,ay as bs,az as Ds,aA as hs,aB as ye,aC as fs,aD as Ss,aE as js,aF as gs,aG as ys,aH as Es,aI as Ts,aJ as Ns,aK as Cs,aL as As,aM as q,aN as Rs,aO as Ls,aP as Us,aQ as Os,aR as ks,aS as Ps,aT as _s,aU as Fs,aV as g,aW as de,aX as ue,aY as pe,aZ as qs,a_ as ee,a$ as vs,b0 as Bs,L as se,b1 as Ms,b2 as Gs,b3 as $s,b4 as ws,k as Hs,b5 as Vs,b6 as Ks,b7 as zs,b8 as Qs,b9 as Ys}from"./index-75zhT6gl.js";import{u as Js,a as Ws,c as Zs,F as Xs}from"./createTree-BJz3BqsP.js";import{c as y,S as E}from"./SelectInput-BjDhIOA9.js";import{C as Y}from"./CustomCheckBox-CXLyM6rR.js";import{T as Ee}from"./TextArea-CVFp6v9D.js";import{E as Se}from"./EditOutlined-kbuE11CK.js";import{u as k,a as ea,b as sa}from"./useFetchLookUpData-Cex0AsFX.js";import{p as Ne,a as je}from"./convertFormData-NijAPJh_.js";import{S as aa}from"./StatusHistoryGrid-DodwktUj.js";import{u as ta}from"./sharedApi-CuOQJ0WC.js";import{u as na}from"./useRouteMatch-DLXRi8su.js";import{A as ae,a as te,b as ne,c as re}from"./ArrowDropDown-uczmU-l5.js";import"./index-CX9Qsghc.js";import"./react-select-animated.esm-p7Pyr3H5.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./requestApi-C7A3UixC.js";import"./personnelApi-DI2OC2le.js";import"./fractionApi-CkHq7VRb.js";const ra=()=>{const[s]=X(),[h,c]=t.useState([]),[f,U]=t.useState([]),m=s.get("personID"),{data:N,isLoading:a,isSuccess:I,refetch:u}=Js(),{data:D,isLoading:r,isSuccess:x,refetch:d}=Ws(m);t.useEffect(()=>{x&&U(D.itemList)},[x,D]),t.useEffect(()=>{if(I){const v=Zs(N.itemList);c(v)}},[I,N]);const j=t.useCallback(()=>{u(),d()},[u,d]);return e.jsx(Xs,{structure:h,files:f,isLoading:a||r,refetch:j,access:"files"})},oa=["personFirstName","personLastName","personNationalCode","personCertificateNo","personFatherName","genderID","personBirthDate","personBirthPlace","personPreviousNam","personIsSacrificedFamily","personIsWarrior","personIsChildOfSacrificed","personIsValiant","personIsSacrificed","personIsCaptive","retiredID","personPhone","personCellPhone","backupPhone","backupFirstName","backupLastName","personEmail","educationTypeID","personCountryID","personStateID","personCityID","personRegion","personArea","personPostalCode","housingTypeID","maritalStatusID","personDeathDate","personAddress","personDescription"],ia=["retiredGroup","retiredOrganizationID","retiredLastPosition","employmentTypeID","retirementDate","pensionaryStatusID","pensionaryStartdate","retiredJobDegreeCoef","retiredGrantDuration","retiredRealDuration"],la=["bankID","bankBranchID","accountNo","ledgerCode","insuranceCoef","insuranceAmount"],ca=()=>{const[s,h]=me(!1),[c]=X(),f=Ae(),U=c.get("personID"),m=t.useMemo(()=>["genderID","personCountryID","personStateID","personCityID","housingTypeID","educationTypeID","maritalStatusID"],[]),N=t.useMemo(()=>["personDeathDate","personBirthDate"],[]),{control:a,handleSubmit:I,formState:{errors:u},setValue:D}=Ie(),{data:r,isLoading:x,isFetching:d,isSuccess:j,refetch:v}=Re(U),[P,{isLoading:$}]=Le(),{lookUpItems:C,lookUpItemsIsLoading:w}=k({lookUpType:"Gender"}),R=t.useMemo(()=>y(C,"lookUpID","lookUpName"),[C]),{lookUpItems:b,lookUpItemsIsLoading:L}=k({lookUpType:"EducationType"}),B=t.useMemo(()=>y(b,"lookUpID","lookUpName"),[b]),{lookUpItems:H,lookUpItemsIsLoading:V}=k({lookUpType:"Country"}),M=t.useMemo(()=>y(H,"lookUpID","lookUpName"),[H]),{lookUpItems:G,lookUpItemsIsLoading:K}=k({lookUpType:"State"}),_=t.useMemo(()=>y(G,"lookUpID","lookUpName"),[G]),{lookUpItems:Z,lookUpItemsIsLoading:o}=k({lookUpType:"City"}),A=t.useMemo(()=>y(Z,"lookUpID","lookUpName"),[Z]),{lookUpItems:F,lookUpItemsIsLoading:le}=k({lookUpType:"HousingType"}),p=t.useMemo(()=>y(F,"lookUpID","lookUpName"),[F]),{lookUpItems:l,lookUpItemsIsLoading:i}=k({lookUpType:"MaritialStatus"}),ce=t.useMemo(()=>y(l,"lookUpID","lookUpName"),[l]),Ce=async z=>{const Q=je(z,m,N),O=await P(Q).unwrap();v(),h(),fe.success(O.message)};return t.useEffect(()=>{if(j){const z=r==null?void 0:r.itemList[0];f(ge((z==null?void 0:z.personDeathDate)!==null));const Q=Ne(z,m,N,{genderID:R,educationTypeID:B,personCountryID:M,personStateID:_,personCityID:A,housingTypeID:p,maritalStatusID:ce});Object.keys(Q).forEach(O=>{oa.includes(O)&&Q[O]===null?D(O,""):D(O,Q[O])})}return()=>{f(ge(null))}},[f,j,r==null?void 0:r.itemList,D,R,M,B,_,A,p,ce,N,m]),e.jsx(e.Fragment,{children:x||d?e.jsx(ie,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(xe,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:I(Ce),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(n,{name:"personFirstName",label:Ue,rules:T,required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personLastName",label:Oe,rules:T,required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personNationalCode",label:ke,rules:{...Pe,...T},required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personCertificateNo",label:_e,rules:{...S,...T},required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personFatherName",label:Fe,rules:J,required:!0,control:a,editable:s,type:"text"}),e.jsx(E,{name:"genderID",control:a,label:qe,required:!0,isClearable:!0,isDisabled:!s,options:R,isLoading:w,rules:T,errors:u}),e.jsx(oe,{name:"personBirthDate",label:ve,control:a,disabled:!s,required:!0,errors:u,rules:T,setValue:D}),e.jsx(n,{name:"personBirthPlace",label:Be,rules:J,required:!1,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personPreviousName",label:Me,rules:J,required:!1,control:a,editable:s,type:"text"}),e.jsxs("div",{className:s?"checkboxContainer col-span-3":"checkboxContainer--disabled col-span-3",children:[e.jsx("p",{className:"inputBox__form--readOnly-label",children:Ge}),e.jsx(Y,{disabled:!s,control:a,label:$e,name:"personIsSacrificedFamily"}),e.jsx(Y,{disabled:!s,control:a,label:we,name:"personIsWarrior"}),e.jsx(Y,{disabled:!s,control:a,label:He,name:"personIsChildOfSacrificed"}),e.jsx(Y,{disabled:!s,control:a,label:Ve,name:"personIsValiant"}),e.jsx(Y,{disabled:!s,control:a,label:Ke,name:"personIsSacrificed"}),e.jsx(Y,{disabled:!s,control:a,label:ze,name:"personIsCaptive"})]}),e.jsx(n,{name:"retiredID",label:Qe,required:!1,control:a,editable:!1,type:"text"}),e.jsx(n,{name:"personPhone",label:Ye,required:!1,rules:S,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personCellPhone",label:Je,required:!1,rules:We,control:a,editable:s,type:"text"}),e.jsx(n,{name:"backupPhone",label:Ze,required:!1,rules:S,control:a,editable:s,type:"text"}),e.jsx(n,{name:"backupFirstName",label:Xe,required:!1,rules:J,control:a,editable:s,type:"text"}),e.jsx(n,{name:"backupLastName",label:es,required:!1,rules:J,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personEmail",label:ss,required:!1,rules:as,control:a,editable:s,type:"text"}),e.jsx(E,{name:"educationTypeID",control:a,label:ts,required:!1,isClearable:!0,isDisabled:!s,options:B,isLoading:L}),e.jsx(E,{name:"personCountryID",control:a,label:ns,required:!1,isClearable:!0,isDisabled:!s,options:M,isLoading:V}),e.jsx(E,{name:"personStateID",control:a,label:rs,required:!1,isClearable:!0,isDisabled:!s,options:_,isLoading:K}),e.jsx(E,{name:"personCityID",control:a,label:os,required:!1,isClearable:!0,isDisabled:!s,options:A,isLoading:o}),e.jsx(n,{name:"personRegion",label:is,required:!1,control:a,editable:s,rules:S,type:"text"}),e.jsx(n,{name:"personArea",label:ls,required:!1,control:a,editable:s,rules:S,type:"text"}),e.jsx(n,{name:"personPostalCode",label:cs,required:!1,control:a,editable:s,rules:ds,type:"text"}),e.jsx(E,{name:"housingTypeID",control:a,label:us,required:!1,isClearable:!0,isDisabled:!s,options:p,isLoading:le}),e.jsx(E,{name:"maritalStatusID",control:a,label:ps,required:!1,isClearable:!0,isDisabled:!s,options:ce,isLoading:i}),e.jsx(oe,{name:"personDeathDate",label:ms,control:a,disabled:!s,required:!1,setValue:D}),e.jsx(Ee,{name:"personAddress",label:Is,required:!0,control:a,editable:s,containerClassNames:"col-span-3"}),e.jsx(Ee,{name:"personDescription",label:xs,required:!0,control:a,editable:s,containerClassNames:"col-span-4 row-span-2"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(W,{dir:"ltr",endIcon:e.jsx(be,{}),disabled:!s,variant:"contained",type:"submit",loading:$,color:"success",children:e.jsx("span",{children:De})}),e.jsx(W,{dir:"ltr",endIcon:e.jsx(Se,{}),onClick:h,disabled:s,variant:"contained",color:"primary",children:e.jsx("span",{children:he})})]})]})})})},da=()=>{const[s,h]=t.useState([]),[c,f]=me(!1),[U]=X(),m=U.get("personID"),{personDeathDate:N}=Te(p=>p.person),a=t.useMemo(()=>["retiredOrganizationID","employmentTypeID","pensionaryStatusID"],[]),I=t.useMemo(()=>["retirementDate","pensionaryStartdate"],[]),{control:u,handleSubmit:D,formState:{errors:r},setValue:x}=Ie(),{data:d,isSuccess:j,isLoading:v,isFetching:P,refetch:$}=bs(m),{data:C,isSuccess:w,isLoading:R,isFetching:b,refetch:L}=Ds(m),[B,{isLoading:H}]=hs(),{organizations:V,organizationIsLoading:M}=ea({}),{lookUpItems:G,lookUpItemsIsLoading:K}=k({lookUpType:"EmploymentType"}),{pensionaryStatus:_,pensionaryStatusIsLoading:Z}=sa({pensionaryStatusCategory:"R",pensionaryStatusIsDead:N}),o=t.useMemo(()=>y(V,"organizationID","organizationName"),[V]),A=t.useMemo(()=>y(G,"lookUpID","lookUpName"),[G]),F=t.useMemo(()=>y(_,"pensionaryStatusID","pensionaryStatusName"),[_]);t.useEffect(()=>{if(j){const p=d==null?void 0:d.itemList[0];if(p){const l={...p};Object.keys(l).forEach(i=>{i==="retirementDate"&&(l[i]=l[i]===null?null:ye(l[i])),i==="pensionaryStartdate"&&(l[i]=l[i]===null?null:ye(l[i])),x(i,l[i])})}}},[j,d==null?void 0:d.itemList,x]);const le=async p=>{const l=je(p,a,I),i=await B({...l,retiredGroup:parseInt(q(p.retiredGroup)),retiredJobDegreeCoef:parseInt(q(p.retiredJobDegreeCoef)),retiredRealDuration:parseInt(q(p.retiredRealDuration)),retiredGrantDuration:parseInt(q(p.retiredGrantDuration)),personID:m}).unwrap();f(),$(),L(),fe.success(i.message)};return t.useEffect(()=>{if(j){const p=d==null?void 0:d.itemList[0],l=Ne(p,a,I,{retiredOrganizationID:o,employmentTypeID:A,pensionaryStatusID:F});Object.keys(l).forEach(i=>{ia.includes(i)&&l[i]===null?x(i,""):x(i,l[i])})}},[j,d==null?void 0:d.itemList,o,A,F,x,a,I]),t.useEffect(()=>{if(w){const p=C==null?void 0:C.itemList.map((l,i)=>({id:l.pensionaryID,isActive:l.pensionaryIsActive,pensionaryStatusRowNum:i+1,pensionaryStatusName:l.pensionaryStatusName||"-",pensionaryStartdate:l.pensionaryStartdate||"-"}));h(p)}},[w,C==null?void 0:C.itemList]),e.jsx(e.Fragment,{children:v||P?e.jsx(ie,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(xe,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:D(le),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(n,{name:"retiredGroup",label:fs,control:u,required:!0,editable:c,rules:{...T,...S},type:"text"}),e.jsx(E,{name:"retiredOrganizationID",control:u,label:Ss,required:!0,isClearable:!0,isDisabled:!c,options:o,isLoading:M,rules:T,errors:r}),e.jsx(n,{name:"retiredLastPosition",label:js,control:u,required:!1,editable:c,rules:J,type:"text"}),e.jsx(E,{name:"employmentTypeID",control:u,label:gs,required:!0,isClearable:!0,isDisabled:!c,options:A,isLoading:K,rules:T,errors:r}),e.jsx(oe,{name:"retirementDate",label:ys,control:u,disabled:!c,required:!1,errors:r,rules:T,setValue:x}),e.jsx(E,{name:"pensionaryStatusID",control:u,label:Es,required:!0,isClearable:!0,isDisabled:!c,options:F,isLoading:Z,rules:T,errors:r}),e.jsx(oe,{name:"pensionaryStartdate",label:Ts,control:u,disabled:!c,required:!0,errors:r,rules:T,setValue:x}),e.jsx(n,{name:"retiredJobDegreeCoef",label:Ns,control:u,required:!1,editable:c,rules:S,type:"text"}),e.jsx(n,{name:"retiredGrantDuration",label:Cs,control:u,required:!1,editable:c,rules:S,type:"text"}),e.jsx(n,{name:"retiredRealDuration",label:As,control:u,required:!1,editable:c,rules:S,type:"text"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(W,{dir:"ltr",endIcon:e.jsx(be,{}),disabled:!c,variant:"contained",type:"submit",loading:H,color:"success",children:e.jsx("span",{children:De})}),e.jsx(W,{dir:"ltr",endIcon:e.jsx(Se,{}),onClick:f,disabled:c,variant:"contained",color:"primary",children:e.jsx("span",{children:he})})]}),e.jsx("div",{className:"flex-col flex-center",children:e.jsx("h5",{className:"title-secondary",children:"تاریخچه وضعیت ها"})}),e.jsx(aa,{data:s,isLoading:R,isFetching:b})]})})})},ua=()=>{const[s,h]=me(!1),[c,f]=t.useState([]),[U]=X(),m=U.get("personID"),N=t.useMemo(()=>["bankID","bankBranchID"],[]),a=t.useMemo(()=>[],[]),{control:I,handleSubmit:u,formState:{errors:D},setValue:r,watch:x}=Ie(),d=x("bankID"),{lookUpItems:j,lookUpItemsIsLoading:v}=k({lookUpType:"Bank"}),P=t.useMemo(()=>y(j,"lookUpID","lookUpName"),[j]),[$,{isLoading:C,isFetching:w}]=ta(),R=t.useMemo(()=>y(c,"lookUpID","lookUpName"),[c]),{data:b,isSuccess:L,isLoading:B,isFetching:H,refetch:V}=Rs(m),[M,{isLoading:G}]=Ls(),K=t.useCallback(async o=>{const A=await $({lookUpType:"BankBranch",lookUpParentID:o}).unwrap();f(A.itemList)},[$]),_=async o=>{const A=je(o,N,a),F=await M({...A,accountNo:q(o.accountNo)||null,ledgerCode:parseInt(q(o.ledgerCode))||null,insuranceAmount:parseFloat(q(o.insuranceAmount))||null,insuranceCoef:parseFloat(q(o.insuranceCoef))||null,personID:m}).unwrap();V(),h(),fe.success(F.message)};return t.useEffect(()=>{d?K(d.value):(r("bankBranchID",null),f([]))},[d,K,r]),t.useEffect(()=>{L&&({...b},Object.keys(b).forEach(o=>{la.includes(o)&&b[o]===null?r(o,""):r(o,b[o])}))},[L,b,r]),t.useEffect(()=>{L&&P.length>0&&r("bankID",P.find(o=>o.value===b.bankID))},[L,b,r,P]),t.useEffect(()=>{L&&R.length>0&&r("bankBranchID",R.find(o=>o.value===b.bankBranchID))},[L,b,r,R]),e.jsx(e.Fragment,{children:B||H?e.jsx(ie,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(xe,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:u(_),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(E,{name:"bankID",control:I,label:Us,required:!1,isClearable:!0,isDisabled:!s,options:P,isLoading:v,errors:D}),e.jsx(E,{name:"bankBranchID",control:I,label:Os,required:!1,isClearable:!0,isDisabled:!s,options:R,isLoading:C||w,errors:D}),e.jsx(n,{name:"accountNo",label:ks,rules:S,required:!1,control:I,editable:s,type:"text"}),e.jsx(n,{name:"ledgerCode",label:Ps,rules:S,required:!1,control:I,editable:s,type:"text"}),e.jsx(n,{name:"insuranceCoef",label:_s,rules:S,required:!1,control:I,editable:s,type:"text"}),e.jsx(n,{name:"insuranceAmount",label:Fs,rules:S,required:!1,control:I,editable:s,type:"text"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(W,{dir:"ltr",endIcon:e.jsx(be,{}),disabled:!s,variant:"contained",type:"submit",loading:G,color:"success",children:e.jsx("span",{children:De})}),e.jsx(W,{dir:"ltr",endIcon:e.jsx(Se,{}),onClick:h,disabled:s,variant:"contained",color:"primary",children:e.jsx("span",{children:he})})]})]})})})},pa=()=>{const[s]=X(),h=na([`${g}/${de}`,`${g}/${ue}`,`${g}/${pe}`,g]),c=s.toString(),{personDeathDate:f}=Te(a=>a.person),U=h==null?void 0:h.pattern.path,m=a=>c?`${a}?${c}`:a;return e.jsxs("div",{children:[e.jsx(ie,{sx:{bgcolor:"background.paper",borderRadius:1},children:e.jsxs(qs,{value:U,children:[e.jsx(ee,{label:f?vs:Bs,value:g,to:m(g),component:se}),e.jsx(ee,{label:Ms,value:`${g}/${de}`,to:m(`${g}/${de}`),component:se}),e.jsx(ee,{label:Gs,value:`${g}/${pe}`,to:m(`${g}/${pe}`),component:se}),e.jsx(ee,{label:$s,value:`${g}/${ue}`,to:m(`${g}/${ue}`),component:se})]})}),e.jsx(ws,{})]})},ka=()=>e.jsxs("section",{className:"flex-col mb-20",children:[e.jsx(Hs,{title:Vs,back:!0}),e.jsxs("div",{"data-name":"retired-forms",children:[e.jsxs(ae,{children:[e.jsx(te,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(ne,{}),children:Ks}),e.jsx(re,{children:e.jsx(ca,{})})]}),e.jsxs(ae,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(te,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(ne,{}),children:zs}),e.jsx(re,{children:e.jsx(da,{})})]}),e.jsxs(ae,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(te,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(ne,{}),children:Qs}),e.jsx(re,{children:e.jsx(ua,{})})]}),e.jsxs(ae,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(te,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(ne,{}),children:Ys}),e.jsx(re,{children:e.jsx(ra,{})})]})]}),e.jsx(pa,{})]});export{ka as default};
