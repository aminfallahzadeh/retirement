import{A as X,r as t,j as e,D as me,u as Le,h as Ie,F as Ue,H as Oe,J as Ee,B as le,C as xe,K as i,M as ke,N as T,P as Pe,Q as _e,S as Fe,U as qe,V as g,W as ve,X as Y,Y as Be,Z as ie,_ as Me,$ as Ge,a0 as $e,a1 as we,a2 as He,a3 as Ve,a4 as Ke,a5 as ze,a6 as Qe,a7 as Ye,a8 as Je,a9 as We,aa as Ze,ab as Xe,ac as es,ad as ss,ae as as,af as ts,ag as ns,ah as os,ai as rs,aj as is,ak as ls,al as cs,am as us,an as ds,ao as ps,ap as ms,aq as Is,ar as xs,as as bs,at as Ds,v as J,au as be,av as De,aw as fe,ax as he,i as Ne,ay as fs,az as hs,aA as gs,aB as ye,aC as Ss,aD as js,aE as Es,aF as ys,aG as Ts,aH as Ns,aI as Cs,aJ as As,aK as Rs,aL as Ls,aM as v,aN as Us,aO as Os,aP as ks,aQ as Ps,aR as _s,aS as Fs,aT as qs,aU as vs,aV as j,aW as ue,aX as de,aY as pe,aZ as Bs,a_ as se,a$ as Ms,b0 as Gs,L as ae,b1 as $s,b2 as ws,b3 as Hs,b4 as Vs,k as Ks,b5 as zs,b6 as Qs,b7 as Ys,b8 as Js,b9 as Ws}from"./index-Dnu3KgnM.js";import{u as Zs,a as Xs,c as ea,F as sa}from"./createTree-hPdII1MX.js";import{c as E,S as y}from"./SelectInput-C1TMMrlV.js";import{C as Q}from"./CustomCheckBox-zF-29xEh.js";import{T as Te}from"./TextArea-DZGNPll0.js";import{E as ge}from"./EditOutlined-BlD_6y8u.js";import{u as P,a as aa,b as ta}from"./useFetchLookUpData-DfTGI3v0.js";import{p as Ce,a as Se}from"./convertFormData-Bdw7AEDw.js";import{S as na}from"./StatusHistoryGrid-D_XjY3hD.js";import{u as oa}from"./sharedApi-Dnus55hW.js";import{u as ra}from"./useRouteMatch-DEmvtstv.js";import{A as te,a as ne,b as oe,c as re}from"./ArrowDropDown-BcHxLUqd.js";import"./index-DGjFYsA3.js";import"./react-select-animated.esm-BG-Q0fZg.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./requestApi-kmiWYlDj.js";import"./personnelApi-Tc9Oe2gQ.js";import"./fractionApi-D_-sPGyw.js";const ia=()=>{const[s]=X(),[f,l]=t.useState([]),[h,L]=t.useState([]),p=s.get("personID"),{data:N,isLoading:a,isSuccess:x,refetch:d}=Zs(),{data:b,isLoading:u,isSuccess:I,refetch:o}=Xs(p);t.useEffect(()=>{I&&L(b.itemList)},[I,b]),t.useEffect(()=>{if(x){const B=ea(N.itemList);l(B)}},[x,N]);const C=t.useCallback(()=>{d(),o()},[d,o]);return e.jsx(sa,{structure:f,files:h,isLoading:a||u,refetch:C,access:"files"})},la=["personFirstName","personLastName","personNationalCode","personCertificateNo","personFatherName","genderID","personBirthDate","personBirthPlace","personPreviousNam","personIsSacrificedFamily","personIsWarrior","personIsChildOfSacrificed","personIsValiant","personIsSacrificed","personIsCaptive","retiredID","personPhone","personCellPhone","backupPhone","backupFirstName","backupLastName","personEmail","educationTypeID","personCountryID","personStateID","personCityID","personRegion","personArea","personPostalCode","housingTypeID","maritalStatusID","personDeathDate","personAddress","personDescription"],ca=["retiredGroup","retiredOrganizationID","retiredLastPosition","employmentTypeID","retirementDate","pensionaryStatusID","pensionaryStartdate","retiredJobDegreeCoef","retiredGrantDuration","retiredRealDuration"],ua=["bankID","bankBranchID","accountNo","ledgerCode","insuranceCoef","insuranceAmount"],da=()=>{const[s,f]=me(!1),[l]=X(),h=Le(),L=l.get("personID"),p=t.useMemo(()=>["genderID","personCountryID","personStateID","personCityID","housingTypeID","educationTypeID","maritalStatusID"],[]),N=t.useMemo(()=>["personDeathDate","personBirthDate"],[]),{control:a,handleSubmit:x,formState:{errors:d},setValue:b,watch:u}=Ie(),I=u(),{data:o,isLoading:C,isFetching:B,isSuccess:U,refetch:$}=Ue(L),[A,{isLoading:w}]=Oe(),{lookUpItems:O,lookUpItemsIsLoading:D}=P({lookUpType:"Gender"}),S=t.useMemo(()=>E(O,"lookUpID","lookUpName"),[O]),{lookUpItems:H,lookUpItemsIsLoading:W}=P({lookUpType:"EducationType"}),_=t.useMemo(()=>E(H,"lookUpID","lookUpName"),[H]),{lookUpItems:V,lookUpItemsIsLoading:K}=P({lookUpType:"Country"}),F=t.useMemo(()=>E(V,"lookUpID","lookUpName"),[V]),{lookUpItems:M,lookUpItemsIsLoading:ee}=P({lookUpType:"State"}),n=t.useMemo(()=>E(M,"lookUpID","lookUpName"),[M]),{lookUpItems:R,lookUpItemsIsLoading:G}=P({lookUpType:"City"}),Z=t.useMemo(()=>E(R,"lookUpID","lookUpName"),[R]),{lookUpItems:m,lookUpItemsIsLoading:c}=P({lookUpType:"HousingType"}),r=t.useMemo(()=>E(m,"lookUpID","lookUpName"),[m]),{lookUpItems:je,lookUpItemsIsLoading:Ae}=P({lookUpType:"MaritialStatus"}),ce=t.useMemo(()=>E(je,"lookUpID","lookUpName"),[je]),Re=async q=>{const z=Se(q,p,N),k=await A({...z,personRegion:q.personRegion?parseInt(q.personRegion):null}).unwrap();$(),f(),he.success(k.message)};return t.useEffect(()=>{if(U){const q=o==null?void 0:o.itemList[0];h(Ee((q==null?void 0:q.personDeathDate)!==null));const z=Ce(q,p,N,{genderID:S,educationTypeID:_,personCountryID:F,personStateID:n,personCityID:Z,housingTypeID:r,maritalStatusID:ce});Object.keys(z).forEach(k=>{la.includes(k)&&z[k]===null?b(k,""):b(k,z[k])})}return()=>{h(Ee(null))}},[h,U,o==null?void 0:o.itemList,b,S,F,_,n,Z,r,ce,N,p]),t.useEffect(()=>{console.log(I)},[I]),e.jsx(e.Fragment,{children:C||B?e.jsx(le,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(xe,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:x(Re),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(i,{name:"personFirstName",label:ke,rules:T,required:!0,control:a,editable:s,type:"text"}),e.jsx(i,{name:"personLastName",label:Pe,rules:T,required:!0,control:a,editable:s,type:"text"}),e.jsx(i,{name:"personNationalCode",label:_e,rules:{...Fe,...T},required:!0,control:a,editable:s,type:"text"}),e.jsx(i,{name:"personCertificateNo",label:qe,rules:{...g,...T},required:!0,control:a,editable:s,type:"text"}),e.jsx(i,{name:"personFatherName",label:ve,rules:Y,required:!0,control:a,editable:s,type:"text"}),e.jsx(y,{name:"genderID",control:a,label:Be,required:!0,isClearable:!0,isDisabled:!s,options:S,isLoading:D,rules:T,errors:d}),e.jsx(ie,{name:"personBirthDate",label:Me,control:a,disabled:!s,required:!0,errors:d,rules:T,setValue:b}),e.jsx(i,{name:"personBirthPlace",label:Ge,rules:Y,required:!1,control:a,editable:s,type:"text"}),e.jsx(i,{name:"personPreviousName",label:$e,rules:Y,required:!1,control:a,editable:s,type:"text"}),e.jsxs("div",{className:s?"checkboxContainer col-span-3":"checkboxContainer--disabled col-span-3",children:[e.jsx("p",{className:"inputBox__form--readOnly-label",children:we}),e.jsx(Q,{disabled:!s,control:a,label:He,name:"personIsSacrificedFamily"}),e.jsx(Q,{disabled:!s,control:a,label:Ve,name:"personIsWarrior"}),e.jsx(Q,{disabled:!s,control:a,label:Ke,name:"personIsChildOfSacrificed"}),e.jsx(Q,{disabled:!s,control:a,label:ze,name:"personIsValiant"}),e.jsx(Q,{disabled:!s,control:a,label:Qe,name:"personIsSacrificed"}),e.jsx(Q,{disabled:!s,control:a,label:Ye,name:"personIsCaptive"})]}),e.jsx(i,{name:"retiredID",label:Je,required:!1,control:a,editable:!1,type:"text"}),e.jsx(i,{name:"personPhone",label:We,required:!1,rules:g,control:a,editable:s,type:"text"}),e.jsx(i,{name:"personCellPhone",label:Ze,required:!1,rules:Xe,control:a,editable:s,type:"text"}),e.jsx(i,{name:"backupPhone",label:es,required:!1,rules:g,control:a,editable:s,type:"text"}),e.jsx(i,{name:"backupFirstName",label:ss,required:!1,rules:Y,control:a,editable:s,type:"text"}),e.jsx(i,{name:"backupLastName",label:as,required:!1,rules:Y,control:a,editable:s,type:"text"}),e.jsx(i,{name:"personEmail",label:ts,required:!1,rules:ns,control:a,editable:s,type:"text"}),e.jsx(y,{name:"educationTypeID",control:a,label:os,required:!1,isClearable:!0,isDisabled:!s,options:_,isLoading:W}),e.jsx(y,{name:"personCountryID",control:a,label:rs,required:!1,isClearable:!0,isDisabled:!s,options:F,isLoading:K}),e.jsx(y,{name:"personStateID",control:a,label:is,required:!1,isClearable:!0,isDisabled:!s,options:n,isLoading:ee}),e.jsx(y,{name:"personCityID",control:a,label:ls,required:!1,isClearable:!0,isDisabled:!s,options:Z,isLoading:G}),e.jsx(i,{name:"personRegion",label:cs,required:!1,control:a,editable:s,rules:g,type:"text"}),e.jsx(i,{name:"personArea",label:us,required:!1,control:a,editable:s,rules:g,type:"text"}),e.jsx(i,{name:"personPostalCode",label:ds,required:!1,control:a,editable:s,rules:ps,type:"text"}),e.jsx(y,{name:"housingTypeID",control:a,label:ms,required:!1,isClearable:!0,isDisabled:!s,options:r,isLoading:c}),e.jsx(y,{name:"maritalStatusID",control:a,label:Is,required:!1,isClearable:!0,isDisabled:!s,options:ce,isLoading:Ae}),e.jsx(ie,{name:"personDeathDate",label:xs,control:a,disabled:!s,required:!1,setValue:b}),e.jsx(Te,{name:"personAddress",label:bs,required:!0,control:a,editable:s,containerClassNames:"col-span-3"}),e.jsx(Te,{name:"personDescription",label:Ds,required:!0,control:a,editable:s,containerClassNames:"col-span-4 row-span-2"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(J,{dir:"ltr",endIcon:e.jsx(be,{}),disabled:!s,variant:"contained",type:"submit",loading:w,color:"success",children:e.jsx("span",{children:De})}),e.jsx(J,{dir:"ltr",endIcon:e.jsx(ge,{}),onClick:f,disabled:s,variant:"contained",color:"primary",children:e.jsx("span",{children:fe})})]})]})})})},pa=()=>{const[s,f]=t.useState([]),[l,h]=me(!1),[L]=X(),p=L.get("personID"),{personDeathDate:N}=Ne(m=>m.person),a=t.useMemo(()=>["retiredOrganizationID","employmentTypeID","pensionaryStatusID"],[]),x=t.useMemo(()=>["retirementDate","pensionaryStartdate"],[]),{control:d,handleSubmit:b,formState:{errors:u},setValue:I}=Ie(),{data:o,isSuccess:C,isLoading:B,isFetching:U,refetch:$}=fs(p),{data:A,isSuccess:w,isLoading:O,isFetching:D,refetch:S}=hs(p),[H,{isLoading:W}]=gs(),{organizations:_,organizationIsLoading:V}=aa({}),{lookUpItems:K,lookUpItemsIsLoading:F}=P({lookUpType:"EmploymentType"}),{pensionaryStatus:M,pensionaryStatusIsLoading:ee}=ta({pensionaryStatusCategory:"R",pensionaryStatusIsDead:N}),n=t.useMemo(()=>E(_,"organizationID","organizationName"),[_]),R=t.useMemo(()=>E(K,"lookUpID","lookUpName"),[K]),G=t.useMemo(()=>E(M,"pensionaryStatusID","pensionaryStatusName"),[M]);t.useEffect(()=>{if(C){const m=o==null?void 0:o.itemList[0];if(m){const c={...m};Object.keys(c).forEach(r=>{r==="retirementDate"&&(c[r]=c[r]===null?null:ye(c[r])),r==="pensionaryStartdate"&&(c[r]=c[r]===null?null:ye(c[r])),I(r,c[r])})}}},[C,o==null?void 0:o.itemList,I]);const Z=async m=>{const c=Se(m,a,x),r=await H({...c,retiredGroup:parseInt(v(m.retiredGroup)),retiredJobDegreeCoef:parseInt(v(m.retiredJobDegreeCoef)),retiredRealDuration:parseInt(v(m.retiredRealDuration)),retiredGrantDuration:parseInt(v(m.retiredGrantDuration)),personID:p}).unwrap();h(),$(),S(),he.success(r.message)};return t.useEffect(()=>{if(C){const m=o==null?void 0:o.itemList[0],c=Ce(m,a,x,{retiredOrganizationID:n,employmentTypeID:R,pensionaryStatusID:G});Object.keys(c).forEach(r=>{ca.includes(r)&&c[r]===null?I(r,""):I(r,c[r])})}},[C,o==null?void 0:o.itemList,n,R,G,I,a,x]),t.useEffect(()=>{if(w){const m=A==null?void 0:A.itemList.map((c,r)=>({id:c.pensionaryID,isActive:c.pensionaryIsActive,pensionaryStatusRowNum:r+1,pensionaryStatusName:c.pensionaryStatusName||"-",pensionaryStartdate:c.pensionaryStartdate||"-"}));f(m)}},[w,A==null?void 0:A.itemList]),e.jsx(e.Fragment,{children:B||U?e.jsx(le,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(xe,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:b(Z),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(i,{name:"retiredGroup",label:Ss,control:d,required:!0,editable:l,rules:{...T,...g},type:"text"}),e.jsx(y,{name:"retiredOrganizationID",control:d,label:js,required:!0,isClearable:!0,isDisabled:!l,options:n,isLoading:V,rules:T,errors:u}),e.jsx(i,{name:"retiredLastPosition",label:Es,control:d,required:!1,editable:l,rules:Y,type:"text"}),e.jsx(y,{name:"employmentTypeID",control:d,label:ys,required:!0,isClearable:!0,isDisabled:!l,options:R,isLoading:F,rules:T,errors:u}),e.jsx(ie,{name:"retirementDate",label:Ts,control:d,disabled:!l,required:!1,errors:u,rules:T,setValue:I}),e.jsx(y,{name:"pensionaryStatusID",control:d,label:Ns,required:!0,isClearable:!0,isDisabled:!l,options:G,isLoading:ee,rules:T,errors:u}),e.jsx(ie,{name:"pensionaryStartdate",label:Cs,control:d,disabled:!l,required:!0,errors:u,rules:T,setValue:I}),e.jsx(i,{name:"retiredJobDegreeCoef",label:As,control:d,required:!1,editable:l,rules:g,type:"text"}),e.jsx(i,{name:"retiredGrantDuration",label:Rs,control:d,required:!1,editable:l,rules:g,type:"text"}),e.jsx(i,{name:"retiredRealDuration",label:Ls,control:d,required:!1,editable:l,rules:g,type:"text"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(J,{dir:"ltr",endIcon:e.jsx(be,{}),disabled:!l,variant:"contained",type:"submit",loading:W,color:"success",children:e.jsx("span",{children:De})}),e.jsx(J,{dir:"ltr",endIcon:e.jsx(ge,{}),onClick:h,disabled:l,variant:"contained",color:"primary",children:e.jsx("span",{children:fe})})]}),e.jsx("div",{className:"flex-col flex-center",children:e.jsx("h5",{className:"title-secondary",children:"تاریخچه وضعیت ها"})}),e.jsx(na,{data:s,isLoading:O,isFetching:D})]})})})},ma=()=>{const[s,f]=me(!1),[l,h]=t.useState([]),[L]=X(),p=L.get("personID"),N=t.useMemo(()=>["bankID","bankBranchID"],[]),a=t.useMemo(()=>[],[]),{control:x,handleSubmit:d,formState:{errors:b},setValue:u,watch:I}=Ie(),o=I("bankID"),{lookUpItems:C,lookUpItemsIsLoading:B}=P({lookUpType:"Bank"}),U=t.useMemo(()=>E(C,"lookUpID","lookUpName"),[C]),[$,{isLoading:A,isFetching:w}]=oa(),O=t.useMemo(()=>E(l,"lookUpID","lookUpName"),[l]),{data:D,isSuccess:S,isLoading:H,isFetching:W,refetch:_}=Us(p),[V,{isLoading:K}]=Os(),F=t.useCallback(async n=>{const R=await $({lookUpType:"BankBranch",lookUpParentID:n}).unwrap();h(R.itemList)},[$]),M=async n=>{const R=Se(n,N,a),G=await V({...R,accountNo:v(n.accountNo)||null,ledgerCode:parseInt(v(n.ledgerCode))||null,insuranceAmount:parseFloat(v(n.insuranceAmount))||null,insuranceCoef:parseFloat(v(n.insuranceCoef))||null,personID:p}).unwrap();_(),f(),he.success(G.message)};return t.useEffect(()=>{o?F(o.value):(u("bankBranchID",null),h([]))},[o,F,u]),t.useEffect(()=>{S&&({...D},Object.keys(D).forEach(n=>{ua.includes(n)&&D[n]===null?u(n,""):u(n,D[n])}))},[S,D,u]),t.useEffect(()=>{S&&U.length>0&&u("bankID",U.find(n=>n.value===D.bankID))},[S,D,u,U]),t.useEffect(()=>{S&&O.length>0&&u("bankBranchID",O.find(n=>n.value===D.bankBranchID))},[S,D,u,O]),e.jsx(e.Fragment,{children:H||W?e.jsx(le,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(xe,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:d(M),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(y,{name:"bankID",control:x,label:ks,required:!1,isClearable:!0,isDisabled:!s,options:U,isLoading:B,errors:b}),e.jsx(y,{name:"bankBranchID",control:x,label:Ps,required:!1,isClearable:!0,isDisabled:!s,options:O,isLoading:A||w,errors:b}),e.jsx(i,{name:"accountNo",label:_s,rules:g,required:!1,control:x,editable:s,type:"text"}),e.jsx(i,{name:"ledgerCode",label:Fs,rules:g,required:!1,control:x,editable:s,type:"text"}),e.jsx(i,{name:"insuranceCoef",label:qs,rules:g,required:!1,control:x,editable:s,type:"text"}),e.jsx(i,{name:"insuranceAmount",label:vs,rules:g,required:!1,control:x,editable:s,type:"text"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(J,{dir:"ltr",endIcon:e.jsx(be,{}),disabled:!s,variant:"contained",type:"submit",loading:K,color:"success",children:e.jsx("span",{children:De})}),e.jsx(J,{dir:"ltr",endIcon:e.jsx(ge,{}),onClick:f,disabled:s,variant:"contained",color:"primary",children:e.jsx("span",{children:fe})})]})]})})})},Ia=()=>{const[s]=X(),f=ra([`${j}/${ue}`,`${j}/${de}`,`${j}/${pe}`,j]),l=s.toString(),{personDeathDate:h}=Ne(a=>a.person),L=f==null?void 0:f.pattern.path,p=a=>l?`${a}?${l}`:a;return e.jsxs("div",{children:[e.jsx(le,{sx:{bgcolor:"background.paper",borderRadius:1},children:e.jsxs(Bs,{value:L,children:[e.jsx(se,{label:h?Ms:Gs,value:j,to:p(j),component:ae}),e.jsx(se,{label:$s,value:`${j}/${ue}`,to:p(`${j}/${ue}`),component:ae}),e.jsx(se,{label:ws,value:`${j}/${pe}`,to:p(`${j}/${pe}`),component:ae}),e.jsx(se,{label:Hs,value:`${j}/${de}`,to:p(`${j}/${de}`),component:ae})]})}),e.jsx(Vs,{})]})},_a=()=>e.jsxs("section",{className:"flex-col mb-20",children:[e.jsx(Ks,{title:zs,back:!0}),e.jsxs("div",{"data-name":"retired-forms",children:[e.jsxs(te,{children:[e.jsx(ne,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(oe,{}),children:Qs}),e.jsx(re,{children:e.jsx(da,{})})]}),e.jsxs(te,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(ne,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(oe,{}),children:Ys}),e.jsx(re,{children:e.jsx(pa,{})})]}),e.jsxs(te,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(ne,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(oe,{}),children:Js}),e.jsx(re,{children:e.jsx(ma,{})})]}),e.jsxs(te,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(ne,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(oe,{}),children:Ws}),e.jsx(re,{children:e.jsx(ia,{})})]})]}),e.jsx(Ia,{})]});export{_a as default};
