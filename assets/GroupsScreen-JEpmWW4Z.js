import{r as t,aI as Z,j as e,B as Q,k as E,w as F,Y as H,A as b,a0 as w,l as T,aJ as W,aK as X,u as P,_ as B,am as L,aL as K,S as G,d as z,aM as $,aN as ee,aO as O,aP as se,Z as M,aQ as ae,aR as te,aS as oe,aT as ne,aU as ie,aV as le,T as D,I as N,al as re,ao as k,ap as ce,v as de,P as me,a as ue,C as he,b as fe,L as xe,F as pe,R as ge,f as je,an as Ie}from"./index-X3WDRIPv.js";import{D as Se,a as be,C as Ce}from"./KeyboardDoubleArrowRight-DgLGnML0.js";import{E as ye}from"./EditOutlined-1W0JV1DN.js";function Ne({setShowEditModal:o,selectedGroup:i}){const[r,I]=t.useState(!0),[l,d]=t.useState(""),[f,{isLoading:x}]=Z(),u=c=>{d(c.target.value)};t.useEffect(()=>{i&&d(i.groupName)},[i]);const p=async()=>{var c;try{const a=await f({id:i.id,groupName:l}).unwrap();o(!1),b.success(a.message,{autoClose:2e3})}catch(a){b.error(((c=a==null?void 0:a.data)==null?void 0:c.message)||a.error,{autoClose:2e3})}};return t.useEffect(()=>{i&&d(i.groupName)},[i]),t.useEffect(()=>{const c=setTimeout(()=>{I(!1)},300);return()=>clearTimeout(c)},[]),e.jsx(e.Fragment,{children:r?e.jsx(Q,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(E,{color:"primary"})}):e.jsxs("section",{className:"formContainer flex-col",children:[e.jsxs("form",{method:"POST",className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input inputBox__form--input-height-40",required:!0,id:"groupName",value:l,onChange:u}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"groupName",children:"نام گروه"})]}),e.jsx("div",{style:{marginRight:"auto"},children:e.jsx(F,{dir:"ltr",endIcon:e.jsx(H,{}),loading:x,onClick:p,variant:"contained",color:"success",disabled:l===(i==null?void 0:i.name)||!l,sx:{fontFamily:"sahel"},children:e.jsx("span",{children:"ذخیره"})})})]})})}function we(){const{itemsTableData:o}=w(a=>a.itemsData),{groupItemsTableData:i}=w(a=>a.groupItemsData),[r,I]=t.useState({}),l=T(),{data:d,isLoading:f,isSuccess:x,error:u,refetch:p}=W();t.useEffect(()=>{var a;if(p(),x){const m=d.itemList.map(s=>({id:s.id,itemName:s.itemName})).filter(s=>!i.map(j=>j.id).includes(s.id));l(X(m))}else u&&b.error(((a=u==null?void 0:u.data)==null?void 0:a.message)||u.error,{autoClose:2e3,style:{fontSize:"18px"}})},[d,x,l,p,i,u]);const h=t.useMemo(()=>[{accessorKey:"itemName",header:"دسترسی ها",size:300}],[]),c=P({...B,columns:h,data:o,positionGlobalFilter:"left",initialState:{density:"compact",showGlobalFilter:!0},muiTableBodyRowProps:({row:a})=>({onClick:()=>I(()=>({[a.id]:!0})),selected:r[a.id],sx:{cursor:"pointer"}}),enablePagination:!1,muiTableContainerProps:{sx:{height:"300px"}},enableBottomToolbar:!1,getRowId:a=>a.id,onRowSelectionChange:I,state:{rowSelection:r}});return t.useEffect(()=>{const a=Object.keys(c.getState().rowSelection)[0],S=L(o,a);l(a&&S?K(S):K(null))},[l,c,r,o]),e.jsx(e.Fragment,{children:f?e.jsx("div",{className:"skeleton-md",children:e.jsx(G,{count:7,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl",width:280})}):e.jsx(z,{table:c})})}function De({selectedGroup:o}){const[i,r]=t.useState({}),[I,l]=t.useState(null),d=T(),{groupItemsTableData:f}=w(s=>s.groupItemsData);t.useEffect(()=>{o&&l(o.id)},[o]);const{data:x,isSuccess:u,isLoading:p,error:h,refetch:c}=$(I);t.useEffect(()=>{var s;if(c(),u){const j=x.itemList.map(C=>({id:C.itemID,itemName:C.itemName}));d(ee(j))}else h&&b.error(((s=h==null?void 0:h.data)==null?void 0:s.message)||h.error,{autoClose:2e3,style:{fontSize:"18px"}})},[x,u,d,c,h]);const a=t.useMemo(()=>[{accessorKey:"itemName",size:300,header:e.jsxs("span",{children:["دسترسی های گروه:"," ",e.jsx("span",{style:{fontStyle:"italic",color:"#03620a"},children:o==null?void 0:o.groupName})]})}],[o==null?void 0:o.groupName]),S=P({...B,columns:a,data:f,positionGlobalFilter:"left",enablePagination:!1,muiTableContainerProps:{sx:{height:"300px"}},enableBottomToolbar:!1,initialState:{density:"compact",showGlobalFilter:!0},muiTableBodyRowProps:({row:s})=>({onClick:()=>r(()=>({[s.id]:!0})),selected:i[s.id],sx:{cursor:"pointer"}}),getRowId:s=>s.id,onRowSelectionChange:r,state:{rowSelection:i}});return t.useEffect(()=>{const s=Object.keys(S.getState().rowSelection)[0],j=L(f,s);d(s&&j?O(j):O(null))},[d,S,i,f]),e.jsx(e.Fragment,{children:p?e.jsx("div",{className:"skeleton-md",children:e.jsx(G,{count:7,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl",width:280})}):e.jsx(z,{table:S})})}function ve({selectedGroup:o,setShowEditItemsModal:i}){const[r,I]=t.useState(null),l=T(),{selectedItemData:d}=w(m=>m.itemsData),{selectedGroupItemData:f}=w(m=>m.groupItemsData);t.useEffect(()=>{o&&I(o.id)},[o]);const{groupItemsTableData:x}=w(m=>m.groupItemsData),[u,{isLoading:p}]=se(),h=async()=>{var m;try{const s=x.map(C=>({id:"",itemID:C.id,itemName:"",groupID:r})),j=await u(s).unwrap();console.log(j),b.success(j.message,{autoClose:2e3}),i(!1)}catch(s){console.log(s),b.error(((m=s==null?void 0:s.data)==null?void 0:m.message)||s.error,{autoClose:2e3})}},c=m=>{l(ae(d)),l(te(m))},a=m=>{l(oe(f)),l(ne(m))};return e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",rowGap:"10px"},children:[e.jsx(M,{onClick:()=>c(d.id),variant:"contained",color:"primary",children:e.jsx(Se,{})}),e.jsx(M,{onClick:()=>a(f.id),variant:"contained",color:"primary",children:e.jsx(be,{})}),e.jsx(F,{dir:"ltr",endIcon:e.jsx(H,{}),loading:p,onClick:h,variant:"contained",color:"success",sx:{fontFamily:"sahel"},children:e.jsx("span",{children:"ذخیره"})})]})}function Te(){const[o,i]=t.useState([]),[r,I]=t.useState(null),[l,d]=t.useState({}),[f,x]=t.useState(!1),[u,p]=t.useState(!1),[h,c]=t.useState(!1),[a,{isLoading:S}]=ie(),m=T(),{data:s,isLoading:j,isFetching:C,isSuccess:_,error:y,refetch:v}=le(),U=()=>{x(!0)},q=()=>{c(!0)},J=()=>{p(!0)},A=()=>{v()},V=async()=>{var n;try{const g=await a({id:r==null?void 0:r.id,groupName:r==null?void 0:r.groupName,isdeleted:!0}).unwrap();c(!1),v(),b.success(g.message,{autoClose:2e3,style:{fontSize:"18px"}})}catch(g){b.error(((n=g==null?void 0:g.data)==null?void 0:n.message)||g.error,{autoClose:2e3,style:{fontSize:"18px"}})}};t.useEffect(()=>{if(v(),_){const n=s.itemList.map(g=>({id:g.id,groupName:g.groupName}));i(n)}},[s,_,m,v,h,f,u]),t.useEffect(()=>{var n;y&&(console.log(y),b.error(((n=y==null?void 0:y.data)==null?void 0:n.message)||y.error,{autoClose:2e3}))},[y]);const Y=t.useMemo(()=>[{accessorKey:"groupName",header:"نام گروه",size:20},{accessorKey:"editGroupNameAction",header:"ویرایش گروه",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:n})=>e.jsx(D,{title:n.original.groupName,children:e.jsx(N,{color:"success",onClick:U,sx:{padding:"0"},children:e.jsx(ye,{})})})},{accessorKey:"editItemsAction",header:"ویرایش دسترسی ها",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:n})=>e.jsx(D,{title:n.original.groupName,children:e.jsx(N,{color:"primary",onClick:J,sx:{padding:"0"},children:e.jsx(Ce,{})})})},{accessorKey:"deleteGroupAction",header:"حذف گروه",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:n})=>e.jsx(D,{title:n.original.groupName,children:e.jsx(N,{color:"error",onClick:q,sx:{padding:"0"},children:e.jsx(re,{})})})}],[]),R=P({...B,columns:Y,data:o,muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:n=>e.jsx(me,{...n,page:ue(n.page),slots:{previous:he,next:fe,first:xe,last:pe}})},muiTableBodyRowProps:({row:n})=>({onClick:()=>d(()=>({[n.id]:!0})),selected:l[n.id],sx:{cursor:"pointer"}}),renderTopToolbarCustomActions:()=>e.jsxs(Q,{children:[C?e.jsx(N,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(E,{size:20,value:100})}):e.jsx(D,{title:"بروز رسانی",children:e.jsx("span",{children:e.jsx(N,{"aria-label":"refresh",color:"info",onClick:A,children:e.jsx(ge,{fontSize:"small"})})})}),e.jsx(je,{to:"/retirement/create-group",children:C?e.jsx(N,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(E,{size:20,value:100,color:"success"})}):e.jsx(D,{title:"ایجاد گروه",children:e.jsx("span",{children:e.jsx(N,{"aria-label":"refresh",color:"success",onClick:A,children:e.jsx(Ie,{fontSize:"small"})})})})})]}),getRowId:n=>n.id,onRowSelectionChange:d,state:{rowSelection:l}});return t.useEffect(()=>{const n=Object.keys(R.getState().rowSelection)[0],g=L(o,n);g&&I(g)},[R,o,l]),e.jsx(e.Fragment,{children:j?e.jsx("div",{className:"skeleton-lg",children:e.jsx(G,{count:5,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl"})}):e.jsxs(e.Fragment,{children:[f?e.jsx(k,{title:"ویرایش نام گروه",closeModal:()=>x(!1),children:e.jsx(Ne,{setShowEditModal:x,selectedGroup:r})}):h?e.jsxs(k,{title:"حذف گروه",closeModal:()=>c(!1),children:[e.jsx("p",{className:"paragraph-primary",children:"آیا از حذف این گروه اطمینان دارید؟"}),e.jsxs("div",{className:"flex-row flex-center",children:[e.jsx(F,{dir:"ltr",endIcon:e.jsx(ce,{}),loading:S,onClick:V,variant:"contained",color:"success",sx:{fontFamily:"sahel"},children:e.jsx("span",{children:"بله"})}),e.jsx(M,{dir:"ltr",endIcon:e.jsx(de,{}),onClick:()=>c(!1),variant:"contained",color:"error",sx:{fontFamily:"sahel"},children:e.jsx("span",{children:"خیر"})})]})]}):u?e.jsx(k,{title:"ویرایش دسترسی ها",closeModal:()=>p(!1),children:e.jsxs("div",{className:"formContainer flex-row",children:[e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"دسترسی ها"})}),e.jsx(we,{})]}),e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"عملیات"})}),e.jsx("div",{style:{marginTop:"6rem"},children:e.jsx(ve,{selectedGroup:r,setShowEditItemsModal:p})})]}),e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"دسترسی های گروه"})}),e.jsx(De,{selectedGroup:r})]})]})}):null,e.jsx(z,{table:R})]})})}function Fe(){return e.jsxs("section",{className:"flex-col",children:[e.jsx("div",{className:"title-primary--container flex-row flex-center",children:e.jsxs("h4",{className:"title-primary",children:[e.jsx("span",{className:"title-primary--underline"}),"مدیریت گروه ها"]})}),e.jsx(Te,{})]})}export{Fe as default};
