import{c as ae,j as e,r as t,a as X,u as he,Y as ge,P as be,C as je,b as fe,L as ve,F as _e,d as Ne,D as ie,_ as Me,cI as ye,S as x,U as a,V as h,w as W,ao as Ce,X as te,an as Oe,B as ce,k as Se,z as Z,cJ as Be,cK as Ge,p as Fe,l as ee,cL as Te,N as $,ak as R,cM as A,T as se,I as ne,al as De,aj as Le,cN as H,ax as ke,ay as Ie,az as le,aF as oe}from"./index-BmsaxOuK.js";import{u as V,w as we}from"./xlsx-uoQkVabA.js";const Re=ae(e.jsx("path",{d:"M13 5v6h1.17L12 13.17 9.83 11H11V5zm2-2H9v6H5l7 7 7-7h-4zm4 15H5v2h14z"}),"GetAppOutlined"),Pe=ae(e.jsx("path",{d:"M10 8.64 15.27 12 10 15.36zM8 5v14l11-7z"}),"PlayArrowOutlined");function Ee({tableData:i}){const[d,p]=t.useState({}),m=t.useMemo(()=>!i||i.length===0?[]:Object.keys(i[0]).map(u=>({accessorKey:u,header:u,size:20,Cell:({renderedCellValue:f})=>f===!0?e.jsx("div",{children:"فعال"}):f?e.jsx("div",{children:X(f)}):e.jsx("div",{children:"-"})})),[i]),s=he({...ge,columns:m,data:i,defaultColumn:{minSize:5,maxSize:1e3},muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:u=>e.jsx(be,{...u,page:X(u.page),slots:{previous:je,next:fe,first:ve,last:_e}})},muiTableBodyRowProps:({row:u})=>({onClick:()=>p(()=>({[u.id]:!0})),selected:d[u.id],sx:{cursor:"pointer"}}),getRowId:u=>u.id,onRowSelectionChange:p,state:{rowSelection:d}});return e.jsx(Ne,{table:s})}function ze({fetureOptions:i,isColsLoading:d,isColsFetching:p,tableName:m,reportName:s}){const[n,u]=t.useState({}),[f,G]=t.useState(!0),[D,L]=t.useState([]),g=ie(),{queryCondi:C,selectIDs:P}=Me(o=>o.reportGeneratorData),[k,{isLoading:v,isFetching:_}]=ye(),O=[{value:"Min",label:"MIN"},{value:"Max",label:"MAX"},{value:"Count",label:"COUNT"},{value:"Avg",label:"AVG"}],b=(o,y)=>{const{name:M}=y;if(o){const{value:c}=o;u({...n,[M]:c||""})}else u({...n,[M]:null})},I=async o=>{var y,M;try{const c=await k({...n,txtSelectPart:P,ConditionsCode:C,ForSave:o,ReportName:s}).unwrap(),T=JSON.parse(c.noneobject);L(T),G(!1),console.log(T),Z.success(c.message||((y=c==null?void 0:c.error)==null?void 0:y.data.message),{autoClose:2e3})}catch(c){console.log(c),Z.error(((M=c==null?void 0:c.data)==null?void 0:M.message)||c.error,{autoClose:2e3})}},S=(o,y)=>{const M=V.json_to_sheet(o),c=V.book_new();V.book_append_sheet(c,M,"Sheet1"),we(c,`${y}.xlsx`)},N=()=>{S(D,"گزارش")};return t.useEffect(()=>{console.log(n)},[n]),e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"formContainer",children:e.jsx("form",{method:"POST",className:"flex-col",children:e.jsxs("div",{className:"flex-col",children:[e.jsxs("div",{className:"flex-col",style:{border:"1px solid #ddd",padding:"10px",borderRadius:"5px"},children:[e.jsx("h4",{className:"condition__box--title",children:"دسته بندی:"}),e.jsxs("div",{className:"grid grid--col-4",children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:g,options:i,onChange:b,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupField0)),name:"cmbGroupField0",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"ستون"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||p,isDisabled:!m}),e.jsx("label",{className:n!=null&&n.cmbGroupField0?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"ستون"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:g,options:O,onChange:b,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupFunction0)),name:"cmbGroupFunction0",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"تجمیع"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||p,isDisabled:!m||!n.cmbGroupField0}),e.jsx("label",{className:n!=null&&n.cmbGroupFunction0?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"تجمیع"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:g,options:i,onChange:b,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupField1)),name:"cmbGroupField1",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"ستون"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||p,isDisabled:!m}),e.jsx("label",{className:n!=null&&n.cmbGroupField1?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"ستون"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:g,options:O,onChange:b,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupFunction1)),name:"cmbGroupFunction1",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"تجمیع"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||p,isDisabled:!m||!n.cmbGroupField1}),e.jsx("label",{className:n!=null&&n.cmbGroupFunction1?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"تجمیع"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:g,options:i,onChange:b,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupField2)),name:"cmbGroupField2",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"ستون"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||p,isDisabled:!m}),e.jsx("label",{className:n!=null&&n.cmbGroupField2?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"ستون"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:g,options:O,onChange:b,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupFunction2)),name:"cmbGroupFunction2",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"تجمیع"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||p,isDisabled:!m||!n.cmbGroupField2}),e.jsx("label",{className:n!=null&&n.cmbGroupFunction2?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"تجمیع"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:g,options:i,onChange:b,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupField3)),name:"cmbGroupField3",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"ستون"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||p,isDisabled:!m}),e.jsx("label",{className:n!=null&&n.cmbGroupField3?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"ستون"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:g,options:O,onChange:b,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupFunction3)),name:"cmbGroupFunction3",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"تجمیع"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||p,isDisabled:!m||!n.cmbGroupField3}),e.jsx("label",{className:n!=null&&n.cmbGroupFunction3?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"تجمیع"})]})]})]}),e.jsxs("div",{style:{marginRight:"auto"},className:"flex-row",children:[e.jsx(W,{dir:"ltr",variant:"contained",endIcon:e.jsx(Ce,{}),onClick:()=>I(!0),loading:v||_,color:"success",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:"ذخیره"})}),e.jsx(W,{dir:"ltr",variant:"contained",endIcon:e.jsx(Pe,{}),onClick:()=>I(!1),loading:v||_,color:"primary",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:"اجرای گزارش"})}),e.jsx(te,{dir:"ltr",endIcon:e.jsx(Re,{}),variant:"contained",disabled:f,onClick:N,color:"warning",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:"خروجی اکسل"})})]})]})})}),e.jsx(Ee,{tableData:D}),v||_?e.jsxs(Oe,{title:"در حال ایجاد گزارش",children:[e.jsx("p",{className:"paragraph-primary",style:{textAlign:"center"},children:"لطفا منتظر بمانید..."}),e.jsx(ce,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(Se,{color:"primary"})})]}):null]})}function $e(){const[i,d]=t.useState(!1),[p,m]=t.useState(!0),[s,n]=t.useState({operator:"%3D"}),[u,f]=t.useState(""),[G,D]=t.useState([]),[L,g]=t.useState([]),[C,P]=t.useState(!1),[k,{isLoading:v,isFetching:_}]=Be(),[O,{isLoading:b,isFetching:I}]=Ge(),S=ie(),N=Fe(),{queryCondi:E}=ee(l=>l.reportGeneratorData),{role:o}=ee(l=>l.role),{reportGeneratorTables:y,reportGeneratorTablesIsLoading:M,reportGeneratorTablesIsFetching:c}=Te(o==null?void 0:o.value),T=$(y,"tableName","tableNameFarsi"),F=$(G,"id","columnTitle"),z=[{value:"%3D",label:"="},{value:"%3E",label:">"},{value:"%3C",label:"<"},{value:"%3E%3D",label:">="},{value:"%3C%3D",label:"<="},{value:"LIKE",label:"LIKE"}],re=$(L,"value","text"),q=t.useCallback(async l=>{try{const r=await k(l).unwrap();D(r.itemList)}catch(r){console.log(r)}},[k]);t.useEffect(()=>{s.TableName&&q(s.TableName)},[s.TableName,q]);const K=t.useCallback(async l=>{try{const r=await O(l).unwrap();g(r.itemList)}catch(r){console.log(r)}},[O]);t.useEffect(()=>{C&&K(s.columnid)},[s,K,C]),t.useEffect(()=>{if(s.columnid){const l=R(G,s.columnid);l&&P(l.isLookup!==0)}},[s,G]);const de=(l,r,j)=>{let B;const U=R(G,l).columnTitle,J=R(z,r,"value").label;if(C){const xe=R(L,j,"value").text;B=`${U} ${J} ${xe}`}else N(H(E+`%23${l}%23${r}%23${j}`)),B=`${U} ${J} ${j}`;f(u+" "+B),d(!0),m(!1)},Q=l=>{const{name:r,value:j}=l.target;n({...s,[r]:j})},w=(l,r)=>{const{name:j}=r;if(l){const{value:B}=l;n({...s,[j]:B||""})}else n({...s,[j]:null})},ue=(l,r)=>{const j=r.name,B=l?l.map(Y=>Y.value):[];n({...s,[j]:B})};t.useEffect(()=>{s.tableSelects&&s.tableSelects.length===1?N(A(s.tableSelects[0]+"%24")):s.tableSelects&&s.tableSelects.length===0?N(A("")):s.tableSelects&&s.tableSelects.length>1&&N(A(s.tableSelects.join("%24")+"%24"))},[s.tableSelects,N]);const pe=()=>{N(H("")),f(""),d(!1),m(!0),n({...s,condition:""})},me=l=>{f(r=>`${r} ${l}`),N(H(E+`%24${l}%24`)),d(!1),m(!0)};return e.jsxs("section",{className:"formContainer flex-col",children:[e.jsxs("form",{method:"POST",className:"flex-col",children:[e.jsxs("div",{className:"grid grid--col-4",style:{border:"1px solid #ddd",padding:"10px",borderRadius:"5px"},children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",id:"reportName",name:"reportName",onChange:Q,value:s.reportName||"",className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"reportName",className:"inputBox__form--label",children:"نام گزارش"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:S,options:T,onChange:w,value:T.find(l=>l.value===(s==null?void 0:s.TableName)),name:"TableName",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"جدول"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:M||c}),e.jsx("label",{className:s!=null&&s.TableName?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"جدول"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:S,options:F,onChange:ue,value:F.find(l=>l.value===(s==null?void 0:s.tableSelects)),name:"tableSelects",isMulti:!0,isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"انتخاب ستون های خروجی"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:v||_,isDisabled:v||_||!s.TableName}),e.jsx("label",{className:s!=null&&s.tableSelects&&(s==null?void 0:s.tableSelects.length)>0?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"انتخاب ستون های خروجی"})]})]}),e.jsxs("div",{className:"flex-col",style:{border:"1px solid #ddd",padding:"10px",borderRadius:"5px"},children:[e.jsxs("div",{className:"grid grid--col-4-mid-sm-last-sm",children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:S,options:F,onChange:w,value:F.find(l=>l.value===(s==null?void 0:s.columnid)),name:"columnid",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"خصوصیت شرط پذیر"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:v||_,isDisabled:v||_||!s.TableName}),e.jsx("label",{className:s!=null&&s.columnid?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"خصوصیت شرط پذیر"})]}),e.jsx(x,{closeMenuOnSelect:!0,components:S,options:z,onChange:w,value:z.find(l=>l.value===(s==null?void 0:s.operator)),name:"operator",isClearable:!1,noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h}),s.columnid&&!C&&e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",value:s.condition,id:"condition",name:"condition",onChange:Q,required:!0}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"condition",children:"شرط"})]}),s.columnid&&C&&e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:S,options:re,onChange:w,value:F.find(l=>l.value===(s==null?void 0:s.condition)),name:"condition",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"شرط"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:I||b}),e.jsx("label",{className:s!=null&&s.condition?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"شرط"})]}),e.jsxs("div",{children:[e.jsx(se,{title:"افزودن شرط",children:e.jsx("span",{children:e.jsx(ne,{color:"success",onClick:()=>de(s.columnid,s.operator,s.condition),disabled:!s.TableName||!s.operator||!s.columnid||!s.condition||i,children:e.jsx(De,{})})})}),e.jsx(se,{title:"پاک کردن تمامی شروط",children:e.jsx("span",{children:e.jsx(ne,{color:"error",onClick:pe,children:e.jsx(Le,{})})})})]})]}),e.jsxs("div",{className:"grid grid--col-2-first-sm",children:[e.jsx("div",{className:"grid grid--col-2",children:["or","and","(",")","null","%"].map(l=>e.jsx(te,{dir:"ltr",variant:"contained",color:"info",disabled:p,onClick:()=>me(l),sx:{fontFamily:"sahel"},children:e.jsx("span",{children:l.toUpperCase()})},l))}),e.jsxs("div",{className:"condition__box row-span-3",children:[e.jsx("h4",{className:"condition__box--title",children:"شروط انتخاب شده:"}),e.jsx("p",{children:u})]})]})]})]}),e.jsx(ze,{fetureOptions:F,isColsLoading:v,isColsFetching:_,tableName:s.TableName,reportName:s.reportName})]})}function Ke(){const[i,d]=t.useState("1"),p=(s,n)=>{d(n)};return e.jsxs("section",{className:"flex-col",children:[e.jsx("div",{className:"title-primary--container flex-row flex-center",children:e.jsx("h4",{className:"title-primary",children:e.jsx("span",{className:"title-primary--underline",children:"گزارش ساز"})})}),e.jsx("div",{children:e.jsxs(ke,{value:i,children:[e.jsx(ce,{sx:{bgcolor:"background.paper",borderRadius:1},children:e.jsxs(Ie,{onChange:p,"aria-label":"tabs",children:[e.jsx(le,{label:"گزارش جدید",value:"1"}),e.jsx(le,{label:"گزارش های ثبت شده",value:"2"})]})}),e.jsx(oe,{value:"1",sx:{padding:"0"},children:e.jsx($e,{})}),e.jsx(oe,{value:"2",sx:{padding:"0"}})]})})]})}export{Ke as default};
