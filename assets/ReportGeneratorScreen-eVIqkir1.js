import{c as te,j as e,r as t,cS as ie,aZ as _e,cT as q,dH as ye,dI as Me,d5 as Ne,c_ as Ce,d8 as Se,dJ as Oe,bw as X,bf as Te,bv as Be,bx as Ge,by as Fe,bz as De,bA as Pe,bi as Le,bc as we,v as Z,bu as Ie,bn as re,B as ce,C as Re,y as ee,o as ke,i as se,bg as R,dK as z,T as ne,I as oe,dL as A,a_ as le}from"./index-Dnu3KgnM.js";import{e as Ee,f as $e,g as ze,h as Ae}from"./useFetchLookUpData-DfTGI3v0.js";import{i as de,S as h}from"./react-select-animated.esm-BG-Q0fZg.js";import{u as H,w as He}from"./xlsx-uoQkVabA.js";import{s as c,a as b,o as U}from"./reactSelect-BGq5yAQc.js";import{d as Ue}from"./table-options-1zcSwn2c.js";import{M as qe}from"./Modal-Bz7Yp7fg.js";import{A as Ve}from"./Add-jXAG2HSa.js";import{D as Ke}from"./DeleteOutline-CWj868vV.js";import"./sharedApi-Dnus55hW.js";import"./requestApi-kmiWYlDj.js";import"./personnelApi-Tc9Oe2gQ.js";import"./fractionApi-D_-sPGyw.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";const Qe=te(e.jsx("path",{d:"M13 5v6h1.17L12 13.17 9.83 11H11V5zm2-2H9v6H5l7 7 7-7h-4zm4 15H5v2h14z"}),"GetAppOutlined"),Ye=te(e.jsx("path",{d:"M10 8.64 15.27 12 10 15.36zM8 5v14l11-7z"}),"PlayArrowOutlined"),ue=t.createContext(null);function Je(){const[o,a]=t.useState(null);return t.useEffect(()=>{a(`mui-p-${Math.round(Math.random()*1e5)}`)},[]),o}function We(o){const{children:a,value:r}=o,d=Je(),s=t.useMemo(()=>({idPrefix:d,value:r}),[d,r]);return e.jsx(ue.Provider,{value:s,children:a})}function pe(){return t.useContext(ue)}function me(o,a){const{idPrefix:r}=o;return r===null?null:`${o.idPrefix}-P-${a}`}function xe(o,a){const{idPrefix:r}=o;return r===null?null:`${o.idPrefix}-T-${a}`}const Xe=["children"],Ze=t.forwardRef(function(a,r){const{children:d}=a,s=ie(a,Xe),n=pe();if(n===null)throw new TypeError("No TabContext provided");const u=t.Children.map(d,x=>t.isValidElement(x)?t.cloneElement(x,{"aria-controls":me(n,x.props.value),id:xe(n,x.props.value)}):null);return e.jsx(_e,q({},s,{ref:r,value:n.value,children:u}))});function es(o){return Me("MuiTabPanel",o)}ye("MuiTabPanel",["root"]);const ss=["children","className","value"],ns=o=>{const{classes:a}=o;return Oe({root:["root"]},es,a)},os=Ne("div",{name:"MuiTabPanel",slot:"Root",overridesResolver:(o,a)=>a.root})(({theme:o})=>({padding:o.spacing(3)})),ae=t.forwardRef(function(a,r){const d=Ce({props:a,name:"MuiTabPanel"}),{children:s,className:n,value:u}=d,x=ie(d,ss),_=q({},d),F=ns(_),f=pe();if(f===null)throw new TypeError("No TabContext provided");const g=me(f,u),y=xe(f,u);return e.jsx(os,q({"aria-labelledby":y,className:Se(F.root,n),hidden:u!==f.value,id:g,ref:r,role:"tabpanel",ownerState:_},x,{children:u===f.value&&s}))});function ls({tableData:o}){const[a,r]=t.useState({}),d=t.useMemo(()=>!o||o.length===0?[]:Object.keys(o[0]).map(u=>({accessorKey:u,header:u,size:20,Cell:({renderedCellValue:x})=>x===!0?e.jsx("div",{children:"فعال"}):x?e.jsx("div",{children:X(x)}):e.jsx("div",{children:"-"})})),[o]),s=Te({...Ue,columns:d,data:o,defaultColumn:{minSize:5,maxSize:1e3},muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:u=>e.jsx(Be,{...u,page:X(u.page),slots:{previous:Ge,next:Fe,first:De,last:Pe}})},muiTableBodyRowProps:({row:u})=>({onClick:()=>r(()=>({[u.id]:!0})),selected:a[u.id],sx:{cursor:"pointer"}}),getRowId:u=>u.id,onRowSelectionChange:r,state:{rowSelection:a}});return e.jsx(Le,{table:s})}function as({fetureOptions:o,isColsLoading:a,isColsFetching:r,tableName:d,reportName:s}){const[n,u]=t.useState({}),[x,_]=t.useState(!0),[F,f]=t.useState([]),g=de(),{queryCondi:y,selectIDs:k}=we(i=>i.reportGeneratorData),[L,{isLoading:M,isFetching:N}]=Ee(),T=[{value:"Min",label:"MIN"},{value:"Max",label:"MAX"},{value:"Count",label:"COUNT"},{value:"Avg",label:"AVG"}],j=(i,O)=>{const{name:S}=O;if(i){const{value:p}=i;u({...n,[S]:p||""})}else u({...n,[S]:null})},w=async i=>{var O,S;try{const p=await L({...n,txtSelectPart:k,ConditionsCode:y,ForSave:i,ReportName:s}).unwrap(),P=JSON.parse(p.noneobject);f(P),_(!1),console.log(P),ee.success(p.message||((O=p==null?void 0:p.error)==null?void 0:O.data.message),{autoClose:2e3})}catch(p){console.log(p),ee.error(((S=p==null?void 0:p.data)==null?void 0:S.message)||p.error,{autoClose:2e3})}},B=(i,O)=>{const S=H.json_to_sheet(i),p=H.book_new();H.book_append_sheet(p,S,"Sheet1"),He(p,`${O}.xlsx`)},C=()=>{B(F,"گزارش")};return t.useEffect(()=>{console.log(n)},[n]),e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"formContainer",children:e.jsx("form",{method:"POST",className:"flex-col",children:e.jsxs("div",{className:"flex-col",children:[e.jsxs("div",{className:"flex-col",style:{border:"1px solid #ddd",padding:"10px",borderRadius:"5px"},children:[e.jsx("h4",{className:"condition__box--title",children:"دسته بندی:"}),e.jsxs("div",{className:"grid grid--col-4",children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx(h,{closeMenuOnSelect:!0,components:g,options:o,onChange:j,value:o.find(i=>i.value===(n==null?void 0:n.cmbGroupField0)),name:"cmbGroupField0",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"ستون"}),noOptionsMessage:c.noOptionsMessage,loadingMessage:c.loadingMessage,styles:b,isLoading:a||r,isDisabled:!d}),e.jsx("label",{className:n!=null&&n.cmbGroupField0?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"ستون"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(h,{closeMenuOnSelect:!0,components:g,options:T,onChange:j,value:o.find(i=>i.value===(n==null?void 0:n.cmbGroupFunction0)),name:"cmbGroupFunction0",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"تجمیع"}),noOptionsMessage:c.noOptionsMessage,loadingMessage:c.loadingMessage,styles:b,isLoading:a||r,isDisabled:!d||!n.cmbGroupField0}),e.jsx("label",{className:n!=null&&n.cmbGroupFunction0?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"تجمیع"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(h,{closeMenuOnSelect:!0,components:g,options:o,onChange:j,value:o.find(i=>i.value===(n==null?void 0:n.cmbGroupField1)),name:"cmbGroupField1",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"ستون"}),noOptionsMessage:c.noOptionsMessage,loadingMessage:c.loadingMessage,styles:b,isLoading:a||r,isDisabled:!d}),e.jsx("label",{className:n!=null&&n.cmbGroupField1?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"ستون"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(h,{closeMenuOnSelect:!0,components:g,options:T,onChange:j,value:o.find(i=>i.value===(n==null?void 0:n.cmbGroupFunction1)),name:"cmbGroupFunction1",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"تجمیع"}),noOptionsMessage:c.noOptionsMessage,loadingMessage:c.loadingMessage,styles:b,isLoading:a||r,isDisabled:!d||!n.cmbGroupField1}),e.jsx("label",{className:n!=null&&n.cmbGroupFunction1?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"تجمیع"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(h,{closeMenuOnSelect:!0,components:g,options:o,onChange:j,value:o.find(i=>i.value===(n==null?void 0:n.cmbGroupField2)),name:"cmbGroupField2",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"ستون"}),noOptionsMessage:c.noOptionsMessage,loadingMessage:c.loadingMessage,styles:b,isLoading:a||r,isDisabled:!d}),e.jsx("label",{className:n!=null&&n.cmbGroupField2?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"ستون"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(h,{closeMenuOnSelect:!0,components:g,options:T,onChange:j,value:o.find(i=>i.value===(n==null?void 0:n.cmbGroupFunction2)),name:"cmbGroupFunction2",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"تجمیع"}),noOptionsMessage:c.noOptionsMessage,loadingMessage:c.loadingMessage,styles:b,isLoading:a||r,isDisabled:!d||!n.cmbGroupField2}),e.jsx("label",{className:n!=null&&n.cmbGroupFunction2?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"تجمیع"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(h,{closeMenuOnSelect:!0,components:g,options:o,onChange:j,value:o.find(i=>i.value===(n==null?void 0:n.cmbGroupField3)),name:"cmbGroupField3",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"ستون"}),noOptionsMessage:c.noOptionsMessage,loadingMessage:c.loadingMessage,styles:b,isLoading:a||r,isDisabled:!d}),e.jsx("label",{className:n!=null&&n.cmbGroupField3?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"ستون"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(h,{closeMenuOnSelect:!0,components:g,options:T,onChange:j,value:o.find(i=>i.value===(n==null?void 0:n.cmbGroupFunction3)),name:"cmbGroupFunction3",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"تجمیع"}),noOptionsMessage:c.noOptionsMessage,loadingMessage:c.loadingMessage,styles:b,isLoading:a||r,isDisabled:!d||!n.cmbGroupField3}),e.jsx("label",{className:n!=null&&n.cmbGroupFunction3?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"تجمیع"})]})]})]}),e.jsxs("div",{style:{marginRight:"auto"},className:"flex-row",children:[e.jsx(Z,{dir:"ltr",variant:"contained",endIcon:e.jsx(Ie,{}),onClick:()=>w(!0),loading:M||N,color:"success",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:"ذخیره"})}),e.jsx(Z,{dir:"ltr",variant:"contained",endIcon:e.jsx(Ye,{}),onClick:()=>w(!1),loading:M||N,color:"primary",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:"اجرای گزارش"})}),e.jsx(re,{dir:"ltr",endIcon:e.jsx(Qe,{}),variant:"contained",disabled:x,onClick:C,color:"warning",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:"خروجی اکسل"})})]})]})})}),e.jsx(ls,{tableData:F}),M||N?e.jsxs(qe,{title:"در حال ایجاد گزارش",children:[e.jsx("p",{className:"paragraph-primary",style:{textAlign:"center"},children:"لطفا منتظر بمانید..."}),e.jsx(ce,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(Re,{color:"primary"})})]}):null]})}function ts(){const[o,a]=t.useState(!1),[r,d]=t.useState(!0),[s,n]=t.useState({operator:"%3D"}),[u,x]=t.useState(""),[_,F]=t.useState([]),[f,g]=t.useState([]),[y,k]=t.useState(!1),[L,{isLoading:M,isFetching:N}]=$e(),[T,{isLoading:j,isFetching:w}]=ze(),B=de(),C=ke(),{queryCondi:E}=se(l=>l.reportGeneratorData),{role:i}=se(l=>l.role),{reportGeneratorTables:O,reportGeneratorTablesIsLoading:S,reportGeneratorTablesIsFetching:p}=Ae(i==null?void 0:i.value),P=U(O,"tableName","tableNameFarsi"),D=U(_,"id","columnTitle"),$=[{value:"%3D",label:"="},{value:"%3E",label:">"},{value:"%3C",label:"<"},{value:"%3E%3D",label:">="},{value:"%3C%3D",label:"<="},{value:"LIKE",label:"LIKE"}],he=U(f,"value","text"),V=t.useCallback(async l=>{try{const m=await L(l).unwrap();F(m.itemList)}catch(m){console.log(m)}},[L]);t.useEffect(()=>{s.TableName&&V(s.TableName)},[s.TableName,V]);const K=t.useCallback(async l=>{try{const m=await T(l).unwrap();g(m.itemList)}catch(m){console.log(m)}},[T]);t.useEffect(()=>{y&&K(s.columnid)},[s,K,y]),t.useEffect(()=>{if(s.columnid){const l=R(_,s.columnid);l&&k(l.isLookup!==0)}},[s,_]);const be=(l,m,v)=>{let G;const J=R(_,l).columnTitle,W=R($,m,"value").label;if(y){const ve=R(f,v,"value").text;G=`${J} ${W} ${ve}`}else C(A(E+`%23${l}%23${m}%23${v}`)),G=`${J} ${W} ${v}`;x(u+" "+G),a(!0),d(!1)},Q=l=>{const{name:m,value:v}=l.target;n({...s,[m]:v})},I=(l,m)=>{const{name:v}=m;if(l){const{value:G}=l;n({...s,[v]:G||""})}else n({...s,[v]:null})},ge=(l,m)=>{const v=m.name,G=l?l.map(Y=>Y.value):[];n({...s,[v]:G})};t.useEffect(()=>{s.tableSelects&&s.tableSelects.length===1?C(z(s.tableSelects[0]+"%24")):s.tableSelects&&s.tableSelects.length===0?C(z("")):s.tableSelects&&s.tableSelects.length>1&&C(z(s.tableSelects.join("%24")+"%24"))},[s.tableSelects,C]);const fe=()=>{C(A("")),x(""),a(!1),d(!0),n({...s,condition:""})},je=l=>{x(m=>`${m} ${l}`),C(A(E+`%24${l}%24`)),a(!1),d(!0)};return e.jsxs("section",{className:"formContainer flex-col",children:[e.jsxs("form",{method:"POST",className:"flex-col",children:[e.jsxs("div",{className:"grid grid--col-4",style:{border:"1px solid #ddd",padding:"10px",borderRadius:"5px"},children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",id:"reportName",name:"reportName",onChange:Q,value:s.reportName||"",className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"reportName",className:"inputBox__form--label",children:"نام گزارش"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(h,{closeMenuOnSelect:!0,components:B,options:P,onChange:I,value:P.find(l=>l.value===(s==null?void 0:s.TableName)),name:"TableName",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"جدول"}),noOptionsMessage:c.noOptionsMessage,loadingMessage:c.loadingMessage,styles:b,isLoading:S||p}),e.jsx("label",{className:s!=null&&s.TableName?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"جدول"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(h,{closeMenuOnSelect:!0,components:B,options:D,onChange:ge,value:D.find(l=>l.value===(s==null?void 0:s.tableSelects)),name:"tableSelects",isMulti:!0,isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"انتخاب ستون های خروجی"}),noOptionsMessage:c.noOptionsMessage,loadingMessage:c.loadingMessage,styles:b,isLoading:M||N,isDisabled:M||N||!s.TableName}),e.jsx("label",{className:s!=null&&s.tableSelects&&(s==null?void 0:s.tableSelects.length)>0?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"انتخاب ستون های خروجی"})]})]}),e.jsxs("div",{className:"flex-col",style:{border:"1px solid #ddd",padding:"10px",borderRadius:"5px"},children:[e.jsxs("div",{className:"grid grid--col-4-mid-sm-last-sm",children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx(h,{closeMenuOnSelect:!0,components:B,options:D,onChange:I,value:D.find(l=>l.value===(s==null?void 0:s.columnid)),name:"columnid",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"خصوصیت شرط پذیر"}),noOptionsMessage:c.noOptionsMessage,loadingMessage:c.loadingMessage,styles:b,isLoading:M||N,isDisabled:M||N||!s.TableName}),e.jsx("label",{className:s!=null&&s.columnid?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"خصوصیت شرط پذیر"})]}),e.jsx(h,{closeMenuOnSelect:!0,components:B,options:$,onChange:I,value:$.find(l=>l.value===(s==null?void 0:s.operator)),name:"operator",isClearable:!1,noOptionsMessage:c.noOptionsMessage,loadingMessage:c.loadingMessage,styles:b}),s.columnid&&!y&&e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",value:s.condition,id:"condition",name:"condition",onChange:Q,required:!0}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"condition",children:"شرط"})]}),s.columnid&&y&&e.jsxs("div",{className:"inputBox__form",children:[e.jsx(h,{closeMenuOnSelect:!0,components:B,options:he,onChange:I,value:D.find(l=>l.value===(s==null?void 0:s.condition)),name:"condition",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"شرط"}),noOptionsMessage:c.noOptionsMessage,loadingMessage:c.loadingMessage,styles:b,isLoading:w||j}),e.jsx("label",{className:s!=null&&s.condition?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"شرط"})]}),e.jsxs("div",{children:[e.jsx(ne,{title:"افزودن شرط",children:e.jsx("span",{children:e.jsx(oe,{color:"success",onClick:()=>be(s.columnid,s.operator,s.condition),disabled:!s.TableName||!s.operator||!s.columnid||!s.condition||o,children:e.jsx(Ve,{})})})}),e.jsx(ne,{title:"پاک کردن تمامی شروط",children:e.jsx("span",{children:e.jsx(oe,{color:"error",onClick:fe,children:e.jsx(Ke,{})})})})]})]}),e.jsxs("div",{className:"grid grid--col-2-first-sm",children:[e.jsx("div",{className:"grid grid--col-2",children:["or","and","(",")","null","%"].map(l=>e.jsx(re,{dir:"ltr",variant:"contained",color:"info",disabled:r,onClick:()=>je(l),children:e.jsx("span",{children:l.toUpperCase()})},l))}),e.jsxs("div",{className:"condition__box row-span-3",children:[e.jsx("h4",{className:"condition__box--title",children:"شروط انتخاب شده:"}),e.jsx("p",{children:u})]})]})]})]}),e.jsx(as,{fetureOptions:D,isColsLoading:M,isColsFetching:N,tableName:s.TableName,reportName:s.reportName})]})}function Ns(){const[o,a]=t.useState("1"),r=(s,n)=>{a(n)};return e.jsxs("section",{className:"flex-col",children:[e.jsx("div",{className:"title-primary--container flex-row flex-center",children:e.jsx("h4",{className:"title-primary",children:e.jsx("span",{className:"title-primary--underline",children:"گزارش ساز"})})}),e.jsx("div",{children:e.jsxs(We,{value:o,children:[e.jsx(ce,{sx:{bgcolor:"background.paper",borderRadius:1},children:e.jsxs(Ze,{onChange:r,"aria-label":"tabs",children:[e.jsx(le,{label:"گزارش جدید",value:"1"}),e.jsx(le,{label:"گزارش های ثبت شده",value:"2"})]})}),e.jsx(ae,{value:"1",sx:{padding:"0"},children:e.jsx(ts,{})}),e.jsx(ae,{value:"2",sx:{padding:"0"}})]})})]})}export{Ns as default};
