import{r as o,j as e,i as A,l as C,o as R,T as N,a as M,I as w,D as _,p as T,h as k,B as F,C as z}from"./index-W68cpnsO.js";import{a as L,b as O,u as E}from"./announceApi-c7Vel8mB.js";import{u as Y,m as G,C as K,d as q,a as Q}from"./datePicker-CC0F8vd7.js";import{S as W}from"./index-DRM-yeOy.js";import{u as H,M as J,P as U,C as V,a as X,L as Z,F as $}from"./index.esm-Ck86Uiz9.js";import{M as ee}from"./Modal-CfynDF2i.js";import{d as ne}from"./table-options-K8gSTB4P.js";import{D as se}from"./DeleteOutline-DPb9FXgd.js";import{R as ae}from"./Refresh-CAokqmpA.js";function te({setIsRefresh:c}){const l=o.useRef(null),[r,x]=o.useState({}),[d,p]=o.useState(null),[i,u]=o.useState(!1),[D,{isLoading:S,isFetching:f}]=L(),h=t=>{const{name:s,value:m}=t.target;x({...r,[s]:m})},j=t=>{p(t),u(!1)},y=t=>{u(t)},I=async()=>{var t;try{let s;d?(s=new Date(d),s.setMinutes(s.getMinutes()-s.getTimezoneOffset())):s=null;const m=await D({runDate:s,title:r.title,isDeleted:!1,description:r.description}).unwrap();C.success(m.message,{autoClose:2e3}),c(v=>!v),p(null),x({title:"",description:""})}catch(s){console.log(s),C.error(((t=s==null?void 0:s.data)==null?void 0:t.message)||s.error,{autoClose:2e3})}};return Y([l],[u]),e.jsxs("section",{className:"flex-col formContainer",children:[e.jsxs("form",{method:"POST",className:"grid grid--col-2",children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",name:"title",value:r.title||"",id:"title",onChange:h,className:"inputBox__form--input",required:!0}),e.jsxs("label",{htmlFor:"title",className:"inputBox__form--label",children:[e.jsx("span",{children:"*"})," عنوان اطلاعیه"]})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(G.InputDatePicker,{value:d,onChange:j,format:"jYYYY/jMM/jDD",onOpenChange:y,suffixIcon:e.jsx(K,{color:"action"}),open:i,style:q,wrapperStyle:Q,pickerProps:{ref:l}}),e.jsxs("div",{className:"inputBox__form--readOnly-label",children:[e.jsx("span",{children:"*"})," تاریخ ارسال"]})]}),e.jsxs("div",{className:"inputBox__form col-span-2 row-span-3",children:[e.jsx("textarea",{type:"text",id:"description",name:"description",value:r.description||"",onChange:h,className:"inputBox__form--input",maxLength:500,required:!0}),e.jsxs("label",{htmlFor:"description",className:"inputBox__form--label",children:[e.jsx("span",{children:"*"})," متن اطلاعیه"]})]})]}),e.jsx("div",{style:{marginRight:"auto"},children:e.jsx(A,{dir:"ltr",endIcon:e.jsx(W,{}),onClick:I,loading:S||f,variant:"contained",color:"success",children:e.jsx("span",{children:"ذخیره"})})})]})}function oe({isRefresh:c}){const[l,r]=o.useState({}),[x,d]=o.useState(null),[p,i]=o.useState(!1),[u,D]=o.useState([]),[S,{isLoading:f}]=O(),{data:h,isSuccess:j,isLoading:y,isFetching:I,error:g,refetch:t}=E();o.useEffect(()=>{if(t(),j){const n=h.itemList.map((a,B)=>({id:a.announceID,announceRowNum:B+1,announceTitle:a.title,announceDesc:a.description,announceRunDate:a.runDate}));D(n)}},[j,t,h,c]),o.useEffect(()=>{g&&console.log(g)},[g]);const s=()=>{t()},m=()=>{i(!0)},v=async()=>{var n;try{const a=await S({announceID:x,isDeleted:!0}).unwrap();C.success(a.message,{autoClose:2e3}),i(!1),t()}catch(a){console.log(a),C.error(((n=a==null?void 0:a.data)==null?void 0:n.message)||a.error,{autoClose:2e3})}},P=o.useMemo(()=>[{accessorKey:"announceRowNum",header:"ردیف",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({renderedCellValue:n})=>e.jsx("span",{children:R(n)})},{accessorKey:"announceTitle",header:"عنوان اطلاعیه",size:20},{accessorKey:"announceDesc",header:"متن اطلاعیه",size:20,Cell:({renderedCellValue:n,row:a})=>e.jsx(N,{title:e.jsx("p",{style:{fontFamily:"IranYekan"},children:a.original.announceDesc}),children:e.jsx("p",{style:{width:"80ch",textOverflow:"ellipsis",overflow:"hidden"},children:n})}),muiTableBodyCellProps:{align:"right"}},{accessorKey:"announceRunDate",header:"تاریخ اجرا",size:20,Cell:({renderedCellValue:n})=>e.jsx("div",{children:M(n)})},{accessorKey:"deleteAnnounce",header:"حذف",enableSorting:!1,enableColumnActions:!1,size:20,Cell:()=>e.jsx(w,{color:"error",onClick:m,sx:{padding:"0"},children:e.jsx(se,{})})}],[]),b=H({...ne,columns:P,data:u,defaultColumn:{minSize:5,maxSize:1e3},renderTopToolbarCustomActions:()=>e.jsx(F,{children:y||I?e.jsx(w,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(z,{size:20,value:100})}):e.jsx(N,{title:"بروز رسانی",children:e.jsx("span",{children:e.jsx(w,{"aria-label":"refresh",color:"info",onClick:s,children:e.jsx(ae,{fontSize:"small"})})})})}),muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:n=>e.jsx(U,{...n,page:R(n.page),slots:{previous:V,next:X,first:Z,last:$}})},muiTableBodyRowProps:({row:n})=>({onClick:()=>r(()=>({[n.id]:!0})),selected:l[n.id],sx:{cursor:"pointer"}}),getRowId:n=>n.id,onRowSelectionChange:r,state:{rowSelection:l}});return o.useEffect(()=>{const n=Object.keys(b.getState().rowSelection)[0];n&&d(n)},[b,l]),e.jsxs(e.Fragment,{children:[p&&e.jsxs(ee,{title:"حذف اطلاعیه",closeModal:()=>i(!1),children:[e.jsx("p",{className:"paragraph-primary",children:"آیا از حذف این اطلاعیه اطمینان دارید؟"}),e.jsxs("div",{className:"flex-row flex-center",children:[e.jsx(A,{dir:"ltr",endIcon:e.jsx(_,{}),onClick:v,loading:f,variant:"contained",color:"success",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:"بله"})}),e.jsx(T,{dir:"ltr",endIcon:e.jsx(k,{}),onClick:()=>i(!1),disabled:f,variant:"contained",color:"error",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:"خیر"})})]})]}),e.jsx(J,{table:b}),";"]})}function fe(){const[c,l]=o.useState(!1);return e.jsxs("section",{className:"flex-col u-margin-bottom-xl",children:[e.jsx("div",{className:"title-primary--container flex-row flex-center",children:e.jsxs("h4",{className:"title-primary",children:[e.jsx("span",{className:"title-primary--underline"}),"ثبت اطلاعیه"]})}),e.jsx(te,{setIsRefresh:l}),e.jsx("div",{className:"flex-col flex-center",children:e.jsx("h5",{className:"title-secondary",children:"مدیریت اطلاعیه ها"})}),e.jsx(oe,{isRefresh:c})]})}export{fe as default};
