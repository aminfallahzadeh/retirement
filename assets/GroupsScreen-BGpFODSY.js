import{r as a,G as X,j as e,B as Q,C as M,k as P,m as b,J as w,f as T,K as Y,M as Z,y as B,N as K,O as $,P as ee,Q as O,S as se,p as E,U as te,V as ae,W as oe,X as ie,Y as ne,Z as re,T as D,I as y,D as le,i as ce,a as de,L as me}from"./index-BSRVVr8n.js";import{u as G,b as L,P as ue,C as fe,a as he,L as pe,F as xe}from"./index.esm-BxY0lyNJ.js";import{d as z}from"./table-options-DlAa6-Lw.js";import{M as k}from"./Modal-CHpckkD-.js";import{S as H}from"./Save-BGOXVp9e.js";import{S as F}from"./index-Czcrc2XJ.js";/* empty css                 */import{D as ge,a as je,C as Ie}from"./KeyboardDoubleArrowRight-COpwcjK0.js";import{E as Se}from"./EditOutlined-CJT40D9a.js";import{D as be}from"./DeleteOutline-DTlBR821.js";import{R as Ce}from"./Refresh-DHTXiARq.js";import{A as Ne}from"./Add-BfxQkocC.js";import"./index-BywiX4DN.js";function ye({setShowEditModal:o,selectedGroup:n}){const[l,I]=a.useState(!0),[r,d]=a.useState(""),[h,{isLoading:p}]=X(),u=c=>{d(c.target.value)};a.useEffect(()=>{n&&d(n.groupName)},[n]);const x=async()=>{var c;try{const t=await h({id:n.id,groupName:r}).unwrap();o(!1),b.success(t.message,{autoClose:2e3})}catch(t){b.error(((c=t==null?void 0:t.data)==null?void 0:c.message)||t.error,{autoClose:2e3})}};return a.useEffect(()=>{n&&d(n.groupName)},[n]),a.useEffect(()=>{const c=setTimeout(()=>{I(!1)},300);return()=>clearTimeout(c)},[]),e.jsx(e.Fragment,{children:l?e.jsx(Q,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(M,{color:"primary"})}):e.jsxs("section",{className:"formContainer flex-col",children:[e.jsxs("form",{method:"POST",className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input inputBox__form--input-height-40",required:!0,id:"groupName",value:r,onChange:u}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"groupName",children:"نام گروه"})]}),e.jsx("div",{style:{marginRight:"auto"},children:e.jsx(P,{dir:"ltr",endIcon:e.jsx(H,{}),loading:p,onClick:x,variant:"contained",color:"success",disabled:r===(n==null?void 0:n.name)||!r,children:e.jsx("span",{children:"ذخیره"})})})]})})}function we(){const{itemsTableData:o}=w(t=>t.itemsData),{groupItemsTableData:n}=w(t=>t.groupItemsData),[l,I]=a.useState({}),r=T(),{data:d,isLoading:h,isSuccess:p,error:u,refetch:x}=Y();a.useEffect(()=>{var t;if(x(),p){const m=d.itemList.map(s=>({id:s.id,itemName:s.itemName})).filter(s=>!n.map(j=>j.id).includes(s.id));r(Z(m))}else u&&b.error(((t=u==null?void 0:u.data)==null?void 0:t.message)||u.error,{autoClose:2e3,style:{fontSize:"18px"}})},[d,p,r,x,n,u]);const f=a.useMemo(()=>[{accessorKey:"itemName",header:"دسترسی ها",size:300}],[]),c=G({...z,columns:f,data:o,positionGlobalFilter:"left",initialState:{density:"compact",showGlobalFilter:!0},muiTableBodyRowProps:({row:t})=>({onClick:()=>I(()=>({[t.id]:!0})),selected:l[t.id],sx:{cursor:"pointer"}}),enablePagination:!1,muiTableContainerProps:{sx:{height:"300px"}},enableBottomToolbar:!1,getRowId:t=>t.id,onRowSelectionChange:I,state:{rowSelection:l}});return a.useEffect(()=>{const t=Object.keys(c.getState().rowSelection)[0],S=B(o,t);r(t&&S?K(S):K(null))},[r,c,l,o]),e.jsx(e.Fragment,{children:h?e.jsx("div",{className:"skeleton-md",children:e.jsx(F,{count:7,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl",width:280})}):e.jsx(L,{table:c})})}function De({selectedGroup:o}){const[n,l]=a.useState({}),[I,r]=a.useState(null),d=T(),{groupItemsTableData:h}=w(s=>s.groupItemsData);a.useEffect(()=>{o&&r(o.id)},[o]);const{data:p,isSuccess:u,isLoading:x,error:f,refetch:c}=$(I);a.useEffect(()=>{var s;if(c(),u){const j=p.itemList.map(C=>({id:C.itemID,itemName:C.itemName}));d(ee(j))}else f&&b.error(((s=f==null?void 0:f.data)==null?void 0:s.message)||f.error,{autoClose:2e3,style:{fontSize:"18px"}})},[p,u,d,c,f]);const t=a.useMemo(()=>[{accessorKey:"itemName",size:300,header:e.jsxs("span",{children:["دسترسی های گروه:"," ",e.jsx("span",{style:{fontStyle:"italic",color:"#03620a"},children:o==null?void 0:o.groupName})]})}],[o==null?void 0:o.groupName]),S=G({...z,columns:t,data:h,positionGlobalFilter:"left",enablePagination:!1,muiTableContainerProps:{sx:{height:"300px"}},enableBottomToolbar:!1,initialState:{density:"compact",showGlobalFilter:!0},muiTableBodyRowProps:({row:s})=>({onClick:()=>l(()=>({[s.id]:!0})),selected:n[s.id],sx:{cursor:"pointer"}}),getRowId:s=>s.id,onRowSelectionChange:l,state:{rowSelection:n}});return a.useEffect(()=>{const s=Object.keys(S.getState().rowSelection)[0],j=B(h,s);d(s&&j?O(j):O(null))},[d,S,n,h]),e.jsx(e.Fragment,{children:x?e.jsx("div",{className:"skeleton-md",children:e.jsx(F,{count:7,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl",width:280})}):e.jsx(L,{table:S})})}function ve({selectedGroup:o,setShowEditItemsModal:n}){const[l,I]=a.useState(null),r=T(),{selectedItemData:d}=w(m=>m.itemsData),{selectedGroupItemData:h}=w(m=>m.groupItemsData);a.useEffect(()=>{o&&I(o.id)},[o]);const{groupItemsTableData:p}=w(m=>m.groupItemsData),[u,{isLoading:x}]=se(),f=async()=>{var m;try{const s=p.map(C=>({id:"",itemID:C.id,itemName:"",groupID:l})),j=await u(s).unwrap();console.log(j),b.success(j.message,{autoClose:2e3}),n(!1)}catch(s){console.log(s),b.error(((m=s==null?void 0:s.data)==null?void 0:m.message)||s.error,{autoClose:2e3})}},c=m=>{r(te(d)),r(ae(m))},t=m=>{r(oe(h)),r(ie(m))};return e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",rowGap:"10px"},children:[e.jsx(E,{onClick:()=>c(d.id),variant:"contained",color:"primary",children:e.jsx(ge,{})}),e.jsx(E,{onClick:()=>t(h.id),variant:"contained",color:"primary",children:e.jsx(je,{})}),e.jsx(P,{dir:"ltr",endIcon:e.jsx(H,{}),loading:x,onClick:f,variant:"contained",color:"success",children:e.jsx("span",{children:"ذخیره"})})]})}function Te(){const[o,n]=a.useState([]),[l,I]=a.useState(null),[r,d]=a.useState({}),[h,p]=a.useState(!1),[u,x]=a.useState(!1),[f,c]=a.useState(!1),[t,{isLoading:S}]=ne(),m=T(),{data:s,isLoading:j,isFetching:C,isSuccess:_,error:N,refetch:v}=re(),U=()=>{p(!0)},q=()=>{c(!0)},J=()=>{x(!0)},A=()=>{v()},V=async()=>{var i;try{const g=await t({id:l==null?void 0:l.id,groupName:l==null?void 0:l.groupName,isdeleted:!0}).unwrap();c(!1),v(),b.success(g.message,{autoClose:2e3,style:{fontSize:"18px"}})}catch(g){b.error(((i=g==null?void 0:g.data)==null?void 0:i.message)||g.error,{autoClose:2e3,style:{fontSize:"18px"}})}};a.useEffect(()=>{if(v(),_){const i=s.itemList.map(g=>({id:g.id,groupName:g.groupName}));n(i)}},[s,_,m,v,f,h,u]),a.useEffect(()=>{var i;N&&(console.log(N),b.error(((i=N==null?void 0:N.data)==null?void 0:i.message)||N.error,{autoClose:2e3}))},[N]);const W=a.useMemo(()=>[{accessorKey:"groupName",header:"نام گروه",size:20},{accessorKey:"editGroupNameAction",header:"ویرایش گروه",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:i})=>e.jsx(D,{title:i.original.groupName,children:e.jsx(y,{color:"success",onClick:U,sx:{padding:"0"},children:e.jsx(Se,{})})})},{accessorKey:"editItemsAction",header:"ویرایش دسترسی ها",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:i})=>e.jsx(D,{title:i.original.groupName,children:e.jsx(y,{color:"primary",onClick:J,sx:{padding:"0"},children:e.jsx(Ie,{})})})},{accessorKey:"deleteGroupAction",header:"حذف گروه",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:i})=>e.jsx(D,{title:i.original.groupName,children:e.jsx(y,{color:"error",onClick:q,sx:{padding:"0"},children:e.jsx(be,{})})})}],[]),R=G({...z,columns:W,data:o,muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:i=>e.jsx(ue,{...i,page:de(i.page),slots:{previous:fe,next:he,first:pe,last:xe}})},muiTableBodyRowProps:({row:i})=>({onClick:()=>d(()=>({[i.id]:!0})),selected:r[i.id],sx:{cursor:"pointer"}}),renderTopToolbarCustomActions:()=>e.jsxs(Q,{children:[C?e.jsx(y,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(M,{size:20,value:100})}):e.jsx(D,{title:"بروز رسانی",children:e.jsx("span",{children:e.jsx(y,{"aria-label":"refresh",color:"info",onClick:A,children:e.jsx(Ce,{fontSize:"small"})})})}),e.jsx(me,{to:"/retirement/create-group",children:C?e.jsx(y,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(M,{size:20,value:100,color:"success"})}):e.jsx(D,{title:"ایجاد گروه",children:e.jsx("span",{children:e.jsx(y,{"aria-label":"refresh",color:"success",onClick:A,children:e.jsx(Ne,{fontSize:"small"})})})})})]}),getRowId:i=>i.id,onRowSelectionChange:d,state:{rowSelection:r}});return a.useEffect(()=>{const i=Object.keys(R.getState().rowSelection)[0],g=B(o,i);g&&I(g)},[R,o,r]),e.jsx(e.Fragment,{children:j?e.jsx("div",{className:"skeleton-lg",children:e.jsx(F,{count:5,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl"})}):e.jsxs(e.Fragment,{children:[h?e.jsx(k,{title:"ویرایش نام گروه",closeModal:()=>p(!1),children:e.jsx(ye,{setShowEditModal:p,selectedGroup:l})}):f?e.jsxs(k,{title:"حذف گروه",closeModal:()=>c(!1),children:[e.jsx("p",{className:"paragraph-primary",children:"آیا از حذف این گروه اطمینان دارید؟"}),e.jsxs("div",{className:"flex-row flex-center",children:[e.jsx(P,{dir:"ltr",endIcon:e.jsx(le,{}),loading:S,onClick:V,variant:"contained",color:"success",children:e.jsx("span",{children:"بله"})}),e.jsx(E,{dir:"ltr",endIcon:e.jsx(ce,{}),onClick:()=>c(!1),variant:"contained",color:"error",children:e.jsx("span",{children:"خیر"})})]})]}):u?e.jsx(k,{title:"ویرایش دسترسی ها",closeModal:()=>x(!1),children:e.jsxs("div",{className:"formContainer flex-row",children:[e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"دسترسی ها"})}),e.jsx(we,{})]}),e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"عملیات"})}),e.jsx("div",{style:{marginTop:"6rem"},children:e.jsx(ve,{selectedGroup:l,setShowEditItemsModal:x})})]}),e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"دسترسی های گروه"})}),e.jsx(De,{selectedGroup:l})]})]})}):null,e.jsx(L,{table:R})]})})}function Qe(){return e.jsxs("section",{className:"flex-col",children:[e.jsx("div",{className:"title-primary--container flex-row flex-center",children:e.jsxs("h4",{className:"title-primary",children:[e.jsx("span",{className:"title-primary--underline"}),"مدیریت گروه ها"]})}),e.jsx(Te,{})]})}export{Qe as default};
