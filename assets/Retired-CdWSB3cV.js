import{z as X,r as t,j as e,A as me,u as Ae,h as Ie,D as Re,F as Le,H as ge,B as ie,C as xe,J as n,K as Ue,M as T,N as Oe,P as ke,Q as Pe,S as _e,U as S,V as Fe,W as J,X as qe,Y as oe,Z as ve,_ as Be,$ as Me,a0 as Ge,a1 as $e,a2 as we,a3 as He,a4 as Ve,a5 as ze,a6 as Ke,a7 as Qe,a8 as Ye,a9 as Je,aa as We,ab as Ze,ac as Xe,ad as es,ae as ss,af as as,ag as ts,ah as ns,ai as rs,aj as os,ak as is,al as ls,am as cs,an as ds,ao as us,ap as ps,aq as ms,ar as Is,as as xs,t as W,at as be,au as De,av as fe,aw as he,i as Te,ax as bs,ay as Ds,az as fs,aA as ye,aB as hs,aC as Ss,aD as js,aE as gs,aF as ys,aG as Es,aH as Ts,aI as Ns,aJ as Cs,aK as As,aL as q,aM as Rs,aN as Ls,aO as Us,aP as Os,aQ as ks,aR as Ps,aS as _s,aT as Fs,aU as g,aV as de,aW as ue,aX as pe,aY as qs,aZ as ee,a_ as vs,a$ as Bs,L as se,b0 as Ms,b1 as Gs,b2 as $s,b3 as ws,b4 as Hs,b5 as Vs,b6 as zs,b7 as Ks,b8 as Qs}from"./index-CRad3sE9.js";import{u as Ys,a as Js,c as Ws,F as Zs}from"./createTree-BA_AO_pv.js";import{T as Xs}from"./Title-CaQy3AJ8.js";import{c as y,S as E}from"./SelectInput-CClIbL5j.js";import{C as Y}from"./CustomCheckBox-B3NmHu1N.js";import{T as Ee}from"./TextArea-DifUInWp.js";import{E as Se}from"./EditOutlined-D0lpqwVZ.js";import{u as k,a as ea,b as sa}from"./useFetchLookUpData-afJ3SXZk.js";import{p as Ne,a as je}from"./convertFormData-gHt-HwdT.js";import{S as aa}from"./StatusHistoryGrid-DxOkT3Zi.js";import{u as ta}from"./sharedApi-Bj4lfPKc.js";import{u as na}from"./useRouteMatch-B8wsF8FH.js";import{A as ae,a as te,b as ne,c as re}from"./ArrowDropDown-CbX6MhhB.js";import"./index-BuqOBxN2.js";import"./react-select-animated.esm-DA9BtmsI.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./requestApi-P45rVSbr.js";import"./personnelApi-CAou1wF1.js";import"./fractionApi-D6icoZPU.js";const ra=()=>{const[s]=X(),[f,c]=t.useState([]),[h,U]=t.useState([]),m=s.get("personID"),{data:N,isLoading:a,isSuccess:I,refetch:u}=Ys(),{data:D,isLoading:r,isSuccess:x,refetch:d}=Js(m);t.useEffect(()=>{x&&U(D.itemList)},[x,D]),t.useEffect(()=>{if(I){const v=Ws(N.itemList);c(v)}},[I,N]);const j=t.useCallback(()=>{u(),d()},[u,d]);return e.jsx(Zs,{structure:f,files:h,isLoading:a||r,refetch:j,access:"files"})},oa=["personFirstName","personLastName","personNationalCode","personCertificateNo","personFatherName","genderID","personBirthDate","personBirthPlace","personPreviousNam","personIsSacrificedFamily","personIsWarrior","personIsChildOfSacrificed","personIsValiant","personIsSacrificed","personIsCaptive","retiredID","personPhone","personCellPhone","backupPhone","backupFirstName","backupLastName","personEmail","educationTypeID","personCountryID","personStateID","personCityID","personRegion","personArea","personPostalCode","housingTypeID","maritalStatusID","personDeathDate","personAddress","personDescription"],ia=["retiredGroup","retiredOrganizationID","retiredLastPosition","employmentTypeID","retirementDate","pensionaryStatusID","pensionaryStartdate","retiredJobDegreeCoef","retiredGrantDuration","retiredRealDuration"],la=["bankID","bankBranchID","accountNo","ledgerCode","insuranceCoef","insuranceAmount"],ca=()=>{const[s,f]=me(!1),[c]=X(),h=Ae(),U=c.get("personID"),m=t.useMemo(()=>["genderID","personCountryID","personStateID","personCityID","housingTypeID","educationTypeID","maritalStatusID"],[]),N=t.useMemo(()=>["personDeathDate","personBirthDate"],[]),{control:a,handleSubmit:I,formState:{errors:u},setValue:D}=Ie(),{data:r,isLoading:x,isFetching:d,isSuccess:j,refetch:v}=Re(U),[P,{isLoading:$}]=Le(),{lookUpItems:C,lookUpItemsIsLoading:w}=k({lookUpType:"Gender"}),R=t.useMemo(()=>y(C,"lookUpID","lookUpName"),[C]),{lookUpItems:b,lookUpItemsIsLoading:L}=k({lookUpType:"EducationType"}),B=t.useMemo(()=>y(b,"lookUpID","lookUpName"),[b]),{lookUpItems:H,lookUpItemsIsLoading:V}=k({lookUpType:"Country"}),M=t.useMemo(()=>y(H,"lookUpID","lookUpName"),[H]),{lookUpItems:G,lookUpItemsIsLoading:z}=k({lookUpType:"State"}),_=t.useMemo(()=>y(G,"lookUpID","lookUpName"),[G]),{lookUpItems:Z,lookUpItemsIsLoading:o}=k({lookUpType:"City"}),A=t.useMemo(()=>y(Z,"lookUpID","lookUpName"),[Z]),{lookUpItems:F,lookUpItemsIsLoading:le}=k({lookUpType:"HousingType"}),p=t.useMemo(()=>y(F,"lookUpID","lookUpName"),[F]),{lookUpItems:l,lookUpItemsIsLoading:i}=k({lookUpType:"MaritialStatus"}),ce=t.useMemo(()=>y(l,"lookUpID","lookUpName"),[l]),Ce=async K=>{const Q=je(K,m,N),O=await P(Q).unwrap();v(),f(),he.success(O.message)};return t.useEffect(()=>{if(j){const K=r==null?void 0:r.itemList[0];h(ge((K==null?void 0:K.personDeathDate)!==null));const Q=Ne(K,m,N,{genderID:R,educationTypeID:B,personCountryID:M,personStateID:_,personCityID:A,housingTypeID:p,maritalStatusID:ce});Object.keys(Q).forEach(O=>{oa.includes(O)&&Q[O]===null?D(O,""):D(O,Q[O])})}return()=>{h(ge(null))}},[h,j,r==null?void 0:r.itemList,D,R,M,B,_,A,p,ce,N,m]),e.jsx(e.Fragment,{children:x||d?e.jsx(ie,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(xe,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:I(Ce),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(n,{name:"personFirstName",label:Ue,rules:T,required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personLastName",label:Oe,rules:T,required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personNationalCode",label:ke,rules:{...Pe,...T},required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personCertificateNo",label:_e,rules:{...S,...T},required:!0,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personFatherName",label:Fe,rules:J,required:!0,control:a,editable:s,type:"text"}),e.jsx(E,{name:"genderID",control:a,label:qe,required:!0,isClearable:!0,isDisabled:!s,options:R,isLoading:w,rules:T,errors:u}),e.jsx(oe,{name:"personBirthDate",label:ve,control:a,disabled:!s,required:!0,errors:u,rules:T,setValue:D}),e.jsx(n,{name:"personBirthPlace",label:Be,rules:J,required:!1,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personPreviousName",label:Me,rules:J,required:!1,control:a,editable:s,type:"text"}),e.jsxs("div",{className:s?"checkboxContainer col-span-3":"checkboxContainer--disabled col-span-3",children:[e.jsx("p",{className:"inputBox__form--readOnly-label",children:Ge}),e.jsx(Y,{disabled:!s,control:a,label:$e,name:"personIsSacrificedFamily"}),e.jsx(Y,{disabled:!s,control:a,label:we,name:"personIsWarrior"}),e.jsx(Y,{disabled:!s,control:a,label:He,name:"personIsChildOfSacrificed"}),e.jsx(Y,{disabled:!s,control:a,label:Ve,name:"personIsValiant"}),e.jsx(Y,{disabled:!s,control:a,label:ze,name:"personIsSacrificed"}),e.jsx(Y,{disabled:!s,control:a,label:Ke,name:"personIsCaptive"})]}),e.jsx(n,{name:"retiredID",label:Qe,required:!1,control:a,editable:!1,type:"text"}),e.jsx(n,{name:"personPhone",label:Ye,required:!1,rules:S,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personCellPhone",label:Je,required:!1,rules:We,control:a,editable:s,type:"text"}),e.jsx(n,{name:"backupPhone",label:Ze,required:!1,rules:S,control:a,editable:s,type:"text"}),e.jsx(n,{name:"backupFirstName",label:Xe,required:!1,rules:J,control:a,editable:s,type:"text"}),e.jsx(n,{name:"backupLastName",label:es,required:!1,rules:J,control:a,editable:s,type:"text"}),e.jsx(n,{name:"personEmail",label:ss,required:!1,rules:as,control:a,editable:s,type:"text"}),e.jsx(E,{name:"educationTypeID",control:a,label:ts,required:!1,isClearable:!0,isDisabled:!s,options:B,isLoading:L}),e.jsx(E,{name:"personCountryID",control:a,label:ns,required:!1,isClearable:!0,isDisabled:!s,options:M,isLoading:V}),e.jsx(E,{name:"personStateID",control:a,label:rs,required:!1,isClearable:!0,isDisabled:!s,options:_,isLoading:z}),e.jsx(E,{name:"personCityID",control:a,label:os,required:!1,isClearable:!0,isDisabled:!s,options:A,isLoading:o}),e.jsx(n,{name:"personRegion",label:is,required:!1,control:a,editable:s,rules:S,type:"text"}),e.jsx(n,{name:"personArea",label:ls,required:!1,control:a,editable:s,rules:S,type:"text"}),e.jsx(n,{name:"personPostalCode",label:cs,required:!1,control:a,editable:s,rules:ds,type:"text"}),e.jsx(E,{name:"housingTypeID",control:a,label:us,required:!1,isClearable:!0,isDisabled:!s,options:p,isLoading:le}),e.jsx(E,{name:"maritalStatusID",control:a,label:ps,required:!1,isClearable:!0,isDisabled:!s,options:ce,isLoading:i}),e.jsx(oe,{name:"personDeathDate",label:ms,control:a,disabled:!s,required:!1,setValue:D}),e.jsx(Ee,{name:"personAddress",label:Is,required:!0,control:a,editable:s,containerClassNames:"col-span-3"}),e.jsx(Ee,{name:"personDescription",label:xs,required:!0,control:a,editable:s,containerClassNames:"col-span-4 row-span-2"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(W,{dir:"ltr",endIcon:e.jsx(be,{}),disabled:!s,variant:"contained",type:"submit",loading:$,color:"success",children:e.jsx("span",{children:De})}),e.jsx(W,{dir:"ltr",endIcon:e.jsx(Se,{}),onClick:f,disabled:s,variant:"contained",color:"primary",children:e.jsx("span",{children:fe})})]})]})})})},da=()=>{const[s,f]=t.useState([]),[c,h]=me(!1),[U]=X(),m=U.get("personID"),{personDeathDate:N}=Te(p=>p.person),a=t.useMemo(()=>["retiredOrganizationID","employmentTypeID","pensionaryStatusID"],[]),I=t.useMemo(()=>["retirementDate","pensionaryStartdate"],[]),{control:u,handleSubmit:D,formState:{errors:r},setValue:x}=Ie(),{data:d,isSuccess:j,isLoading:v,isFetching:P,refetch:$}=bs(m),{data:C,isSuccess:w,isLoading:R,isFetching:b,refetch:L}=Ds(m),[B,{isLoading:H}]=fs(),{organizations:V,organizationIsLoading:M}=ea({}),{lookUpItems:G,lookUpItemsIsLoading:z}=k({lookUpType:"EmploymentType"}),{pensionaryStatus:_,pensionaryStatusIsLoading:Z}=sa({pensionaryStatusCategory:"R",pensionaryStatusIsDead:N}),o=t.useMemo(()=>y(V,"organizationID","organizationName"),[V]),A=t.useMemo(()=>y(G,"lookUpID","lookUpName"),[G]),F=t.useMemo(()=>y(_,"pensionaryStatusID","pensionaryStatusName"),[_]);t.useEffect(()=>{if(j){const p=d==null?void 0:d.itemList[0];if(p){const l={...p};Object.keys(l).forEach(i=>{i==="retirementDate"&&(l[i]=l[i]===null?null:ye(l[i])),i==="pensionaryStartdate"&&(l[i]=l[i]===null?null:ye(l[i])),x(i,l[i])})}}},[j,d==null?void 0:d.itemList,x]);const le=async p=>{const l=je(p,a,I),i=await B({...l,retiredGroup:parseInt(q(p.retiredGroup)),retiredJobDegreeCoef:parseInt(q(p.retiredJobDegreeCoef)),retiredRealDuration:parseInt(q(p.retiredRealDuration)),retiredGrantDuration:parseInt(q(p.retiredGrantDuration)),personID:m}).unwrap();h(),$(),L(),he.success(i.message)};return t.useEffect(()=>{if(j){const p=d==null?void 0:d.itemList[0],l=Ne(p,a,I,{retiredOrganizationID:o,employmentTypeID:A,pensionaryStatusID:F});Object.keys(l).forEach(i=>{ia.includes(i)&&l[i]===null?x(i,""):x(i,l[i])})}},[j,d==null?void 0:d.itemList,o,A,F,x,a,I]),t.useEffect(()=>{if(w){const p=C==null?void 0:C.itemList.map((l,i)=>({id:l.pensionaryID,isActive:l.pensionaryIsActive,pensionaryStatusRowNum:i+1,pensionaryStatusName:l.pensionaryStatusName||"-",pensionaryStartdate:l.pensionaryStartdate||"-"}));f(p)}},[w,C==null?void 0:C.itemList]),e.jsx(e.Fragment,{children:v||P?e.jsx(ie,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(xe,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:D(le),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(n,{name:"retiredGroup",label:hs,control:u,required:!0,editable:c,rules:{...T,...S},type:"text"}),e.jsx(E,{name:"retiredOrganizationID",control:u,label:Ss,required:!0,isClearable:!0,isDisabled:!c,options:o,isLoading:M,rules:T,errors:r}),e.jsx(n,{name:"retiredLastPosition",label:js,control:u,required:!1,editable:c,rules:J,type:"text"}),e.jsx(E,{name:"employmentTypeID",control:u,label:gs,required:!0,isClearable:!0,isDisabled:!c,options:A,isLoading:z,rules:T,errors:r}),e.jsx(oe,{name:"retirementDate",label:ys,control:u,disabled:!c,required:!1,errors:r,rules:T,setValue:x}),e.jsx(E,{name:"pensionaryStatusID",control:u,label:Es,required:!0,isClearable:!0,isDisabled:!c,options:F,isLoading:Z,rules:T,errors:r}),e.jsx(oe,{name:"pensionaryStartdate",label:Ts,control:u,disabled:!c,required:!0,errors:r,rules:T,setValue:x}),e.jsx(n,{name:"retiredJobDegreeCoef",label:Ns,control:u,required:!1,editable:c,rules:S,type:"text"}),e.jsx(n,{name:"retiredGrantDuration",label:Cs,control:u,required:!1,editable:c,rules:S,type:"text"}),e.jsx(n,{name:"retiredRealDuration",label:As,control:u,required:!1,editable:c,rules:S,type:"text"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(W,{dir:"ltr",endIcon:e.jsx(be,{}),disabled:!c,variant:"contained",type:"submit",loading:H,color:"success",children:e.jsx("span",{children:De})}),e.jsx(W,{dir:"ltr",endIcon:e.jsx(Se,{}),onClick:h,disabled:c,variant:"contained",color:"primary",children:e.jsx("span",{children:fe})})]}),e.jsx("div",{className:"flex-col flex-center",children:e.jsx("h5",{className:"title-secondary",children:"تاریخچه وضعیت ها"})}),e.jsx(aa,{data:s,isLoading:R,isFetching:b})]})})})},ua=()=>{const[s,f]=me(!1),[c,h]=t.useState([]),[U]=X(),m=U.get("personID"),N=t.useMemo(()=>["bankID","bankBranchID"],[]),a=t.useMemo(()=>[],[]),{control:I,handleSubmit:u,formState:{errors:D},setValue:r,watch:x}=Ie(),d=x("bankID"),{lookUpItems:j,lookUpItemsIsLoading:v}=k({lookUpType:"Bank"}),P=t.useMemo(()=>y(j,"lookUpID","lookUpName"),[j]),[$,{isLoading:C,isFetching:w}]=ta(),R=t.useMemo(()=>y(c,"lookUpID","lookUpName"),[c]),{data:b,isSuccess:L,isLoading:B,isFetching:H,refetch:V}=Rs(m),[M,{isLoading:G}]=Ls(),z=t.useCallback(async o=>{const A=await $({lookUpType:"BankBranch",lookUpParentID:o}).unwrap();h(A.itemList)},[$]),_=async o=>{const A=je(o,N,a),F=await M({...A,accountNo:q(o.accountNo)||null,ledgerCode:parseInt(q(o.ledgerCode))||null,insuranceAmount:parseFloat(q(o.insuranceAmount))||null,insuranceCoef:parseFloat(q(o.insuranceCoef))||null,personID:m}).unwrap();V(),f(),he.success(F.message)};return t.useEffect(()=>{d?z(d.value):(r("bankBranchID",null),h([]))},[d,z,r]),t.useEffect(()=>{L&&({...b},Object.keys(b).forEach(o=>{la.includes(o)&&b[o]===null?r(o,""):r(o,b[o])}))},[L,b,r]),t.useEffect(()=>{L&&P.length>0&&r("bankID",P.find(o=>o.value===b.bankID))},[L,b,r,P]),t.useEffect(()=>{L&&R.length>0&&r("bankBranchID",R.find(o=>o.value===b.bankBranchID))},[L,b,r,R]),e.jsx(e.Fragment,{children:B||H?e.jsx(ie,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(xe,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{method:"POST",className:"flex-col",onSubmit:u(_),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(E,{name:"bankID",control:I,label:Us,required:!1,isClearable:!0,isDisabled:!s,options:P,isLoading:v,errors:D}),e.jsx(E,{name:"bankBranchID",control:I,label:Os,required:!1,isClearable:!0,isDisabled:!s,options:R,isLoading:C||w,errors:D}),e.jsx(n,{name:"accountNo",label:ks,rules:S,required:!1,control:I,editable:s,type:"text"}),e.jsx(n,{name:"ledgerCode",label:Ps,rules:S,required:!1,control:I,editable:s,type:"text"}),e.jsx(n,{name:"insuranceCoef",label:_s,rules:S,required:!1,control:I,editable:s,type:"text"}),e.jsx(n,{name:"insuranceAmount",label:Fs,rules:S,required:!1,control:I,editable:s,type:"text"})]}),e.jsxs("div",{className:"flex-row mr-auto",children:[e.jsx(W,{dir:"ltr",endIcon:e.jsx(be,{}),disabled:!s,variant:"contained",type:"submit",loading:G,color:"success",children:e.jsx("span",{children:De})}),e.jsx(W,{dir:"ltr",endIcon:e.jsx(Se,{}),onClick:f,disabled:s,variant:"contained",color:"primary",children:e.jsx("span",{children:fe})})]})]})})})},pa=()=>{const[s]=X(),f=na([`${g}/${de}`,`${g}/${ue}`,`${g}/${pe}`,g]),c=s.toString(),{personDeathDate:h}=Te(a=>a.person),U=f==null?void 0:f.pattern.path,m=a=>c?`${a}?${c}`:a;return e.jsxs("div",{children:[e.jsx(ie,{sx:{bgcolor:"background.paper",borderRadius:1},children:e.jsxs(qs,{value:U,children:[e.jsx(ee,{label:h?vs:Bs,value:g,to:m(g),component:se}),e.jsx(ee,{label:Ms,value:`${g}/${de}`,to:m(`${g}/${de}`),component:se}),e.jsx(ee,{label:Gs,value:`${g}/${pe}`,to:m(`${g}/${pe}`),component:se}),e.jsx(ee,{label:$s,value:`${g}/${ue}`,to:m(`${g}/${ue}`),component:se})]})}),e.jsx(ws,{})]})},Pa=()=>e.jsxs("section",{className:"flex-col mb-20",children:[e.jsx(Xs,{title:Hs,back:!0}),e.jsxs("div",{"data-name":"retired-forms",children:[e.jsxs(ae,{children:[e.jsx(te,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(ne,{}),children:Vs}),e.jsx(re,{children:e.jsx(ca,{})})]}),e.jsxs(ae,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(te,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(ne,{}),children:zs}),e.jsx(re,{children:e.jsx(da,{})})]}),e.jsxs(ae,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(te,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(ne,{}),children:Ks}),e.jsx(re,{children:e.jsx(ua,{})})]}),e.jsxs(ae,{slotProps:{transition:{unmountOnExit:!0}},children:[e.jsx(te,{id:"panel-header","aria-controls":"panel-content",expandIcon:e.jsx(ne,{}),children:Qs}),e.jsx(re,{children:e.jsx(ra,{})})]})]}),e.jsx(pa,{})]});export{Pa as default};
