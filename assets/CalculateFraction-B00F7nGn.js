import{c as se,j as e,r as o,R as ne,em as re,en as le,eo as oe,ep as ie,a as B,eq as ce,G as de,u as v,h as D,e as R,d as M,er as me,aY as ue,a1 as s,a5 as P,a3 as fe,a6 as pe,a2 as _,a4 as z,dL as Y,es as xe,et as Ne,n as V,eu as ye,ev as G,bZ as T,B as Q,C as W,ew as Z,ex as be,ey as he,ez as K,eA as L,eB as O,eC as q,eD as H,eE as je,eF as Se,aK as Ee,eG as Ie,eH as Ce,eI as ge,eJ as Fe,eK as Ae,eL as Le,eM as Oe,eN as qe,eO as Te,W as ve,aI as De,eP as Re}from"./index-22iEO3lt.js";import{o as Me,p as Pe,c as _e,q as $}from"./useFetchLookUpData-Cn_M0P4H.js";import{c as k,S as w}from"./SelectInput-DNBvsqo2.js";import{C as J}from"./CustomCheckBox-C7fSXpMa.js";import"./sharedApi-BOYCG75A.js";import"./requestApi-VbUpJgqJ.js";import"./react-select-animated.esm-BLoX3LIO.js";const X=se(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),ee=()=>{o.useEffect(()=>{const t=n=>{if(n.key==="Enter"){const d=document.getElementById("authorize-form");d&&d.requestSubmit()}};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[])},ze=()=>[{accessorKey:"personnelStatementRowNo",header:ne,size:20,enableSorting:!1,enableColumnActions:!1},{accessorKey:"personnelStatementSerial",header:re,size:20},{accessorKey:"orderType",header:le,size:20},{accessorKey:"personnelStatementNumber",header:oe,size:20},{accessorKey:"insertTime",header:ie,size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:B(t)})},{accessorKey:"personnelStatementRunDate",header:ce,size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:B(t)})}],Ye=o.memo(({personID:t,handleRowSelect:n})=>{const[d,m]=o.useState([]),[a,{isLoading:l,isFetching:b}]=Me(),r=ze(),N=o.useCallback(async()=>{const f=(await a({personID:t}).unwrap()).itemList.map((p,i)=>({id:p.personnelStatementSerial,personnelStatementRowNo:i+1,personnelStatementSerial:p.personnelStatementSerial||"-",orderType:p.orderType||"-",personnelStatementNumber:p.personnelStatementID||"-",insertTime:p.insertTime||"-",personnelStatementRunDate:p.personnelStatementRunDate||"-"}));m(f)},[a,t]);return o.useEffect(()=>{t?N():m([])},[t,N]),e.jsx(de,{data:d,columns:r,isLoading:l,isFetching:b,scroll:!1,onRowSelect:n})}),Ve=()=>{const[t,n]=o.useState(null),[d,m]=o.useState(null),a=v(),l=D(),{fractionData:b}=R(I=>I.fraction),{control:r,handleSubmit:N,formState:{errors:j},trigger:f,watch:p,setValue:i}=M({defaultValues:{personNationalCode:(b==null?void 0:b.personNationalCode)||""}}),c=p("personNationalCode"),[h,{isLoading:S,isFetching:u}]=me(),{personnelStatementOffTypes:y,personnelStatementOffTypesIsLoading:C}=Pe(),{organizations:F,organizationIsLoading:A}=_e({}),x=o.useMemo(()=>k(y,"personnelStatementOffTypeID","personnelStatementOffTypeName"),[y]),E=o.useMemo(()=>k(F,"organizationID","organizationName"),[F]),ae=o.useCallback(I=>{m(I)},[]),te=I=>{a(G({...I,serial:d})),l("/retirement/fraction/calculate/2")},U=o.useCallback(async()=>{const g=(await h({personNationalCode:ue(c)}).unwrap()).itemList[0];g&&(i("personFirstName",g.personFirstName),i("personLastName",g.personLastName),i("personnelID",g.personnelID),n(g.personID))},[c,h,i]);return o.useEffect(()=>{c?(async()=>{await f("personNationalCode")?U():(i("personFirstName",""),i("personLastName",""),i("personnelID",""),n(null),m(null))})():(i("personFirstName",""),i("personLastName",""),i("personnelID",""),n(null),m(null))},[f,U,c,i]),ee(),e.jsx(e.Fragment,{children:e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:N(te),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:P,rules:{...fe,...pe},required:!0,control:r,type:"text"}),e.jsx(s,{name:"personFirstName",label:_,required:!1,editable:!1,control:r,isLoading:S||u,type:"text"}),e.jsx(s,{name:"personLastName",label:z,required:!1,editable:!1,control:r,isLoading:S||u,type:"text"}),e.jsx(s,{name:"personnelID",label:Y,required:!1,editable:!1,control:r,isLoading:S||u,type:"text"}),e.jsx(w,{name:"statementType",control:r,label:xe,required:!1,isClearable:!0,options:x,isLoading:C,errors:j}),e.jsx(w,{name:"organizationID",control:r,label:Ne,required:!1,isClearable:!0,options:E,isLoading:A,errors:j})]}),e.jsx(Ye,{personID:t,handleRowSelect:ae}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(V,{dir:"ltr",disabled:!d,endIcon:e.jsx(X,{}),variant:"contained",type:"submit",color:"success",children:e.jsx("span",{children:ye})})})]})})})},Ge=()=>{const{fractionData:t}=R(c=>c.fraction),{control:n,handleSubmit:d,setValue:m,watch:a}=M({defaultValues:{personNationalCode:t==null?void 0:t.personNationalCode,personFirstName:t==null?void 0:t.personFirstName,personLastName:t==null?void 0:t.personLastName,personnelID:t==null?void 0:t.personnelID}}),l=a("delay"),b=v(),r=D(),[N,{isLoading:j}]=$(),f=o.useCallback(async()=>{var S,u;const c=await N({personNationalCode:t.personNationalCode,personnelStatementOffTypeID:((S=t==null?void 0:t.statementType)==null?void 0:S.value)||"0",organizationID:((u=t==null?void 0:t.organizationID)==null?void 0:u.value)||"0",numberOfInstallments:0,personnelStatementSerialNO:parseInt(t.serial),periods:null,save:!1}).unwrap(),h=c==null?void 0:c.itemList[0];Object.keys(h).forEach(y=>{typeof h[y]=="number"?m(y,T(h[y])):m(y,h[y])})},[N,t,m]),p=async c=>{b(G({...c,...t})),r("/retirement/fraction/calculate/3")};return o.useEffect(()=>{t?f():r("/retirement/fraction/calculate/1",{replace:!0})},[t,f,r]),ee(),e.jsx(e.Fragment,{children:j?e.jsx(Q,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(W,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:d(p),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:P,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"personFirstName",label:_,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"personLastName",label:z,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"personnelID",label:Y,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"sumFraction",label:Z,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"transportedPay",label:be,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"Modal__header flex justify-center items-center",children:e.jsx("h4",{className:"title-secondary",children:he})}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:K})}),e.jsx(s,{name:"startYear",label:L,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startMonth",label:O,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startDay",label:q,editable:!1,required:!1,control:n,type:"text"}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:H})}),e.jsx(s,{name:"endYear",label:L,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endMonth",label:O,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endDay",label:q,editable:!1,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"ml-auto",children:e.jsx(J,{name:"delay",label:je,control:n})}),l&&e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:K})}),e.jsx(s,{name:"startYearDelay",label:L,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startMonthDelay",label:O,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startDayDelay",label:q,required:!1,control:n,type:"text"}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:H})}),e.jsx(s,{name:"endYearDelay",label:L,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endMonthDelay",label:O,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endDayDelay",label:q,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(V,{dir:"ltr",endIcon:e.jsx(X,{}),variant:"contained",type:"submit",color:"success",children:e.jsx("span",{children:Se})})})]})})})},Ue=()=>{const[t,n]=o.useState({}),d=D(),m=v(),{fractionData:a}=R(u=>u.fraction),{control:l,handleSubmit:b,setValue:r,watch:N}=M({defaultValues:{personNationalCode:a==null?void 0:a.personNationalCode,personFirstName:a==null?void 0:a.personFirstName,personLastName:a==null?void 0:a.personLastName,personnelID:a==null?void 0:a.personnelID}}),j=N("installment"),f=N("installmentAmount"),[p,{isLoading:i}]=$(),c=o.useCallback(async(u=!1,y=0)=>{var F,A;const C=await p({personNationalCode:a==null?void 0:a.personNationalCode,personnelStatementOffTypeID:((F=a==null?void 0:a.statementType)==null?void 0:F.value)||"0",organizationID:((A=a==null?void 0:a.organizationID)==null?void 0:A.value)||"0",numberOfInstallments:y,personnelStatementSerialNO:parseInt(a==null?void 0:a.serial),startYearDelay:parseInt(a==null?void 0:a.startYearDelay)||0,startMonthDelay:parseInt(a==null?void 0:a.startMonthDelay)||0,startDayDelay:parseInt(a==null?void 0:a.startDayDelay)||0,endYearDelay:parseInt(a==null?void 0:a.endYearDelay)||0,endMonthDelay:parseInt(a==null?void 0:a.endMonthDelay)||0,endDayDelay:parseInt(a==null?void 0:a.endDayDelay)||0,transportedPay:parseInt(a==null?void 0:a.transportedPay)||0,periods:null,save:u}).unwrap();if(u)m(G(null)),Ee.success(C.message),d("/retirement/fraction/calculate/1");else{const x=C==null?void 0:C.itemList[0];n(x),Object.keys(x).forEach(E=>{typeof x[E]=="number"?r(E,T(x[E])):r(E,x[E])}),r("sumFractionOrganizationPercent",`%${T((x.sumFractionOrganization*100/x.sumFraction).toFixed(2))}`),r("sumFractionPersonnelPercent",`%${T((x.sumFractionPersonnel*100/x.sumFraction).toFixed(2))}`)}},[p,a,r,m,d]);o.useEffect(()=>{a?c():d("/retirement/fraction/calculate/1",{replace:!0})},[a,c,d]),o.useEffect(()=>{if(f&&t&&!isNaN(parseFloat(f))&&parseFloat(f)!==0){const u=(t.debtor/parseFloat(f)).toFixed(0);r("numberOfInstallments",u)}else r("numberOfInstallments","")},[f,t,r]);const h=u=>{c(!0,parseInt(u.numberOfInstallments))};return e.jsx(e.Fragment,{children:i?e.jsx(Q,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(W,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:b(h),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:P,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"personFirstName",label:_,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"personLastName",label:z,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"personnelID",label:Y,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFraction",label:Z,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionOrganizationPercent",label:Ie,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionPersonnelPercent",label:Ce,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionOrganization",label:ge,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionPersonnel",label:Fe,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"debtor",label:Ae,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"credit",label:Le,editable:!1,required:!1,control:l,type:"text"}),e.jsx("div",{}),e.jsx(J,{name:"installment",label:Oe,control:l}),j&&e.jsxs(e.Fragment,{children:[e.jsx(s,{name:"installmentAmount",label:qe,control:l,type:"text"}),e.jsx(s,{name:"numberOfInstallments",label:Te,editable:!1,required:!1,control:l,type:"text"})]})]}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(V,{dir:"ltr",endIcon:e.jsx(ve,{}),variant:"contained",loading:i,type:"submit",color:"success",children:e.jsx("span",{children:De})})})]})})})},Ze=()=>{const{step:t}=Re();return(m=>{switch(m){case"1":return e.jsx(Ve,{});case"2":return e.jsx(Ge,{});case"3":return e.jsx(Ue,{});default:return null}})(t)};export{Ze as default};
