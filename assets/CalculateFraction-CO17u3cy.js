import{c as te,j as e,r as i,R as se,eO as ne,eP as re,eQ as le,eR as ie,f as V,eS as oe,G as ce,u as q,n as O,h as R,eT as de,aM as me,K as s,Q as D,N as ue,S as fe,M,P as _,cx as P,eU as pe,eV as xe,v as z,eW as Ne,eX as Y,i as Q,ca as k,B as w,C as W,eY as Z,eZ as ye,e_ as be,e$ as G,f0 as F,f1 as T,f2 as v,f3 as K,f4 as he,f5 as je,ax as Se,f6 as Ee,f7 as Ie,f8 as Ce,f9 as ge,fa as Ae,fb as Le,fc as Fe,fd as Te,fe as ve,bu as qe,av as Oe,ff as Re}from"./index-75zhT6gl.js";import{j as De,a as Me}from"./useFetchLookUpData-Cex0AsFX.js";import{c as B,S as H}from"./SelectInput-BjDhIOA9.js";import{u as _e}from"./personnelApi-DI2OC2le.js";import{u as X}from"./fractionApi-CkHq7VRb.js";import{C as $}from"./CustomCheckBox-CXLyM6rR.js";import"./sharedApi-CuOQJ0WC.js";import"./requestApi-C7A3UixC.js";import"./react-select-animated.esm-p7Pyr3H5.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";const J=te(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),ee=()=>{i.useEffect(()=>{const t=n=>{if(n.key==="Enter"){const o=document.getElementById("authorize-form");o&&o.requestSubmit()}};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[])},Pe=()=>[{accessorKey:"personnelStatementRowNo",header:se,size:20,enableSorting:!1,enableColumnActions:!1},{accessorKey:"personnelStatementSerial",header:ne,size:20},{accessorKey:"orderType",header:re,size:20},{accessorKey:"personnelStatementNumber",header:le,size:20},{accessorKey:"insertTime",header:ie,size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:V(t)})},{accessorKey:"personnelStatementRunDate",header:oe,size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:V(t)})}],ze=i.memo(({personID:t,handleRowSelect:n})=>{const[o,c]=i.useState([]),[a,{isLoading:l,isFetching:f}]=_e(),d=Pe(),x=i.useCallback(async()=>{const p=(await a({personID:t}).unwrap()).itemList.map((r,N)=>({id:r.personnelStatementSerial,personnelStatementRowNo:N+1,personnelStatementSerial:r.personnelStatementSerial||"-",orderType:r.orderType||"-",personnelStatementNumber:r.personnelStatementID||"-",insertTime:r.insertTime||"-",personnelStatementRunDate:r.personnelStatementRunDate||"-"}));c(p)},[a,t]);return i.useEffect(()=>{t?x():c([])},[t,x]),e.jsx(ce,{data:o,columns:d,isLoading:l,isFetching:f,scroll:!1,onRowSelect:n})}),Ye=()=>{const[t,n]=i.useState(null),[o,c]=i.useState(null),a=q(),l=O(),{control:f,handleSubmit:d,formState:{errors:x},trigger:h,watch:p,setValue:r}=R({}),N=p("personNationalCode"),[m,{isLoading:y,isFetching:j}]=de(),{personnelStatementOffTypes:u,personnelStatementOffTypesIsLoading:b}=De(),{organizations:S,organizationIsLoading:A}=Me({}),L=i.useMemo(()=>B(u,"personnelStatementOffTypeID","personnelStatementOffTypeName"),[u]),E=i.useMemo(()=>B(S,"organizationID","organizationName"),[S]),I=i.useCallback(g=>{c(g)},[]),ae=g=>{a(Y({...g,serial:o})),l("/retirement/fraction/calculate/2")},U=i.useCallback(async()=>{const C=(await m({personNationalCode:me(N)}).unwrap()).itemList[0];C&&(r("personFirstName",C.personFirstName),r("personLastName",C.personLastName),r("personnelID",C.personnelID),n(C.personID))},[N,m,r]);return i.useEffect(()=>{N?(async()=>{await h("personNationalCode")?U():(r("personFirstName",""),r("personLastName",""),r("personnelID",""),n(null),c(null))})():(r("personFirstName",""),r("personLastName",""),r("personnelID",""),n(null),c(null))},[h,U,N,r]),ee(),e.jsx(e.Fragment,{children:e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:d(ae),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:D,rules:{...ue,...fe},required:!0,control:f,type:"text"}),e.jsx(s,{name:"personFirstName",label:M,required:!1,editable:!1,control:f,isLoading:y||j,type:"text"}),e.jsx(s,{name:"personLastName",label:_,required:!1,editable:!1,control:f,isLoading:y||j,type:"text"}),e.jsx(s,{name:"personnelID",label:P,required:!1,editable:!1,control:f,isLoading:y||j,type:"text"}),e.jsx(H,{name:"statementType",control:f,label:pe,required:!1,isClearable:!0,options:L,isLoading:b,errors:x}),e.jsx(H,{name:"organizationID",control:f,label:xe,required:!1,isClearable:!0,options:E,isLoading:A,errors:x})]}),e.jsx(ze,{personID:t,handleRowSelect:I}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(z,{dir:"ltr",disabled:!o,endIcon:e.jsx(J,{}),variant:"contained",type:"submit",color:"success",children:e.jsx("span",{children:Ne})})})]})})})},Ue=["startYear","endYear"],Ve=()=>{const{fractionData:t}=Q(m=>m.fraction),{control:n,handleSubmit:o,setValue:c,watch:a}=R({defaultValues:{personNationalCode:t==null?void 0:t.personNationalCode,personFirstName:t==null?void 0:t.personFirstName,personLastName:t==null?void 0:t.personLastName,personnelID:t==null?void 0:t.personnelID}}),l=a("delay"),f=q(),d=O(),[x,{isLoading:h}]=X(),p=i.useCallback(async()=>{var j,u;const m=await x({personNationalCode:t.personNationalCode,personnelStatementOffTypeID:((j=t==null?void 0:t.statementType)==null?void 0:j.value)||"0",organizationID:((u=t==null?void 0:t.organizationID)==null?void 0:u.value)||"0",numberOfInstallments:0,personnelStatementSerialNO:parseInt(t.serial),periods:null,save:!1}).unwrap(),y=m==null?void 0:m.itemList[0];Object.keys(y).forEach(b=>{typeof y[b]=="number"&&!Ue.includes(b)?c(b,k(y[b])):c(b,y[b])})},[x,t,c]),r=async m=>{f(Y({...m,...t})),d("/retirement/fraction/calculate/3")};return i.useEffect(()=>{t?p():d("/retirement/fraction/calculate/1",{replace:!0})},[t,p,d]),ee(),e.jsx(e.Fragment,{children:h?e.jsx(w,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(W,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:o(r),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:D,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"personFirstName",label:M,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"personLastName",label:_,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"personnelID",label:P,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"includedFraction",label:Z,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"transportedPay",label:ye,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"Modal__header flex justify-center items-center",children:e.jsx("h4",{className:"title-secondary",children:be})}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:G})}),e.jsx(s,{name:"startYear",label:F,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startMonth",label:T,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startDay",label:v,editable:!1,required:!1,control:n,type:"text"}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:K})}),e.jsx(s,{name:"endYear",label:F,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endMonth",label:T,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endDay",label:v,editable:!1,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"ml-auto",children:e.jsx($,{name:"delay",label:he,control:n})}),l&&e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:G})}),e.jsx(s,{name:"startYearDelay",label:F,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startMonthDelay",label:T,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startDayDelay",label:v,required:!1,control:n,type:"text"}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:K})}),e.jsx(s,{name:"endYearDelay",label:F,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endMonthDelay",label:T,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endDayDelay",label:v,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(z,{dir:"ltr",endIcon:e.jsx(J,{}),variant:"contained",type:"submit",color:"success",children:e.jsx("span",{children:je})})})]})})})},Ge=()=>{const[t,n]=i.useState({}),o=O(),c=q(),{fractionData:a}=Q(u=>u.fraction),{control:l,handleSubmit:f,setValue:d,watch:x}=R({defaultValues:{personNationalCode:a==null?void 0:a.personNationalCode,personFirstName:a==null?void 0:a.personFirstName,personLastName:a==null?void 0:a.personLastName,personnelID:a==null?void 0:a.personnelID}}),h=x("installment"),p=x("installmentAmount"),[r,{isLoading:N}]=X(),m=i.useCallback(async(u=!1,b=0)=>{var A,L;const S=await r({personNationalCode:a==null?void 0:a.personNationalCode,personnelStatementOffTypeID:((A=a==null?void 0:a.statementType)==null?void 0:A.value)||"0",organizationID:((L=a==null?void 0:a.organizationID)==null?void 0:L.value)||"0",numberOfInstallments:b,personnelStatementSerialNO:parseInt(a==null?void 0:a.serial),startYearDelay:parseInt(a==null?void 0:a.startYearDelay)||0,startMonthDelay:parseInt(a==null?void 0:a.startMonthDelay)||0,startDayDelay:parseInt(a==null?void 0:a.startDayDelay)||0,endYearDelay:parseInt(a==null?void 0:a.endYearDelay)||0,endMonthDelay:parseInt(a==null?void 0:a.endMonthDelay)||0,endDayDelay:parseInt(a==null?void 0:a.endDayDelay)||0,transportedPay:parseInt(a==null?void 0:a.transportedPay)||0,periods:null,save:u}).unwrap();if(u)c(Y(null)),Se.success(S.message),o("/retirement/fraction/calculate/1");else{const E=S==null?void 0:S.itemList[0];n(E),Object.keys(E).forEach(I=>{typeof E[I]=="number"?d(I,k(E[I])):d(I,E[I])})}},[r,a,d,c,o]);i.useEffect(()=>{a?m():o("/retirement/fraction/calculate/1",{replace:!0})},[a,m,o]),i.useEffect(()=>{if(p&&t&&!isNaN(parseFloat(p))&&parseFloat(p)!==0){const u=(t.debtor/parseFloat(p)).toFixed(0);d("numberOfInstallments",u)}else d("numberOfInstallments","")},[p,t,d]);const y=u=>{m(!0,parseInt(u.numberOfInstallments))};return e.jsx(e.Fragment,{children:N?e.jsx(w,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(W,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:f(y),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:D,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"personFirstName",label:M,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"personLastName",label:_,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"personnelID",label:P,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFraction",label:Z,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"organizationPercent",label:Ee,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"personnelPercent",label:Ie,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionOrganization",label:Ce,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionPersonnel",label:ge,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"debtor",label:Ae,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"credit",label:Le,editable:!1,required:!1,control:l,type:"text"}),e.jsx("div",{}),e.jsx($,{name:"installment",label:Fe,control:l}),h&&e.jsxs(e.Fragment,{children:[e.jsx(s,{name:"installmentAmount",label:Te,control:l,type:"text"}),e.jsx(s,{name:"numberOfInstallments",label:ve,editable:!1,required:!1,control:l,type:"text"})]})]}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(z,{dir:"ltr",endIcon:e.jsx(qe,{}),variant:"contained",loading:N,type:"submit",color:"success",children:e.jsx("span",{children:Oe})})})]})})})},ea=()=>{const{step:t}=Re();return(c=>{switch(c){case"1":return e.jsx(Ye,{});case"2":return e.jsx(Ve,{});case"3":return e.jsx(Ge,{});default:return null}})(t)};export{ea as default};
