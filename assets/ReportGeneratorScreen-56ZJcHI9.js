import{c as ae,j as e,r as t,bo as X,b8 as he,bn as be,bp as ge,bq as je,br as fe,bs as ve,bb as _e,b5 as Me,v as W,bt as Ne,bg as ie,B as te,C as ye,y as Z,o as Ce,k as ee,b9 as R,dr as z,T as se,I as ne,ds as A,aT as le}from"./index-CAx8cgCu.js";import{f as Oe,g as Se,h as Be,i as Ge}from"./useFetchLookUpData-iQHzrd6T.js";import{i as re,S as x}from"./react-select-animated.esm-DpnCAo1z.js";import{u as H,w as Fe}from"./xlsx-uoQkVabA.js";import{s as a,a as h,o as q}from"./reactSelect-BGq5yAQc.js";import{d as Te}from"./table-options-CK1MzuTJ.js";import{M as De}from"./Modal-BvZjQLlf.js";import{A as Le}from"./Add-BaJ3brIj.js";import{D as ke}from"./DeleteOutline-CmOl4-2a.js";import{T as Ie,a as we,b as oe}from"./TabPanel-Ai9QYpiA.js";import"./sharedApi-Co6PJrAF.js";import"./requestApi-g2DUfohQ.js";import"./fractionApi-iqxfYHpz.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";const Re=ae(e.jsx("path",{d:"M13 5v6h1.17L12 13.17 9.83 11H11V5zm2-2H9v6H5l7 7 7-7h-4zm4 15H5v2h14z"}),"GetAppOutlined"),Pe=ae(e.jsx("path",{d:"M10 8.64 15.27 12 10 15.36zM8 5v14l11-7z"}),"PlayArrowOutlined");function Ee({tableData:i}){const[d,m]=t.useState({}),p=t.useMemo(()=>!i||i.length===0?[]:Object.keys(i[0]).map(u=>({accessorKey:u,header:u,size:20,Cell:({renderedCellValue:f})=>f===!0?e.jsx("div",{children:"فعال"}):f?e.jsx("div",{children:X(f)}):e.jsx("div",{children:"-"})})),[i]),s=he({...Te,columns:p,data:i,defaultColumn:{minSize:5,maxSize:1e3},muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:u=>e.jsx(be,{...u,page:X(u.page),slots:{previous:ge,next:je,first:fe,last:ve}})},muiTableBodyRowProps:({row:u})=>({onClick:()=>m(()=>({[u.id]:!0})),selected:d[u.id],sx:{cursor:"pointer"}}),getRowId:u=>u.id,onRowSelectionChange:m,state:{rowSelection:d}});return e.jsx(_e,{table:s})}function $e({fetureOptions:i,isColsLoading:d,isColsFetching:m,tableName:p,reportName:s}){const[n,u]=t.useState({}),[f,G]=t.useState(!0),[D,L]=t.useState([]),b=re(),{queryCondi:C,selectIDs:P}=Me(o=>o.reportGeneratorData),[k,{isLoading:v,isFetching:_}]=Oe(),O=[{value:"Min",label:"MIN"},{value:"Max",label:"MAX"},{value:"Count",label:"COUNT"},{value:"Avg",label:"AVG"}],g=(o,y)=>{const{name:N}=y;if(o){const{value:r}=o;u({...n,[N]:r||""})}else u({...n,[N]:null})},I=async o=>{var y,N;try{const r=await k({...n,txtSelectPart:P,ConditionsCode:C,ForSave:o,ReportName:s}).unwrap(),T=JSON.parse(r.noneobject);L(T),G(!1),console.log(T),Z.success(r.message||((y=r==null?void 0:r.error)==null?void 0:y.data.message),{autoClose:2e3})}catch(r){console.log(r),Z.error(((N=r==null?void 0:r.data)==null?void 0:N.message)||r.error,{autoClose:2e3})}},S=(o,y)=>{const N=H.json_to_sheet(o),r=H.book_new();H.book_append_sheet(r,N,"Sheet1"),Fe(r,`${y}.xlsx`)},M=()=>{S(D,"گزارش")};return t.useEffect(()=>{console.log(n)},[n]),e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"formContainer",children:e.jsx("form",{method:"POST",className:"flex-col",children:e.jsxs("div",{className:"flex-col",children:[e.jsxs("div",{className:"flex-col",style:{border:"1px solid #ddd",padding:"10px",borderRadius:"5px"},children:[e.jsx("h4",{className:"condition__box--title",children:"دسته بندی:"}),e.jsxs("div",{className:"grid grid--col-4",children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:b,options:i,onChange:g,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupField0)),name:"cmbGroupField0",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"ستون"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||m,isDisabled:!p}),e.jsx("label",{className:n!=null&&n.cmbGroupField0?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"ستون"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:b,options:O,onChange:g,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupFunction0)),name:"cmbGroupFunction0",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"تجمیع"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||m,isDisabled:!p||!n.cmbGroupField0}),e.jsx("label",{className:n!=null&&n.cmbGroupFunction0?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"تجمیع"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:b,options:i,onChange:g,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupField1)),name:"cmbGroupField1",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"ستون"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||m,isDisabled:!p}),e.jsx("label",{className:n!=null&&n.cmbGroupField1?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"ستون"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:b,options:O,onChange:g,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupFunction1)),name:"cmbGroupFunction1",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"تجمیع"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||m,isDisabled:!p||!n.cmbGroupField1}),e.jsx("label",{className:n!=null&&n.cmbGroupFunction1?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"تجمیع"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:b,options:i,onChange:g,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupField2)),name:"cmbGroupField2",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"ستون"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||m,isDisabled:!p}),e.jsx("label",{className:n!=null&&n.cmbGroupField2?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"ستون"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:b,options:O,onChange:g,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupFunction2)),name:"cmbGroupFunction2",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"تجمیع"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||m,isDisabled:!p||!n.cmbGroupField2}),e.jsx("label",{className:n!=null&&n.cmbGroupFunction2?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"تجمیع"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:b,options:i,onChange:g,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupField3)),name:"cmbGroupField3",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"ستون"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||m,isDisabled:!p}),e.jsx("label",{className:n!=null&&n.cmbGroupField3?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"ستون"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:b,options:O,onChange:g,value:i.find(o=>o.value===(n==null?void 0:n.cmbGroupFunction3)),name:"cmbGroupFunction3",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"تجمیع"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:d||m,isDisabled:!p||!n.cmbGroupField3}),e.jsx("label",{className:n!=null&&n.cmbGroupFunction3?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"تجمیع"})]})]})]}),e.jsxs("div",{style:{marginRight:"auto"},className:"flex-row",children:[e.jsx(W,{dir:"ltr",variant:"contained",endIcon:e.jsx(Ne,{}),onClick:()=>I(!0),loading:v||_,color:"success",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:"ذخیره"})}),e.jsx(W,{dir:"ltr",variant:"contained",endIcon:e.jsx(Pe,{}),onClick:()=>I(!1),loading:v||_,color:"primary",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:"اجرای گزارش"})}),e.jsx(ie,{dir:"ltr",endIcon:e.jsx(Re,{}),variant:"contained",disabled:f,onClick:M,color:"warning",sx:{fontFamily:"IranYekan"},children:e.jsx("span",{children:"خروجی اکسل"})})]})]})})}),e.jsx(Ee,{tableData:D}),v||_?e.jsxs(De,{title:"در حال ایجاد گزارش",children:[e.jsx("p",{className:"paragraph-primary",style:{textAlign:"center"},children:"لطفا منتظر بمانید..."}),e.jsx(te,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(ye,{color:"primary"})})]}):null]})}function ze(){const[i,d]=t.useState(!1),[m,p]=t.useState(!0),[s,n]=t.useState({operator:"%3D"}),[u,f]=t.useState(""),[G,D]=t.useState([]),[L,b]=t.useState([]),[C,P]=t.useState(!1),[k,{isLoading:v,isFetching:_}]=Se(),[O,{isLoading:g,isFetching:I}]=Be(),S=re(),M=Ce(),{queryCondi:E}=ee(l=>l.reportGeneratorData),{role:o}=ee(l=>l.role),{reportGeneratorTables:y,reportGeneratorTablesIsLoading:N,reportGeneratorTablesIsFetching:r}=Ge(o==null?void 0:o.value),T=q(y,"tableName","tableNameFarsi"),F=q(G,"id","columnTitle"),$=[{value:"%3D",label:"="},{value:"%3E",label:">"},{value:"%3C",label:"<"},{value:"%3E%3D",label:">="},{value:"%3C%3D",label:"<="},{value:"LIKE",label:"LIKE"}],ce=q(L,"value","text"),Q=t.useCallback(async l=>{try{const c=await k(l).unwrap();D(c.itemList)}catch(c){console.log(c)}},[k]);t.useEffect(()=>{s.TableName&&Q(s.TableName)},[s.TableName,Q]);const V=t.useCallback(async l=>{try{const c=await O(l).unwrap();b(c.itemList)}catch(c){console.log(c)}},[O]);t.useEffect(()=>{C&&V(s.columnid)},[s,V,C]),t.useEffect(()=>{if(s.columnid){const l=R(G,s.columnid);l&&P(l.isLookup!==0)}},[s,G]);const de=(l,c,j)=>{let B;const U=R(G,l).columnTitle,J=R($,c,"value").label;if(C){const xe=R(L,j,"value").text;B=`${U} ${J} ${xe}`}else M(A(E+`%23${l}%23${c}%23${j}`)),B=`${U} ${J} ${j}`;f(u+" "+B),d(!0),p(!1)},K=l=>{const{name:c,value:j}=l.target;n({...s,[c]:j})},w=(l,c)=>{const{name:j}=c;if(l){const{value:B}=l;n({...s,[j]:B||""})}else n({...s,[j]:null})},ue=(l,c)=>{const j=c.name,B=l?l.map(Y=>Y.value):[];n({...s,[j]:B})};t.useEffect(()=>{s.tableSelects&&s.tableSelects.length===1?M(z(s.tableSelects[0]+"%24")):s.tableSelects&&s.tableSelects.length===0?M(z("")):s.tableSelects&&s.tableSelects.length>1&&M(z(s.tableSelects.join("%24")+"%24"))},[s.tableSelects,M]);const me=()=>{M(A("")),f(""),d(!1),p(!0),n({...s,condition:""})},pe=l=>{f(c=>`${c} ${l}`),M(A(E+`%24${l}%24`)),d(!1),p(!0)};return e.jsxs("section",{className:"formContainer flex-col",children:[e.jsxs("form",{method:"POST",className:"flex-col",children:[e.jsxs("div",{className:"grid grid--col-4",style:{border:"1px solid #ddd",padding:"10px",borderRadius:"5px"},children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",id:"reportName",name:"reportName",onChange:K,value:s.reportName||"",className:"inputBox__form--input",required:!0}),e.jsx("label",{htmlFor:"reportName",className:"inputBox__form--label",children:"نام گزارش"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:S,options:T,onChange:w,value:T.find(l=>l.value===(s==null?void 0:s.TableName)),name:"TableName",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"جدول"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:N||r}),e.jsx("label",{className:s!=null&&s.TableName?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"جدول"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:S,options:F,onChange:ue,value:F.find(l=>l.value===(s==null?void 0:s.tableSelects)),name:"tableSelects",isMulti:!0,isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"انتخاب ستون های خروجی"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:v||_,isDisabled:v||_||!s.TableName}),e.jsx("label",{className:s!=null&&s.tableSelects&&(s==null?void 0:s.tableSelects.length)>0?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"انتخاب ستون های خروجی"})]})]}),e.jsxs("div",{className:"flex-col",style:{border:"1px solid #ddd",padding:"10px",borderRadius:"5px"},children:[e.jsxs("div",{className:"grid grid--col-4-mid-sm-last-sm",children:[e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:S,options:F,onChange:w,value:F.find(l=>l.value===(s==null?void 0:s.columnid)),name:"columnid",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"خصوصیت شرط پذیر"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:v||_,isDisabled:v||_||!s.TableName}),e.jsx("label",{className:s!=null&&s.columnid?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"خصوصیت شرط پذیر"})]}),e.jsx(x,{closeMenuOnSelect:!0,components:S,options:$,onChange:w,value:$.find(l=>l.value===(s==null?void 0:s.operator)),name:"operator",isClearable:!1,noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h}),s.columnid&&!C&&e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",value:s.condition,id:"condition",name:"condition",onChange:K,required:!0}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"condition",children:"شرط"})]}),s.columnid&&C&&e.jsxs("div",{className:"inputBox__form",children:[e.jsx(x,{closeMenuOnSelect:!0,components:S,options:ce,onChange:w,value:F.find(l=>l.value===(s==null?void 0:s.condition)),name:"condition",isClearable:!0,placeholder:e.jsx("div",{className:"react-select-placeholder",children:"شرط"}),noOptionsMessage:a.noOptionsMessage,loadingMessage:a.loadingMessage,styles:h,isLoading:I||g}),e.jsx("label",{className:s!=null&&s.condition?"inputBox__form--readOnly-label":"inputBox__form--readOnly-label-hidden",children:"شرط"})]}),e.jsxs("div",{children:[e.jsx(se,{title:"افزودن شرط",children:e.jsx("span",{children:e.jsx(ne,{color:"success",onClick:()=>de(s.columnid,s.operator,s.condition),disabled:!s.TableName||!s.operator||!s.columnid||!s.condition||i,children:e.jsx(Le,{})})})}),e.jsx(se,{title:"پاک کردن تمامی شروط",children:e.jsx("span",{children:e.jsx(ne,{color:"error",onClick:me,children:e.jsx(ke,{})})})})]})]}),e.jsxs("div",{className:"grid grid--col-2-first-sm",children:[e.jsx("div",{className:"grid grid--col-2",children:["or","and","(",")","null","%"].map(l=>e.jsx(ie,{dir:"ltr",variant:"contained",color:"info",disabled:m,onClick:()=>pe(l),children:e.jsx("span",{children:l.toUpperCase()})},l))}),e.jsxs("div",{className:"condition__box row-span-3",children:[e.jsx("h4",{className:"condition__box--title",children:"شروط انتخاب شده:"}),e.jsx("p",{children:u})]})]})]})]}),e.jsx($e,{fetureOptions:F,isColsLoading:v,isColsFetching:_,tableName:s.TableName,reportName:s.reportName})]})}function as(){const[i,d]=t.useState("1"),m=(s,n)=>{d(n)};return e.jsxs("section",{className:"flex-col",children:[e.jsx("div",{className:"title-primary--container flex-row flex-center",children:e.jsx("h4",{className:"title-primary",children:e.jsx("span",{className:"title-primary--underline",children:"گزارش ساز"})})}),e.jsx("div",{children:e.jsxs(Ie,{value:i,children:[e.jsx(te,{sx:{bgcolor:"background.paper",borderRadius:1},children:e.jsxs(we,{onChange:m,"aria-label":"tabs",children:[e.jsx(le,{label:"گزارش جدید",value:"1"}),e.jsx(le,{label:"گزارش های ثبت شده",value:"2"})]})}),e.jsx(oe,{value:"1",sx:{padding:"0"},children:e.jsx(ze,{})}),e.jsx(oe,{value:"2",sx:{padding:"0"}})]})})]})}export{as as default};
