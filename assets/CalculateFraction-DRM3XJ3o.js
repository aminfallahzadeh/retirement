import{c as te,j as e,r as i,R as se,eu as ne,ev as re,ew as le,ex as ie,f as G,ey as oe,G as ce,u as v,m as D,h as R,ez as de,b0 as me,a5 as s,a9 as M,a7 as ue,aa as fe,a6 as _,a8 as P,dT as z,eA as xe,eB as pe,t as Y,eC as Ne,eD as U,i as w,c2 as q,B as Q,C as W,eE as $,eF as ye,eG as be,eH as B,eI as L,eJ as O,eK as T,eL as K,eM as he,eN as je,aO as Se,eO as Ee,eP as Ie,eQ as Ce,eR as ge,eS as Fe,eT as Ae,eU as Le,eV as Oe,eW as Te,_ as qe,aM as ve,eX as De}from"./index-DH_UxGcZ.js";import{o as Re,p as Me,c as _e,q as J}from"./useFetchLookUpData-w2YH6MrS.js";import{c as H,S as k}from"./SelectInput-CfXulpeA.js";import{C as X}from"./CustomCheckBox-B71psgp6.js";import"./sharedApi-LcrgYKLo.js";import"./requestApi-vRW7bAuA.js";import"./react-select-animated.esm-B1iog3R3.js";const Z=te(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),ee=()=>{i.useEffect(()=>{const t=n=>{if(n.key==="Enter"){const c=document.getElementById("authorize-form");c&&c.requestSubmit()}};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[])},Pe=()=>[{accessorKey:"personnelStatementRowNo",header:se,size:20,enableSorting:!1,enableColumnActions:!1},{accessorKey:"personnelStatementSerial",header:ne,size:20},{accessorKey:"orderType",header:re,size:20},{accessorKey:"personnelStatementNumber",header:le,size:20},{accessorKey:"insertTime",header:ie,size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:G(t)})},{accessorKey:"personnelStatementRunDate",header:oe,size:20,Cell:({renderedCellValue:t})=>e.jsx("div",{children:G(t)})}],ze=i.memo(({personID:t,handleRowSelect:n})=>{const[c,d]=i.useState([]),[a,{isLoading:l,isFetching:f}]=Re(),o=Pe(),p=i.useCallback(async()=>{const x=(await a({personID:t}).unwrap()).itemList.map((r,y)=>({id:r.personnelStatementSerial,personnelStatementRowNo:y+1,personnelStatementSerial:r.personnelStatementSerial||"-",orderType:r.orderType||"-",personnelStatementNumber:r.personnelStatementID||"-",insertTime:r.insertTime||"-",personnelStatementRunDate:r.personnelStatementRunDate||"-"}));d(x)},[a,t]);return i.useEffect(()=>{t?p():d([])},[t,p]),e.jsx(ce,{data:c,columns:o,isLoading:l,isFetching:f,scroll:!1,onRowSelect:n})}),Ye=()=>{const[t,n]=i.useState(null),[c,d]=i.useState(null),a=v(),l=D(),{control:f,handleSubmit:o,formState:{errors:p},trigger:j,watch:x,setValue:r}=R({}),y=x("personNationalCode"),[m,{isLoading:b,isFetching:S}]=de(),{personnelStatementOffTypes:u,personnelStatementOffTypesIsLoading:h}=Me(),{organizations:E,organizationIsLoading:F}=_e({}),A=i.useMemo(()=>H(u,"personnelStatementOffTypeID","personnelStatementOffTypeName"),[u]),N=i.useMemo(()=>H(E,"organizationID","organizationName"),[E]),I=i.useCallback(g=>{d(g)},[]),ae=g=>{a(U({...g,serial:c})),l("/retirement/fraction/calculate/2")},V=i.useCallback(async()=>{const C=(await m({personNationalCode:me(y)}).unwrap()).itemList[0];C&&(r("personFirstName",C.personFirstName),r("personLastName",C.personLastName),r("personnelID",C.personnelID),n(C.personID))},[y,m,r]);return i.useEffect(()=>{y?(async()=>{await j("personNationalCode")?V():(r("personFirstName",""),r("personLastName",""),r("personnelID",""),n(null),d(null))})():(r("personFirstName",""),r("personLastName",""),r("personnelID",""),n(null),d(null))},[j,V,y,r]),ee(),e.jsx(e.Fragment,{children:e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:o(ae),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:M,rules:{...ue,...fe},required:!0,control:f,type:"text"}),e.jsx(s,{name:"personFirstName",label:_,required:!1,editable:!1,control:f,isLoading:b||S,type:"text"}),e.jsx(s,{name:"personLastName",label:P,required:!1,editable:!1,control:f,isLoading:b||S,type:"text"}),e.jsx(s,{name:"personnelID",label:z,required:!1,editable:!1,control:f,isLoading:b||S,type:"text"}),e.jsx(k,{name:"statementType",control:f,label:xe,required:!1,isClearable:!0,options:A,isLoading:h,errors:p}),e.jsx(k,{name:"organizationID",control:f,label:pe,required:!1,isClearable:!0,options:N,isLoading:F,errors:p})]}),e.jsx(ze,{personID:t,handleRowSelect:I}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(Y,{dir:"ltr",disabled:!c,endIcon:e.jsx(Z,{}),variant:"contained",type:"submit",color:"success",children:e.jsx("span",{children:Ne})})})]})})})},Ue=()=>{const{fractionData:t}=w(m=>m.fraction),{control:n,handleSubmit:c,setValue:d,watch:a}=R({defaultValues:{personNationalCode:t==null?void 0:t.personNationalCode,personFirstName:t==null?void 0:t.personFirstName,personLastName:t==null?void 0:t.personLastName,personnelID:t==null?void 0:t.personnelID}}),l=a("delay"),f=v(),o=D(),[p,{isLoading:j}]=J(),x=i.useCallback(async()=>{var S,u;const m=await p({personNationalCode:t.personNationalCode,personnelStatementOffTypeID:((S=t==null?void 0:t.statementType)==null?void 0:S.value)||"0",organizationID:((u=t==null?void 0:t.organizationID)==null?void 0:u.value)||"0",numberOfInstallments:0,personnelStatementSerialNO:parseInt(t.serial),periods:null,save:!1}).unwrap(),b=m==null?void 0:m.itemList[0];Object.keys(b).forEach(h=>{typeof b[h]=="number"?d(h,q(b[h])):d(h,b[h])})},[p,t,d]),r=async m=>{f(U({...m,...t})),o("/retirement/fraction/calculate/3")};return i.useEffect(()=>{t?x():o("/retirement/fraction/calculate/1",{replace:!0})},[t,x,o]),ee(),e.jsx(e.Fragment,{children:j?e.jsx(Q,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(W,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:c(r),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:M,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"personFirstName",label:_,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"personLastName",label:P,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"personnelID",label:z,required:!1,editable:!1,control:n,type:"text"}),e.jsx(s,{name:"sumFraction",label:$,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"transportedPay",label:ye,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"Modal__header flex justify-center items-center",children:e.jsx("h4",{className:"title-secondary",children:be})}),e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:B})}),e.jsx(s,{name:"startYear",label:L,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startMonth",label:O,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startDay",label:T,editable:!1,required:!1,control:n,type:"text"}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:K})}),e.jsx(s,{name:"endYear",label:L,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endMonth",label:O,editable:!1,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endDay",label:T,editable:!1,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"ml-auto",children:e.jsx(X,{name:"delay",label:he,control:n})}),l&&e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:B})}),e.jsx(s,{name:"startYearDelay",label:L,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startMonthDelay",label:O,required:!1,control:n,type:"text"}),e.jsx(s,{name:"startDayDelay",label:T,required:!1,control:n,type:"text"}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{children:K})}),e.jsx(s,{name:"endYearDelay",label:L,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endMonthDelay",label:O,required:!1,control:n,type:"text"}),e.jsx(s,{name:"endDayDelay",label:T,required:!1,control:n,type:"text"})]}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(Y,{dir:"ltr",endIcon:e.jsx(Z,{}),variant:"contained",type:"submit",color:"success",children:e.jsx("span",{children:je})})})]})})})},Ve=()=>{const[t,n]=i.useState({}),c=D(),d=v(),{fractionData:a}=w(u=>u.fraction),{control:l,handleSubmit:f,setValue:o,watch:p}=R({defaultValues:{personNationalCode:a==null?void 0:a.personNationalCode,personFirstName:a==null?void 0:a.personFirstName,personLastName:a==null?void 0:a.personLastName,personnelID:a==null?void 0:a.personnelID}}),j=p("installment"),x=p("installmentAmount"),[r,{isLoading:y}]=J(),m=i.useCallback(async(u=!1,h=0)=>{var F,A;const E=await r({personNationalCode:a==null?void 0:a.personNationalCode,personnelStatementOffTypeID:((F=a==null?void 0:a.statementType)==null?void 0:F.value)||"0",organizationID:((A=a==null?void 0:a.organizationID)==null?void 0:A.value)||"0",numberOfInstallments:h,personnelStatementSerialNO:parseInt(a==null?void 0:a.serial),startYearDelay:parseInt(a==null?void 0:a.startYearDelay)||0,startMonthDelay:parseInt(a==null?void 0:a.startMonthDelay)||0,startDayDelay:parseInt(a==null?void 0:a.startDayDelay)||0,endYearDelay:parseInt(a==null?void 0:a.endYearDelay)||0,endMonthDelay:parseInt(a==null?void 0:a.endMonthDelay)||0,endDayDelay:parseInt(a==null?void 0:a.endDayDelay)||0,transportedPay:parseInt(a==null?void 0:a.transportedPay)||0,periods:null,save:u}).unwrap();if(u)d(U(null)),Se.success(E.message),c("/retirement/fraction/calculate/1");else{const N=E==null?void 0:E.itemList[0];n(N),Object.keys(N).forEach(I=>{typeof N[I]=="number"?o(I,q(N[I])):o(I,N[I])}),o("sumFractionOrganizationPercent",`%${q((N.sumFractionOrganization*100/N.sumFraction).toFixed(2))}`),o("sumFractionPersonnelPercent",`%${q((N.sumFractionPersonnel*100/N.sumFraction).toFixed(2))}`)}},[r,a,o,d,c]);i.useEffect(()=>{a?m():c("/retirement/fraction/calculate/1",{replace:!0})},[a,m,c]),i.useEffect(()=>{if(x&&t&&!isNaN(parseFloat(x))&&parseFloat(x)!==0){const u=(t.debtor/parseFloat(x)).toFixed(0);o("numberOfInstallments",u)}else o("numberOfInstallments","")},[x,t,o]);const b=u=>{m(!0,parseInt(u.numberOfInstallments))};return e.jsx(e.Fragment,{children:y?e.jsx(Q,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(W,{color:"primary"})}):e.jsx("section",{className:"flex-col",children:e.jsxs("form",{id:"authorize-form",method:"POST",className:"flex-col formContainer",onSubmit:f(b),noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-4",children:[e.jsx(s,{name:"personNationalCode",label:M,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"personFirstName",label:_,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"personLastName",label:P,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"personnelID",label:z,required:!1,editable:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFraction",label:$,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionOrganizationPercent",label:Ee,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionPersonnelPercent",label:Ie,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionOrganization",label:Ce,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"sumFractionPersonnel",label:ge,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"debtor",label:Fe,editable:!1,required:!1,control:l,type:"text"}),e.jsx(s,{name:"credit",label:Ae,editable:!1,required:!1,control:l,type:"text"}),e.jsx("div",{}),e.jsx(X,{name:"installment",label:Le,control:l}),j&&e.jsxs(e.Fragment,{children:[e.jsx(s,{name:"installmentAmount",label:Oe,control:l,type:"text"}),e.jsx(s,{name:"numberOfInstallments",label:Te,editable:!1,required:!1,control:l,type:"text"})]})]}),e.jsx("div",{className:"flex-row ml-auto",children:e.jsx(Y,{dir:"ltr",endIcon:e.jsx(qe,{}),variant:"contained",loading:y,type:"submit",color:"success",children:e.jsx("span",{children:ve})})})]})})})},We=()=>{const{step:t}=De();return(d=>{switch(d){case"1":return e.jsx(Ye,{});case"2":return e.jsx(Ue,{});case"3":return e.jsx(Ve,{});default:return null}})(t)};export{We as default};
