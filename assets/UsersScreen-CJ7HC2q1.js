import{r as l,bK as J,bL as z,j as e,B as O,C as G,D as B,t as K,bs as q,y as k,x as v,n as U,bt as C,bI as V,bM as W,H as T,bw as D,bN as E,Q as I,bO as X,bP as Y,bQ as M,bR as Z,bC as P,bS as ee,bT as se,bU as te,bV as ae,T as S,I as _,P as oe,J as re,K as le,M as ie,N as ne,L as ce}from"./index-D94qalpB.js";import{d as R}from"./table-options-8AQReVD3.js";import{M as L}from"./Modal-BDZoctSv.js";import{S as A}from"./index-D0nym2Oo.js";/* empty css                 */import{D as de,a as ue,C as me}from"./KeyboardDoubleArrowRight-PXGfifqZ.js";import{E as xe}from"./EditOutlined-BMma8vIg.js";import{R as pe}from"./Refresh-B9HI6fmX.js";import{A as fe}from"./Add-DRxQovKv.js";function he({setShowEditUserModal:f,userID:g}){const[s,m]=l.useState(null),[d,{isLoading:x}]=J(),{data:h,isLoading:N,isFetching:u,isSuccess:c,refetch:j,error:p}=z({userID:g});l.useEffect(()=>(j(),c&&m(h.itemList[0]),()=>{m(null)}),[c,h,j]),l.useEffect(()=>{p&&console.log(p)},[p]);const t=async()=>{var n;try{const a=await d({...s,sex:s.sex==="true"?!0:s.sex===!0,isActive:s.isActive==="true"?!0:s.isActive===!0,tel:k(s.tel),mobile:k(s.mobile)}).unwrap();f(!1),v.success(a.message,{autoClose:2e3})}catch(a){console.log(a),v.error(((n=a==null?void 0:a.data)==null?void 0:n.message)||a.error,{autoClose:2e3})}},r=n=>{const{name:a,value:y}=n.target;m({...s,[a]:y})};return e.jsx(e.Fragment,{children:N||u||!s?e.jsx(O,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(G,{color:"primary"})}):e.jsxs("section",{className:"formContainer flex-col flex-center",children:[e.jsxs("form",{method:"POST",className:"grid grid--col-3",children:[e.jsx("div",{className:"inputBox__form",children:e.jsxs("div",{className:"inputBox__form--readOnly-input",children:[e.jsx("div",{className:"inputBox__form--readOnly-label",children:"نام کاربری"}),e.jsx("div",{className:"inputBox__form--readOnly-content",children:s.username||"-"})]})}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",name:"password",className:"inputBox__form--input",required:!0,id:"psw",value:s.password||"-",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"psw",children:"رمز عبور"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"fname",name:"firstName",value:s.firstName||"-",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"fname",children:"نام"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"family",name:"lastName",value:s.lastName||"-",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"familly",children:"نام خانوادگی"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsxs("select",{className:"inputBox__form--input",id:"isActive",style:{cursor:"pointer"},name:"isActive",required:!0,value:s.isActive===!1||s.isActive==="false"?"false":"true",onChange:r,children:[e.jsx("option",{value:" ",disabled:!0,children:"انتخاب کنید"}),e.jsx("option",{value:"true",children:"فعال"}),e.jsx("option",{value:"false",children:"غیر فعال"})]}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"isActive",children:"وضعیت"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"mail",value:s.email||"-",name:"email",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"mail",children:"پست الکترونیکی"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"tel",name:"tel",value:B(s.tel)||"-",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"tel",children:"تلفن ثابت"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"cell",value:B(s.mobile)||"-",name:"mobile",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"cell",children:"تلفن همراه"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsxs("select",{className:"inputBox__form--input",id:"sex",style:{cursor:"pointer"},value:s.sex===!1||s.sex==="false"?"false":"true",name:"sex",onChange:r,children:[e.jsx("option",{value:" ",disabled:!0,children:"انتخاب کنید"}),e.jsx("option",{value:"true",children:"مرد"}),e.jsx("option",{value:"false",children:"زن"})]}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"sex",children:"جنسیت"})]})]}),e.jsx(K,{dir:"ltr",endIcon:e.jsx(q,{}),loading:x,onClick:t,variant:"contained",color:"success",children:e.jsx("span",{children:"ذخیره"})})]})})}function je(){const[f,g]=l.useState({}),s=U(),{userGroupsTableData:m}=C(t=>t.userGroupsData),{groupsUserTableData:d}=C(t=>t.groupsUserData),{data:x,isLoading:h,isSuccess:N,error:u,refetch:c}=V();l.useEffect(()=>{var t;if(c(),N){const i=x.itemList.map(n=>({id:n.id,name:n.groupName})).filter(n=>!m.map(a=>a.name).includes(n.name));s(W(i))}else u&&v.error(((t=u==null?void 0:u.data)==null?void 0:t.message)||u.error,{autoClose:2e3,style:{fontSize:"18px"}})},[x,N,s,u,c,m]);const j=l.useMemo(()=>[{accessorKey:"name",header:"گروه ها",size:300}],[]),p=T({...R,columns:j,data:d,positionGlobalFilter:"left",initialState:{density:"compact",showGlobalFilter:!0},muiTableBodyRowProps:({row:t})=>({onClick:()=>g(()=>({[t.id]:!0})),selected:f[t.id],sx:{cursor:"pointer"}}),enablePagination:!1,enableBottomToolbar:!1,muiTableContainerProps:{sx:{height:"300px"}},getRowId:t=>t.id,onRowSelectionChange:g,state:{rowSelection:f}});return l.useEffect(()=>{const t=Object.keys(p.getState().rowSelection)[0],r=D(d,t);s(t?E(r):E(null))},[s,p,f,d]),e.jsx(e.Fragment,{children:h?e.jsx("div",{className:"skeleton-md",children:e.jsx(A,{count:7,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl",width:280})}):e.jsx(I,{table:p})})}function be({userID:f,userName:g}){const[s,m]=l.useState({}),d=U(),{userGroupsTableData:x}=C(i=>i.userGroupsData),{data:h,isSuccess:N,isLoading:u,error:c,refetch:j}=X(f);l.useEffect(()=>{var i;if(j(),N){const n=h.itemList.map(a=>({id:a.groupID,name:a.groupName}));d(Y(n))}else c&&v.error(((i=c==null?void 0:c.data)==null?void 0:i.message)||c.error,{autoClose:2e3,style:{fontSize:"18px"}})},[h,N,d,j,c]);const p=l.useMemo(()=>[{accessorKey:"name",header:`ویرایش گروه های ${g}`,size:300}],[g]),t=T({...R,columns:p,data:x,enablePagination:!1,enableBottomToolbar:!1,muiTableContainerProps:{sx:{height:"300px"}},positionGlobalFilter:"left",initialState:{density:"compact",showGlobalFilter:!0},muiTableBodyRowProps:({row:i})=>({onClick:()=>m(()=>({[i.id]:!0})),selected:s[i.id],sx:{cursor:"pointer"}}),getRowId:i=>i.id,onRowSelectionChange:m,state:{rowSelection:s}});return l.useEffect(()=>{const i=Object.keys(t.getState().rowSelection)[0],n=D(x,i);d(i&&n?M(n):M(null))},[d,t,s,x]),e.jsx(e.Fragment,{children:u?e.jsx("div",{className:"skeleton-md",children:e.jsx(A,{count:7,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl",width:280})}):e.jsx(I,{table:t})})}function ge({userID:f,setShowEditUserGroupsModal:g}){const s=U(),{selectedUserGroupData:m,userGroupsTableData:d}=C(t=>t.userGroupsData),{selectedGroupUserData:x}=C(t=>t.groupsUserData),[h,{isLoading:N}]=Z(),u=async()=>{var t;try{const r=d.map(n=>({id:"",userID:f,groupID:n.id,groupName:""})),i=await h(r).unwrap();g(!1),v.success(i.message,{autoClose:2e3})}catch(r){v.error(((t=r==null?void 0:r.data)==null?void 0:t.message)||r.error,{autoClose:2e3})}},c=t=>{s(ee(x)),s(se(t))},j=t=>{s(te(m)),s(ae(t))};return e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",rowGap:"10px"},children:[e.jsx(P,{onClick:()=>c(x.id),variant:"contained",color:"primary",children:e.jsx(de,{})}),e.jsx(P,{onClick:()=>j(m.id),variant:"contained",color:"primary",children:e.jsx(ue,{})}),e.jsx(K,{dir:"ltr",endIcon:e.jsx(q,{}),loading:N,onClick:u,variant:"contained",color:"success",children:e.jsx("span",{children:"ذخیره"})})]})}function Ne(){const[f,g]=l.useState([]),[s,m]=l.useState(null),[d,x]=l.useState({}),[h,N]=l.useState(null),[u,c]=l.useState(!1),[j,p]=l.useState(!1),{data:t,isLoading:r,isFetching:i,isSuccess:n,error:a,refetch:y}=z({}),Q=()=>{c(!0)},$=()=>{p(!0)},F=()=>{y()};l.useEffect(()=>{if(y(),n){const o=t.itemList.map(b=>({id:b.userID,isActive:b.isActive?"فعال":"غیر فعال",lastName:b.lastName,firstName:b.firstName,username:b.username,password:b.password,email:b.email,sex:b.sex,tel:b.tel,mobile:b.mobile}));g(o)}},[t,n,y,u,j]),l.useEffect(()=>{var o;a&&(console.log(a),v.error(((o=a==null?void 0:a.data)==null?void 0:o.message)||a.error,{autoClose:2e3,style:{fontSize:"18px"}}))},[a]);const H=l.useMemo(()=>[{accessorKey:"username",header:"نام کاربری",size:20},{accessorKey:"firstName",header:"نام",size:20},{accessorKey:"lastName",header:"نام خانوادگی",size:20},{accessorKey:"isActive",header:"وضعیت",size:20},{accessorKey:"editUserAction",header:"ویرایش کاربر",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:o})=>e.jsx(S,{title:`${o.original.firstName} ${o.original.lastName}`,children:e.jsx(_,{color:"success",onClick:Q,sx:{padding:"0"},children:e.jsx(xe,{})})})},{accessorKey:"editGroupsAction",header:"ویرایش گروه ها",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:o})=>e.jsx(S,{title:`${o.original.firstName} ${o.original.lastName}`,children:e.jsx(_,{color:"info",onClick:$,sx:{padding:"0"},children:e.jsx(me,{})})})}],[]),w=T({...R,columns:H,data:f,muiTableBodyRowProps:({row:o})=>({onClick:()=>x(()=>({[o.id]:!0})),selected:d[o.id],sx:{cursor:"pointer"}}),muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:o=>e.jsx(oe,{...o,page:B(o.page),slots:{previous:re,next:le,first:ie,last:ne}})},renderTopToolbarCustomActions:()=>e.jsxs(O,{children:[i?e.jsx(_,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(G,{size:20,value:100})}):e.jsx(S,{title:"بروز رسانی",children:e.jsx("span",{children:e.jsx(_,{"aria-label":"refresh",color:"info",onClick:F,children:e.jsx(pe,{fontSize:"small"})})})}),e.jsx(ce,{to:"/retirement/create-user",children:i?e.jsx(_,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(G,{size:20,value:100,color:"success"})}):e.jsx(S,{title:"ایجاد کاربر",children:e.jsx("span",{children:e.jsx(_,{"aria-label":"refresh",color:"success",onClick:F,children:e.jsx(fe,{fontSize:"small"})})})})})]}),getRowId:o=>o.id,onRowSelectionChange:x,state:{rowSelection:d}});return l.useEffect(()=>{const o=Object.keys(w.getState().rowSelection)[0];if(o){const b=D(f,o).username;N(o),m(b)}},[w,d,f]),e.jsx(e.Fragment,{children:r?e.jsx("div",{className:"skeleton-lg",children:e.jsx(A,{count:5,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl"})}):e.jsxs(e.Fragment,{children:[u?e.jsx(L,{title:"ویرایش اطلاعات کاربر",closeModal:()=>c(!1),children:e.jsx(he,{setShowEditUserModal:c,userID:h})}):j?e.jsx(L,{title:"ویرایش گروه های کاربر",closeModal:()=>p(!1),children:e.jsxs("div",{className:"flex-row",children:[e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"گروه ها"})}),e.jsx(je,{})]}),e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"عملیات"})}),e.jsx("div",{style:{marginTop:"6rem"},children:e.jsx(ge,{userID:h,setShowEditUserGroupsModal:p})})]}),e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"گروه های کاربر"})}),e.jsx(be,{userID:h,userName:s})]})]})}):null,e.jsx(I,{table:w})]})})}function De(){return e.jsxs("section",{className:"flex-col",children:[e.jsx("div",{className:"title-primary--container flex-row flex-center",children:e.jsxs("h4",{className:"title-primary",children:[e.jsx("span",{className:"title-primary--underline"}),"مدیریت کاربران"]})}),e.jsx(Ne,{})]})}export{De as default};
