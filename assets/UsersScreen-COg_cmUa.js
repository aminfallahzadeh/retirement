import{r as l,Y as X,Z as z,j as e,B as O,C as w,n as B,h as K,l as k,k as v,d as U,F as C,X as Y,_ as Z,x as T,$ as E,a0 as J,a1 as V,a2 as M,a3 as W,o as P,a4 as ee,a5 as se,a6 as ae,a7 as te,T as S,I as _,L as oe}from"./index-DXLU_PyE.js";import{u as D,M as I,P as re,C as le,a as ie,L as ne,F as ce}from"./index.esm-C4cCMZs-.js";import{d as F}from"./table-options-CzF4bt5B.js";import{M as L}from"./Modal-DP9lNDeG.js";import{S as q}from"./index-BEKQ4JXP.js";import{S as R}from"./index-DlQt11va.js";/* empty css                 */import{D as de,a as ue,C as me}from"./KeyboardDoubleArrowRight-DQEmNpUL.js";import{E as xe}from"./EditOutlined-BL_7hCyu.js";import{R as pe}from"./Refresh-CMDgE-rc.js";import{A as fe}from"./Add-WyPxsGLi.js";function he({setShowEditUserModal:f,userID:b}){const[s,m]=l.useState(null),[d,{isLoading:x}]=X(),{data:h,isLoading:N,isFetching:u,isSuccess:c,refetch:j,error:p}=z({userID:b});l.useEffect(()=>(j(),c&&m(h.itemList[0]),()=>{m(null)}),[c,h,j]),l.useEffect(()=>{p&&console.log(p)},[p]);const a=async()=>{var n;try{const t=await d({...s,sex:s.sex==="true"?!0:s.sex===!0,isActive:s.isActive==="true"?!0:s.isActive===!0,tel:k(s.tel),mobile:k(s.mobile)}).unwrap();f(!1),v.success(t.message,{autoClose:2e3})}catch(t){console.log(t),v.error(((n=t==null?void 0:t.data)==null?void 0:n.message)||t.error,{autoClose:2e3})}},r=n=>{const{name:t,value:y}=n.target;m({...s,[t]:y})};return e.jsx(e.Fragment,{children:N||u||!s?e.jsx(O,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(w,{color:"primary"})}):e.jsxs("section",{className:"formContainer flex-col flex-center",children:[e.jsxs("form",{method:"POST",className:"grid grid--col-3",children:[e.jsx("div",{className:"inputBox__form",children:e.jsxs("div",{className:"inputBox__form--readOnly-input",children:[e.jsx("div",{className:"inputBox__form--readOnly-label",children:"نام کاربری"}),e.jsx("div",{className:"inputBox__form--readOnly-content",children:s.username||"-"})]})}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",name:"password",className:"inputBox__form--input",required:!0,id:"psw",value:s.password||"-",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"psw",children:"رمز عبور"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"fname",name:"firstName",value:s.firstName||"-",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"fname",children:"نام"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"family",name:"lastName",value:s.lastName||"-",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"familly",children:"نام خانوادگی"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsxs("select",{className:"inputBox__form--input",id:"isActive",style:{cursor:"pointer"},name:"isActive",required:!0,value:s.isActive===!1||s.isActive==="false"?"false":"true",onChange:r,children:[e.jsx("option",{value:" ",disabled:!0,children:"انتخاب کنید"}),e.jsx("option",{value:"true",children:"فعال"}),e.jsx("option",{value:"false",children:"غیر فعال"})]}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"isActive",children:"وضعیت"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"mail",value:s.email||"-",name:"email",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"mail",children:"پست الکترونیکی"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"tel",name:"tel",value:B(s.tel)||"-",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"tel",children:"تلفن ثابت"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"cell",value:B(s.mobile)||"-",name:"mobile",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"cell",children:"تلفن همراه"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsxs("select",{className:"inputBox__form--input",id:"sex",style:{cursor:"pointer"},value:s.sex===!1||s.sex==="false"?"false":"true",name:"sex",onChange:r,children:[e.jsx("option",{value:" ",disabled:!0,children:"انتخاب کنید"}),e.jsx("option",{value:"true",children:"مرد"}),e.jsx("option",{value:"false",children:"زن"})]}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"sex",children:"جنسیت"})]})]}),e.jsx(K,{dir:"ltr",endIcon:e.jsx(q,{}),loading:x,onClick:a,variant:"contained",color:"success",children:e.jsx("span",{children:"ذخیره"})})]})})}function je(){const[f,b]=l.useState({}),s=U(),{userGroupsTableData:m}=C(a=>a.userGroupsData),{groupsUserTableData:d}=C(a=>a.groupsUserData),{data:x,isLoading:h,isSuccess:N,error:u,refetch:c}=Y();l.useEffect(()=>{var a;if(c(),N){const i=x.itemList.map(n=>({id:n.id,name:n.groupName})).filter(n=>!m.map(t=>t.name).includes(n.name));s(Z(i))}else u&&v.error(((a=u==null?void 0:u.data)==null?void 0:a.message)||u.error,{autoClose:2e3,style:{fontSize:"18px"}})},[x,N,s,u,c,m]);const j=l.useMemo(()=>[{accessorKey:"name",header:"گروه ها",size:300}],[]),p=D({...F,columns:j,data:d,positionGlobalFilter:"left",initialState:{density:"compact",showGlobalFilter:!0},muiTableBodyRowProps:({row:a})=>({onClick:()=>b(()=>({[a.id]:!0})),selected:f[a.id],sx:{cursor:"pointer"}}),enablePagination:!1,enableBottomToolbar:!1,muiTableContainerProps:{sx:{height:"300px"}},getRowId:a=>a.id,onRowSelectionChange:b,state:{rowSelection:f}});return l.useEffect(()=>{const a=Object.keys(p.getState().rowSelection)[0],r=T(d,a);s(a?E(r):E(null))},[s,p,f,d]),e.jsx(e.Fragment,{children:h?e.jsx("div",{className:"skeleton-md",children:e.jsx(R,{count:7,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl",width:280})}):e.jsx(I,{table:p})})}function ge({userID:f,userName:b}){const[s,m]=l.useState({}),d=U(),{userGroupsTableData:x}=C(i=>i.userGroupsData),{data:h,isSuccess:N,isLoading:u,error:c,refetch:j}=J(f);l.useEffect(()=>{var i;if(j(),N){const n=h.itemList.map(t=>({id:t.groupID,name:t.groupName}));d(V(n))}else c&&v.error(((i=c==null?void 0:c.data)==null?void 0:i.message)||c.error,{autoClose:2e3,style:{fontSize:"18px"}})},[h,N,d,j,c]);const p=l.useMemo(()=>[{accessorKey:"name",header:`ویرایش گروه های ${b}`,size:300}],[b]),a=D({...F,columns:p,data:x,enablePagination:!1,enableBottomToolbar:!1,muiTableContainerProps:{sx:{height:"300px"}},positionGlobalFilter:"left",initialState:{density:"compact",showGlobalFilter:!0},muiTableBodyRowProps:({row:i})=>({onClick:()=>m(()=>({[i.id]:!0})),selected:s[i.id],sx:{cursor:"pointer"}}),getRowId:i=>i.id,onRowSelectionChange:m,state:{rowSelection:s}});return l.useEffect(()=>{const i=Object.keys(a.getState().rowSelection)[0],n=T(x,i);d(i&&n?M(n):M(null))},[d,a,s,x]),e.jsx(e.Fragment,{children:u?e.jsx("div",{className:"skeleton-md",children:e.jsx(R,{count:7,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl",width:280})}):e.jsx(I,{table:a})})}function be({userID:f,setShowEditUserGroupsModal:b}){const s=U(),{selectedUserGroupData:m,userGroupsTableData:d}=C(a=>a.userGroupsData),{selectedGroupUserData:x}=C(a=>a.groupsUserData),[h,{isLoading:N}]=W(),u=async()=>{var a;try{const r=d.map(n=>({id:"",userID:f,groupID:n.id,groupName:""})),i=await h(r).unwrap();b(!1),v.success(i.message,{autoClose:2e3})}catch(r){v.error(((a=r==null?void 0:r.data)==null?void 0:a.message)||r.error,{autoClose:2e3})}},c=a=>{s(ee(x)),s(se(a))},j=a=>{s(ae(m)),s(te(a))};return e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",rowGap:"10px"},children:[e.jsx(P,{onClick:()=>c(x.id),variant:"contained",color:"primary",children:e.jsx(de,{})}),e.jsx(P,{onClick:()=>j(m.id),variant:"contained",color:"primary",children:e.jsx(ue,{})}),e.jsx(K,{dir:"ltr",endIcon:e.jsx(q,{}),loading:N,onClick:u,variant:"contained",color:"success",children:e.jsx("span",{children:"ذخیره"})})]})}function Ne(){const[f,b]=l.useState([]),[s,m]=l.useState(null),[d,x]=l.useState({}),[h,N]=l.useState(null),[u,c]=l.useState(!1),[j,p]=l.useState(!1),{data:a,isLoading:r,isFetching:i,isSuccess:n,error:t,refetch:y}=z({}),$=()=>{c(!0)},Q=()=>{p(!0)},A=()=>{y()};l.useEffect(()=>{if(y(),n){const o=a.itemList.map(g=>({id:g.userID,isActive:g.isActive?"فعال":"غیر فعال",lastName:g.lastName,firstName:g.firstName,username:g.username,password:g.password,email:g.email,sex:g.sex,tel:g.tel,mobile:g.mobile}));b(o)}},[a,n,y,u,j]),l.useEffect(()=>{var o;t&&(console.log(t),v.error(((o=t==null?void 0:t.data)==null?void 0:o.message)||t.error,{autoClose:2e3,style:{fontSize:"18px"}}))},[t]);const H=l.useMemo(()=>[{accessorKey:"username",header:"نام کاربری",size:20},{accessorKey:"firstName",header:"نام",size:20},{accessorKey:"lastName",header:"نام خانوادگی",size:20},{accessorKey:"isActive",header:"وضعیت",size:20},{accessorKey:"editUserAction",header:"ویرایش کاربر",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:o})=>e.jsx(S,{title:`${o.original.firstName} ${o.original.lastName}`,children:e.jsx(_,{color:"success",onClick:$,sx:{padding:"0"},children:e.jsx(xe,{})})})},{accessorKey:"editGroupsAction",header:"ویرایش گروه ها",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:o})=>e.jsx(S,{title:`${o.original.firstName} ${o.original.lastName}`,children:e.jsx(_,{color:"info",onClick:Q,sx:{padding:"0"},children:e.jsx(me,{})})})}],[]),G=D({...F,columns:H,data:f,muiTableBodyRowProps:({row:o})=>({onClick:()=>x(()=>({[o.id]:!0})),selected:d[o.id],sx:{cursor:"pointer"}}),muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:o=>e.jsx(re,{...o,page:B(o.page),slots:{previous:le,next:ie,first:ne,last:ce}})},renderTopToolbarCustomActions:()=>e.jsxs(O,{children:[i?e.jsx(_,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(w,{size:20,value:100})}):e.jsx(S,{title:"بروز رسانی",children:e.jsx("span",{children:e.jsx(_,{"aria-label":"refresh",color:"info",onClick:A,children:e.jsx(pe,{fontSize:"small"})})})}),e.jsx(oe,{to:"/retirement/create-user",children:i?e.jsx(_,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(w,{size:20,value:100,color:"success"})}):e.jsx(S,{title:"ایجاد کاربر",children:e.jsx("span",{children:e.jsx(_,{"aria-label":"refresh",color:"success",onClick:A,children:e.jsx(fe,{fontSize:"small"})})})})})]}),getRowId:o=>o.id,onRowSelectionChange:x,state:{rowSelection:d}});return l.useEffect(()=>{const o=Object.keys(G.getState().rowSelection)[0];if(o){const g=T(f,o).username;N(o),m(g)}},[G,d,f]),e.jsx(e.Fragment,{children:r?e.jsx("div",{className:"skeleton-lg",children:e.jsx(R,{count:5,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl"})}):e.jsxs(e.Fragment,{children:[u?e.jsx(L,{title:"ویرایش اطلاعات کاربر",closeModal:()=>c(!1),children:e.jsx(he,{setShowEditUserModal:c,userID:h})}):j?e.jsx(L,{title:"ویرایش گروه های کاربر",closeModal:()=>p(!1),children:e.jsxs("div",{className:"flex-row",children:[e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"گروه ها"})}),e.jsx(je,{})]}),e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"عملیات"})}),e.jsx("div",{style:{marginTop:"6rem"},children:e.jsx(be,{userID:h,setShowEditUserGroupsModal:p})})]}),e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"گروه های کاربر"})}),e.jsx(ge,{userID:h,userName:s})]})]})}):null,e.jsx(I,{table:G})]})})}function Fe(){return e.jsxs("section",{className:"flex-col",children:[e.jsx("div",{className:"title-primary--container flex-row flex-center",children:e.jsxs("h4",{className:"title-primary",children:[e.jsx("span",{className:"title-primary--underline"}),"مدیریت کاربران"]})}),e.jsx(Ne,{})]})}export{Fe as default};
