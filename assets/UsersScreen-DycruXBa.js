import{r as l,bB as J,bC as P,j as e,B as O,C as w,bw as B,v as K,bb as q,z as E,y as N,o as U,bc as C,bt as V,bD as W,bf as D,bg as T,bE as k,bi as I,bF as X,bG as Y,bH as z,bI as Z,bn as M,bJ as ee,bK as se,bL as ae,bM as te,T as S,I as _,bv as oe,bx as re,by as le,bz as ie,bA as ne,L as ce}from"./index-Dnu3KgnM.js";import{d as R}from"./table-options-1zcSwn2c.js";import{M as L}from"./Modal-Bz7Yp7fg.js";import{S as A}from"./index-DfelfbP9.js";/* empty css                 */import{D as de,a as ue,C as me}from"./KeyboardDoubleArrowRight-D2ECcIJM.js";import{E as xe}from"./EditOutlined-BlD_6y8u.js";import{R as pe}from"./Refresh-Ce8zZN4d.js";import{A as fe}from"./Add-jXAG2HSa.js";function he({setShowEditUserModal:f,userID:g}){const[s,m]=l.useState(null),[d,{isLoading:x}]=J(),{data:h,isLoading:v,isFetching:u,isSuccess:c,refetch:j,error:p}=P({userID:g});l.useEffect(()=>(j(),c&&m(h.itemList[0]),()=>{m(null)}),[c,h,j]),l.useEffect(()=>{p&&console.log(p)},[p]);const a=async()=>{var n;try{const t=await d({...s,sex:s.sex==="true"?!0:s.sex===!0,isActive:s.isActive==="true"?!0:s.isActive===!0,tel:E(s.tel),mobile:E(s.mobile)}).unwrap();f(!1),N.success(t.message,{autoClose:2e3})}catch(t){console.log(t),N.error(((n=t==null?void 0:t.data)==null?void 0:n.message)||t.error,{autoClose:2e3})}},r=n=>{const{name:t,value:y}=n.target;m({...s,[t]:y})};return e.jsx(e.Fragment,{children:v||u||!s?e.jsx(O,{sx:{display:"flex",justifyContent:"center",padding:"2rem 10rem"},children:e.jsx(w,{color:"primary"})}):e.jsxs("section",{className:"formContainer flex-col flex-center",children:[e.jsxs("form",{method:"POST",className:"grid grid--col-3",children:[e.jsx("div",{className:"inputBox__form",children:e.jsxs("div",{className:"inputBox__form--readOnly-input",children:[e.jsx("div",{className:"inputBox__form--readOnly-label",children:"نام کاربری"}),e.jsx("div",{className:"inputBox__form--readOnly-content",children:s.username||"-"})]})}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",name:"password",className:"inputBox__form--input",required:!0,id:"psw",value:s.password||"-",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"psw",children:"رمز عبور"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"fname",name:"firstName",value:s.firstName||"-",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"fname",children:"نام"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"family",name:"lastName",value:s.lastName||"-",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"familly",children:"نام خانوادگی"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsxs("select",{className:"inputBox__form--input",id:"isActive",style:{cursor:"pointer"},name:"isActive",required:!0,value:s.isActive===!1||s.isActive==="false"?"false":"true",onChange:r,children:[e.jsx("option",{value:" ",disabled:!0,children:"انتخاب کنید"}),e.jsx("option",{value:"true",children:"فعال"}),e.jsx("option",{value:"false",children:"غیر فعال"})]}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"isActive",children:"وضعیت"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"mail",value:s.email||"-",name:"email",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"mail",children:"پست الکترونیکی"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"tel",name:"tel",value:B(s.tel)||"-",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"tel",children:"تلفن ثابت"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsx("input",{type:"text",className:"inputBox__form--input",required:!0,id:"cell",value:B(s.mobile)||"-",name:"mobile",onChange:r}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"cell",children:"تلفن همراه"})]}),e.jsxs("div",{className:"inputBox__form",children:[e.jsxs("select",{className:"inputBox__form--input",id:"sex",style:{cursor:"pointer"},value:s.sex===!1||s.sex==="false"?"false":"true",name:"sex",onChange:r,children:[e.jsx("option",{value:" ",disabled:!0,children:"انتخاب کنید"}),e.jsx("option",{value:"true",children:"مرد"}),e.jsx("option",{value:"false",children:"زن"})]}),e.jsx("label",{className:"inputBox__form--label",htmlFor:"sex",children:"جنسیت"})]})]}),e.jsx(K,{dir:"ltr",endIcon:e.jsx(q,{}),loading:x,onClick:a,variant:"contained",color:"success",children:e.jsx("span",{children:"ذخیره"})})]})})}function je(){const[f,g]=l.useState({}),s=U(),{userGroupsTableData:m}=C(a=>a.userGroupsData),{groupsUserTableData:d}=C(a=>a.groupsUserData),{data:x,isLoading:h,isSuccess:v,error:u,refetch:c}=V();l.useEffect(()=>{var a;if(c(),v){const i=x.itemList.map(n=>({id:n.id,name:n.groupName})).filter(n=>!m.map(t=>t.name).includes(n.name));s(W(i))}else u&&N.error(((a=u==null?void 0:u.data)==null?void 0:a.message)||u.error,{autoClose:2e3,style:{fontSize:"18px"}})},[x,v,s,u,c,m]);const j=l.useMemo(()=>[{accessorKey:"name",header:"گروه ها",size:300}],[]),p=D({...R,columns:j,data:d,positionGlobalFilter:"left",initialState:{density:"compact",showGlobalFilter:!0},muiTableBodyRowProps:({row:a})=>({onClick:()=>g(()=>({[a.id]:!0})),selected:f[a.id],sx:{cursor:"pointer"}}),enablePagination:!1,enableBottomToolbar:!1,muiTableContainerProps:{sx:{height:"300px"}},getRowId:a=>a.id,onRowSelectionChange:g,state:{rowSelection:f}});return l.useEffect(()=>{const a=Object.keys(p.getState().rowSelection)[0],r=T(d,a);s(a?k(r):k(null))},[s,p,f,d]),e.jsx(e.Fragment,{children:h?e.jsx("div",{className:"skeleton-md",children:e.jsx(A,{count:7,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl",width:280})}):e.jsx(I,{table:p})})}function be({userID:f,userName:g}){const[s,m]=l.useState({}),d=U(),{userGroupsTableData:x}=C(i=>i.userGroupsData),{data:h,isSuccess:v,isLoading:u,error:c,refetch:j}=X(f);l.useEffect(()=>{var i;if(j(),v){const n=h.itemList.map(t=>({id:t.groupID,name:t.groupName}));d(Y(n))}else c&&N.error(((i=c==null?void 0:c.data)==null?void 0:i.message)||c.error,{autoClose:2e3,style:{fontSize:"18px"}})},[h,v,d,j,c]);const p=l.useMemo(()=>[{accessorKey:"name",header:`ویرایش گروه های ${g}`,size:300}],[g]),a=D({...R,columns:p,data:x,enablePagination:!1,enableBottomToolbar:!1,muiTableContainerProps:{sx:{height:"300px"}},positionGlobalFilter:"left",initialState:{density:"compact",showGlobalFilter:!0},muiTableBodyRowProps:({row:i})=>({onClick:()=>m(()=>({[i.id]:!0})),selected:s[i.id],sx:{cursor:"pointer"}}),getRowId:i=>i.id,onRowSelectionChange:m,state:{rowSelection:s}});return l.useEffect(()=>{const i=Object.keys(a.getState().rowSelection)[0],n=T(x,i);d(i&&n?z(n):z(null))},[d,a,s,x]),e.jsx(e.Fragment,{children:u?e.jsx("div",{className:"skeleton-md",children:e.jsx(A,{count:7,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl",width:280})}):e.jsx(I,{table:a})})}function ge({userID:f,setShowEditUserGroupsModal:g}){const s=U(),{selectedUserGroupData:m,userGroupsTableData:d}=C(a=>a.userGroupsData),{selectedGroupUserData:x}=C(a=>a.groupsUserData),[h,{isLoading:v}]=Z(),u=async()=>{var a;try{const r=d.map(n=>({id:"",userID:f,groupID:n.id,groupName:""})),i=await h(r).unwrap();g(!1),N.success(i.message,{autoClose:2e3})}catch(r){N.error(((a=r==null?void 0:r.data)==null?void 0:a.message)||r.error,{autoClose:2e3})}},c=a=>{s(ee(x)),s(se(a))},j=a=>{s(ae(m)),s(te(a))};return e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",rowGap:"10px"},children:[e.jsx(M,{onClick:()=>c(x.id),variant:"contained",color:"primary",children:e.jsx(de,{})}),e.jsx(M,{onClick:()=>j(m.id),variant:"contained",color:"primary",children:e.jsx(ue,{})}),e.jsx(K,{dir:"ltr",endIcon:e.jsx(q,{}),loading:v,onClick:u,variant:"contained",color:"success",children:e.jsx("span",{children:"ذخیره"})})]})}function ve(){const[f,g]=l.useState([]),[s,m]=l.useState(null),[d,x]=l.useState({}),[h,v]=l.useState(null),[u,c]=l.useState(!1),[j,p]=l.useState(!1),{data:a,isLoading:r,isFetching:i,isSuccess:n,error:t,refetch:y}=P({}),$=()=>{c(!0)},H=()=>{p(!0)},F=()=>{y()};l.useEffect(()=>{if(y(),n){const o=a.itemList.map(b=>({id:b.userID,isActive:b.isActive?"فعال":"غیر فعال",lastName:b.lastName,firstName:b.firstName,username:b.username,password:b.password,email:b.email,sex:b.sex,tel:b.tel,mobile:b.mobile}));g(o)}},[a,n,y,u,j]),l.useEffect(()=>{var o;t&&(console.log(t),N.error(((o=t==null?void 0:t.data)==null?void 0:o.message)||t.error,{autoClose:2e3,style:{fontSize:"18px"}}))},[t]);const Q=l.useMemo(()=>[{accessorKey:"username",header:"نام کاربری",size:20},{accessorKey:"firstName",header:"نام",size:20},{accessorKey:"lastName",header:"نام خانوادگی",size:20},{accessorKey:"isActive",header:"وضعیت",size:20},{accessorKey:"editUserAction",header:"ویرایش کاربر",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:o})=>e.jsx(S,{title:`${o.original.firstName} ${o.original.lastName}`,children:e.jsx(_,{color:"success",onClick:$,sx:{padding:"0"},children:e.jsx(xe,{})})})},{accessorKey:"editGroupsAction",header:"ویرایش گروه ها",enableSorting:!1,enableColumnActions:!1,size:20,Cell:({row:o})=>e.jsx(S,{title:`${o.original.firstName} ${o.original.lastName}`,children:e.jsx(_,{color:"info",onClick:H,sx:{padding:"0"},children:e.jsx(me,{})})})}],[]),G=D({...R,columns:Q,data:f,muiTableBodyRowProps:({row:o})=>({onClick:()=>x(()=>({[o.id]:!0})),selected:d[o.id],sx:{cursor:"pointer"}}),muiPaginationProps:{size:"small",shape:"rounded",showRowsPerPage:!1,renderItem:o=>e.jsx(oe,{...o,page:B(o.page),slots:{previous:re,next:le,first:ie,last:ne}})},renderTopToolbarCustomActions:()=>e.jsxs(O,{children:[i?e.jsx(_,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(w,{size:20,value:100})}):e.jsx(S,{title:"بروز رسانی",children:e.jsx("span",{children:e.jsx(_,{"aria-label":"refresh",color:"info",onClick:F,children:e.jsx(pe,{fontSize:"small"})})})}),e.jsx(ce,{to:"/retirement/create-user",children:i?e.jsx(_,{"aria-label":"refresh",color:"info",disabled:!0,children:e.jsx(w,{size:20,value:100,color:"success"})}):e.jsx(S,{title:"ایجاد کاربر",children:e.jsx("span",{children:e.jsx(_,{"aria-label":"refresh",color:"success",onClick:F,children:e.jsx(fe,{fontSize:"small"})})})})})]}),getRowId:o=>o.id,onRowSelectionChange:x,state:{rowSelection:d}});return l.useEffect(()=>{const o=Object.keys(G.getState().rowSelection)[0];if(o){const b=T(f,o).username;v(o),m(b)}},[G,d,f]),e.jsx(e.Fragment,{children:r?e.jsx("div",{className:"skeleton-lg",children:e.jsx(A,{count:5,baseColor:"#dfdfdf",highlightColor:"#9f9f9f",duration:1,direction:"rtl"})}):e.jsxs(e.Fragment,{children:[u?e.jsx(L,{title:"ویرایش اطلاعات کاربر",closeModal:()=>c(!1),children:e.jsx(he,{setShowEditUserModal:c,userID:h})}):j?e.jsx(L,{title:"ویرایش گروه های کاربر",closeModal:()=>p(!1),children:e.jsxs("div",{className:"flex-row",children:[e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"گروه ها"})}),e.jsx(je,{})]}),e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"عملیات"})}),e.jsx("div",{style:{marginTop:"6rem"},children:e.jsx(ge,{userID:h,setShowEditUserGroupsModal:p})})]}),e.jsxs("div",{className:"flex-col",children:[e.jsx("div",{className:"modal__header",children:e.jsx("h4",{className:"title-tertiary",children:"گروه های کاربر"})}),e.jsx(be,{userID:h,userName:s})]})]})}):null,e.jsx(I,{table:G})]})})}function Te(){return e.jsxs("section",{className:"flex-col",children:[e.jsx("div",{className:"title-primary--container flex-row flex-center",children:e.jsxs("h4",{className:"title-primary",children:[e.jsx("span",{className:"title-primary--underline"}),"مدیریت کاربران"]})}),e.jsx(ve,{})]})}export{Te as default};
